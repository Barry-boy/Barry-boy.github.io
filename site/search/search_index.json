{"config":{"indexing":"full","lang":["en"],"min_search_length":3,"prebuild_index":true,"separator":"[\\s\\-]+"},"docs":[{"location":"","text":"Kubernetes \u8fdb\u9636\u8bad\u7ec3\u8425 \u00b6 \u5317\u6f02\u4e00\u65cf \u4e3b\u8981\u8bb0\u5f55\u5de5\u4f5c\u4ee5\u53ca\u751f\u6d3b\u5185\u5bb9 \u6211\u76842022\u76ee\u6807: \u751f\u6d3b/\u8fdb\u5ea6: \u8df3\u69fd\uff084\u6708\u672b\u5c3e\u5df2\u5b8c\u6210\uff09 \u722c\u957f\u57ce\uff08\u5df2\u5b8c\u6210\uff09 \u4f53\u9a8c\u767e\u5ea6\u65e0\u4eba\u9a7e\u9a76\uff08\u5df2\u5b8c\u6210\uff09 9.10--9.12 \u732b\u72d7\u53cc\u5168 (\u6709\u70b9\u56f0\u96be\uff0c\u4f30\u8ba1\u53ea\u80fd\u5b8c\u6210\u4e00\u534a) \u8003\u5b8c\u9a7e\u7167\uff08\u8fdb\u884c\u4e2d\uff09 \u62a5\u540d\u5b8c\u6210 \u79d1\u4e00 \u79d1\u4e8c \u79d1\u4e09 \u79d1\u56db \u5de5\u4f5c/\u8fdb\u5ea6: \u53ef\u4ee5\u6210\u529f\u8f6c\u6b63(\u5df2\u5b8c\u6210) \u5de5\u4f5c\u5b89\u6392\uff1a 8.22--8.26 \u7814\u7a76juicefs\u5b58\u50a8 juicefs\u4e0ecephfs\u6027\u80fd\u5bf9\u6bd4 \u5907\u4efdenflame\u96c6\u7fa4\u7684\u6570\u636e \u73af\u5883\u5347\u7ea7\uff088-29--9.13\uff09 8.29--9.2 \u673a\u5668\u4e0b\u67b6 \u65b0\u673a\u5668\u4e0a\u67b6 \u66f4\u6362sn2700 100g \u8c03\u8bd5Ansible-playbook 9.5--9.9 \u66f4\u65b0\u4e0a\u6d77\u4e34\u6e2f\u96c6\u7fa4\u8bc1\u4e66 \u8c03\u8bd5\u516c\u53f8\u6cf0\u5766\u673a\u5668dns\u95ee\u9898 \u6d4b\u8bd5\u65b0\u589e\u673a\u5668\u4e0eceph\u7684mon\u5176\u4e2d\u4e24\u4e2a\u4e0d\u540c\u95ee\u9898 \u6dfb\u52a0stor3\uff08ansible-playbook\uff09\u5230produce\u96c6\u7fa4\u4e2d \u6dfb\u52a0\u65b0ssd\u56fa\u6001\u78c1\u76d8\u5230T40\uff0c\u7528\u6765\u7ed9docker\u6570\u636e\u76ee\u5f55\u505a\u6570\u636e\u76d8 a100-1 \u6362\u4e24\u6839 100g \u7f51\u7ebf \u7edf\u8ba1\u6b63\u5f0f\u673a\u5668Mac\u5730\u5740\u8868\uff0c\u94fe\u63a5\u5730\u5740: https://docs.qq.com/sheet/DTE5paVJha1hBVW1L?tab=BB08J2 9.13--9.16 \u8c03\u8bd5\u516c\u53f8\u7684\u7f51\u7edc\u8bbe\u5907 \u6d4b\u8bd5\u65b0\u589e3090\u7f51\u7edc\u662f\u5426\u53ef\u7528\uff08\u5df2\u5b8c\u6210\uff09 \u6dfb\u52a0A100-1\uff08ansible-playbook\uff09\u5230produce\u96c6\u7fa4\u4e2d \u8c03\u8bd5\u65b0\u589e\u673a\u5668lxcfs\uff08ubunt22.04 \u53ea\u5f00\u542fcgroup v2\u5bfc\u81f4\u7684\uff09 \u53bb\u6570\u636e\u4e2d\u5fc3\u5b89\u88c5stor4\u65b0\u7cfb\u7edf\uff0c\u5e76\u67e5\u770bstor3\u7f51\u7ebf\u95ee\u9898 \u6dfb\u52a0ssd osd \u5230produce\u96c6\u7fa4\u4e2d 9.19--9.23 \u6dfb\u52a0ssd osd \u5230produce\u96c6\u7fa4\u4e2d \u6dfb\u52a0\u65b0\u589e\u673a\u5668\u7f51\u5361\u914d\u7f6e 9.26--9.30 \u642d\u5efa\u65b0\u73af\u5883\uff0c\u7ed9\u7814\u53d1\u4eba\u5458\u4f7f\u7528 produce \u73af\u5883\u8c03\u8bd5\u95ee\u9898 ansible-playbook g3 \u91cd\u65b0\u5b89\u88c5a100-1 \u5b66\u4e60python (\u8fdb\u884c\u4e2d) \u8003\u5b8cCKA\u548cCKS\u4e24\u4e2a\u8bc1\u4e66\uff08\u8fdb\u884c\u4e2d\uff09 CKA \u6240\u6709\u8003\u9898\u7ec3\u4e60\u5b8c\u6210","title":"\u9996\u9875"},{"location":"#kubernetes","text":"\u5317\u6f02\u4e00\u65cf \u4e3b\u8981\u8bb0\u5f55\u5de5\u4f5c\u4ee5\u53ca\u751f\u6d3b\u5185\u5bb9 \u6211\u76842022\u76ee\u6807: \u751f\u6d3b/\u8fdb\u5ea6: \u8df3\u69fd\uff084\u6708\u672b\u5c3e\u5df2\u5b8c\u6210\uff09 \u722c\u957f\u57ce\uff08\u5df2\u5b8c\u6210\uff09 \u4f53\u9a8c\u767e\u5ea6\u65e0\u4eba\u9a7e\u9a76\uff08\u5df2\u5b8c\u6210\uff09 9.10--9.12 \u732b\u72d7\u53cc\u5168 (\u6709\u70b9\u56f0\u96be\uff0c\u4f30\u8ba1\u53ea\u80fd\u5b8c\u6210\u4e00\u534a) \u8003\u5b8c\u9a7e\u7167\uff08\u8fdb\u884c\u4e2d\uff09 \u62a5\u540d\u5b8c\u6210 \u79d1\u4e00 \u79d1\u4e8c \u79d1\u4e09 \u79d1\u56db \u5de5\u4f5c/\u8fdb\u5ea6: \u53ef\u4ee5\u6210\u529f\u8f6c\u6b63(\u5df2\u5b8c\u6210) \u5de5\u4f5c\u5b89\u6392\uff1a 8.22--8.26 \u7814\u7a76juicefs\u5b58\u50a8 juicefs\u4e0ecephfs\u6027\u80fd\u5bf9\u6bd4 \u5907\u4efdenflame\u96c6\u7fa4\u7684\u6570\u636e \u73af\u5883\u5347\u7ea7\uff088-29--9.13\uff09 8.29--9.2 \u673a\u5668\u4e0b\u67b6 \u65b0\u673a\u5668\u4e0a\u67b6 \u66f4\u6362sn2700 100g \u8c03\u8bd5Ansible-playbook 9.5--9.9 \u66f4\u65b0\u4e0a\u6d77\u4e34\u6e2f\u96c6\u7fa4\u8bc1\u4e66 \u8c03\u8bd5\u516c\u53f8\u6cf0\u5766\u673a\u5668dns\u95ee\u9898 \u6d4b\u8bd5\u65b0\u589e\u673a\u5668\u4e0eceph\u7684mon\u5176\u4e2d\u4e24\u4e2a\u4e0d\u540c\u95ee\u9898 \u6dfb\u52a0stor3\uff08ansible-playbook\uff09\u5230produce\u96c6\u7fa4\u4e2d \u6dfb\u52a0\u65b0ssd\u56fa\u6001\u78c1\u76d8\u5230T40\uff0c\u7528\u6765\u7ed9docker\u6570\u636e\u76ee\u5f55\u505a\u6570\u636e\u76d8 a100-1 \u6362\u4e24\u6839 100g \u7f51\u7ebf \u7edf\u8ba1\u6b63\u5f0f\u673a\u5668Mac\u5730\u5740\u8868\uff0c\u94fe\u63a5\u5730\u5740: https://docs.qq.com/sheet/DTE5paVJha1hBVW1L?tab=BB08J2 9.13--9.16 \u8c03\u8bd5\u516c\u53f8\u7684\u7f51\u7edc\u8bbe\u5907 \u6d4b\u8bd5\u65b0\u589e3090\u7f51\u7edc\u662f\u5426\u53ef\u7528\uff08\u5df2\u5b8c\u6210\uff09 \u6dfb\u52a0A100-1\uff08ansible-playbook\uff09\u5230produce\u96c6\u7fa4\u4e2d \u8c03\u8bd5\u65b0\u589e\u673a\u5668lxcfs\uff08ubunt22.04 \u53ea\u5f00\u542fcgroup v2\u5bfc\u81f4\u7684\uff09 \u53bb\u6570\u636e\u4e2d\u5fc3\u5b89\u88c5stor4\u65b0\u7cfb\u7edf\uff0c\u5e76\u67e5\u770bstor3\u7f51\u7ebf\u95ee\u9898 \u6dfb\u52a0ssd osd \u5230produce\u96c6\u7fa4\u4e2d 9.19--9.23 \u6dfb\u52a0ssd osd \u5230produce\u96c6\u7fa4\u4e2d \u6dfb\u52a0\u65b0\u589e\u673a\u5668\u7f51\u5361\u914d\u7f6e 9.26--9.30 \u642d\u5efa\u65b0\u73af\u5883\uff0c\u7ed9\u7814\u53d1\u4eba\u5458\u4f7f\u7528 produce \u73af\u5883\u8c03\u8bd5\u95ee\u9898 ansible-playbook g3 \u91cd\u65b0\u5b89\u88c5a100-1 \u5b66\u4e60python (\u8fdb\u884c\u4e2d) \u8003\u5b8cCKA\u548cCKS\u4e24\u4e2a\u8bc1\u4e66\uff08\u8fdb\u884c\u4e2d\uff09 CKA \u6240\u6709\u8003\u9898\u7ec3\u4e60\u5b8c\u6210","title":"Kubernetes \u8fdb\u9636\u8bad\u7ec3\u8425"},{"location":"ansible-case1/","text":"Ansible \u6848\u4f8b \u00b6 \u51c6\u5907\u5de5\u4f5c \u914d\u7f6einventory/pve [ pve ] master.pve hostname = master ansible_host = 192 .168.1.11 ansible_ssh_user = root ansible_ssh_pass = \"pass@word1\" \u6e29\u99a8\u63d0\u793a \u53ef\u80fd\u51fa\u73b0sudo\u6743\u9650\u4e0d\u591f\u7684\u95ee\u9898\uff0c\u90a3\u4e48\u53ef\u4ee5\u5728inventory\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9 gtx3090.c1 hostname = ubuntu ansible_ssh_user = xxx ansible_sudo_pass = xxx ansible_ssh_pass = \"password\" ubuntu22.04 \u6267\u884c\u62a5\u9519 TASK [ Gathering Facts ] ******************************************************************************************************* fatal: [ axis ] : FAILED! = > { \"ansible_facts\" : {} , \"changed\" : false, \"failed_modules\" : { \"ansible.legacy.setup\" : { \"failed\" : true, \"module_stderr\" : \"/bin/sh: 1: /usr/bin/python: not found\\n\" , \"module_stdout\" : \"\" , \"msg\" : \"The module failed to execute correctly, you probably need to set the interpreter.\\nSee stdout/stderr for the exact error\" , \"rc\" : 127 }} , \"msg\" : \"The following modules failed to execute: ansible.legacy.setup\\n\" } Ansible \u5e38\u7528\u9009\u9879 -C //\u9884\u6267\u884c --list-hosts //\u5217\u51fa\u6b63\u5728\u8fd0\u884c\u4efb\u52a1\u7684\u4e3b\u673a --list-tasks //\u5217\u51fatasks --limit \u4e3b\u673a\u5217\u8868 //\u53ea\u9488\u5bf9\u7279\u5b9a\u4e3b\u673a\u6267\u884c \u6848\u4f8b\u4e00\uff1acreate_user.yaml \u00b6 Ansible \u6279\u91cf\u521b\u5efa\u7528\u6237 \u8fd9\u91cc\u8bbe\u7f6epassword\u9700\u8981\u4f7f\u7528python\u547d\u4ee4\u751f\u6210sha-512\u7b97\u6cd5,pw\u662f\u8981\u52a0\u5bc6\u7684\u5bc6\u7801 a=$(python3 -c 'import crypt,getpass;pw=\"123456\";print(crypt.crypt(pw))') $ echo $a QUbhMQ9BAGQBE \u793a\u4f8b\u4e00 \u7528\u6237\u5bc6\u7801 - hosts : pve tasks : - name : ensure admin group group : name : admin state : present - name : ensure admin group nopasswd sudo copy : dest : /etc/sudoers.d/admin content : | %admin ALL=(ALL:ALL) NOPASSWD: ALL - name : add user user : name={{ item }} groups=admin password=d6F1o2yfgTymU shell=/bin/bash with_items : - user1 - user2 - user3 \u793a\u4f8b\u4e8c: \u516c\u94a5\u5f62\u5f0f tasks : - name : ensure admin group group : name : admin state : present - name : ensure admin group nopasswd sudo copy : dest : /etc/sudoers.d/admin content : | %admin ALL=(ALL:ALL) NOPASSWD: ALL - user : name : \"{{ item }}\" groups : admin shell : /bin/bash with_items : - lixie - user : name : \"{{ item }}\" state : absent with_items : - user # - ubuntu - authorized_key : user : \"{{ item.u }}\" key : \"https://github.com/{{ item.k }}.keys\" # \u516c\u94a5\u4e0a\u4f20\u5230github with_items : - { u : lixie , k : lixie021 } \u6267\u884cansible-playbook ansible-playbook -i inventory/pve pve.yaml","title":"**Ansible \u6848\u4f8b**"},{"location":"ansible-case1/#ansible","text":"\u51c6\u5907\u5de5\u4f5c \u914d\u7f6einventory/pve [ pve ] master.pve hostname = master ansible_host = 192 .168.1.11 ansible_ssh_user = root ansible_ssh_pass = \"pass@word1\" \u6e29\u99a8\u63d0\u793a \u53ef\u80fd\u51fa\u73b0sudo\u6743\u9650\u4e0d\u591f\u7684\u95ee\u9898\uff0c\u90a3\u4e48\u53ef\u4ee5\u5728inventory\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9 gtx3090.c1 hostname = ubuntu ansible_ssh_user = xxx ansible_sudo_pass = xxx ansible_ssh_pass = \"password\" ubuntu22.04 \u6267\u884c\u62a5\u9519 TASK [ Gathering Facts ] ******************************************************************************************************* fatal: [ axis ] : FAILED! = > { \"ansible_facts\" : {} , \"changed\" : false, \"failed_modules\" : { \"ansible.legacy.setup\" : { \"failed\" : true, \"module_stderr\" : \"/bin/sh: 1: /usr/bin/python: not found\\n\" , \"module_stdout\" : \"\" , \"msg\" : \"The module failed to execute correctly, you probably need to set the interpreter.\\nSee stdout/stderr for the exact error\" , \"rc\" : 127 }} , \"msg\" : \"The following modules failed to execute: ansible.legacy.setup\\n\" } Ansible \u5e38\u7528\u9009\u9879 -C //\u9884\u6267\u884c --list-hosts //\u5217\u51fa\u6b63\u5728\u8fd0\u884c\u4efb\u52a1\u7684\u4e3b\u673a --list-tasks //\u5217\u51fatasks --limit \u4e3b\u673a\u5217\u8868 //\u53ea\u9488\u5bf9\u7279\u5b9a\u4e3b\u673a\u6267\u884c","title":"Ansible \u6848\u4f8b"},{"location":"ansible-case1/#create_useryaml","text":"Ansible \u6279\u91cf\u521b\u5efa\u7528\u6237 \u8fd9\u91cc\u8bbe\u7f6epassword\u9700\u8981\u4f7f\u7528python\u547d\u4ee4\u751f\u6210sha-512\u7b97\u6cd5,pw\u662f\u8981\u52a0\u5bc6\u7684\u5bc6\u7801 a=$(python3 -c 'import crypt,getpass;pw=\"123456\";print(crypt.crypt(pw))') $ echo $a QUbhMQ9BAGQBE \u793a\u4f8b\u4e00 \u7528\u6237\u5bc6\u7801 - hosts : pve tasks : - name : ensure admin group group : name : admin state : present - name : ensure admin group nopasswd sudo copy : dest : /etc/sudoers.d/admin content : | %admin ALL=(ALL:ALL) NOPASSWD: ALL - name : add user user : name={{ item }} groups=admin password=d6F1o2yfgTymU shell=/bin/bash with_items : - user1 - user2 - user3 \u793a\u4f8b\u4e8c: \u516c\u94a5\u5f62\u5f0f tasks : - name : ensure admin group group : name : admin state : present - name : ensure admin group nopasswd sudo copy : dest : /etc/sudoers.d/admin content : | %admin ALL=(ALL:ALL) NOPASSWD: ALL - user : name : \"{{ item }}\" groups : admin shell : /bin/bash with_items : - lixie - user : name : \"{{ item }}\" state : absent with_items : - user # - ubuntu - authorized_key : user : \"{{ item.u }}\" key : \"https://github.com/{{ item.k }}.keys\" # \u516c\u94a5\u4e0a\u4f20\u5230github with_items : - { u : lixie , k : lixie021 } \u6267\u884cansible-playbook ansible-playbook -i inventory/pve pve.yaml","title":"\u6848\u4f8b\u4e00\uff1acreate_user.yaml"},{"location":"Devops/github/","text":"\u8ba4\u8bc6 Github: \u00b6 Github\u987e\u540d\u601d\u4e49\u662f\u4e00\u4e2aGit\u7248\u672c\u5e93\u7684\u6258\u7ba1\u670d\u52a1\uff0c\u662f\u76ee\u524d\u5168\u7403\u6700\u5927\u7684\u8f6f\u4ef6\u4ed3\u5e93\uff0c\u62e5\u6709\u4e0a\u767e\u4e07\u7684\u5f00\u53d1\u8005\u7528\u6237\uff0c\u4e5f\u662f\u8f6f\u4ef6\u5f00\u53d1\u548c\u5bfb\u627e\u8d44\u6e90\u7684\u6700\u4f73\u9014\u5f84\uff0cGithub\u4e0d\u4ec5\u53ef\u4ee5\u6258\u7ba1\u5404\u79cdGit\u7248\u672c\u4ed3\u5e93\uff0c\u8fd8\u62e5\u6709\u4e86\u66f4\u7f8e\u89c2\u7684Web\u754c\u9762\uff0c\u60a8\u7684\u4ee3\u7801\u6587\u4ef6\u53ef\u4ee5\u88ab\u4efb\u4f55\u4eba\u514b\u9686\uff0c\u4f7f\u5f97\u5f00\u53d1\u8005\u4e3a\u5f00\u6e90\u9879\u8d21\u732e\u4ee3\u7801\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4ed8\u8d39\u8d2d\u4e70\u79c1\u6709\u5e93\uff0c\u8fd9\u6837\u9ad8\u6027\u4ef7\u6bd4\u7684\u79c1\u6709\u5e93\u771f\u7684\u662f\u5e2e\u52a9\u5230\u4e86\u5f88\u591a\u56e2\u961f\u548c\u4f01\u4e1a\u3002 \u4e00\u3001\u6ce8\u518cGithub\u5e10\u53f7 \u00b6 1.1. \u8fdb\u5165github\u7684\u5b98\u7f51: https://github.com/ 1.2. \u70b9\u51fb\u6ce8\u518c\u8d26\u53f7 \u6e29\u99a8\u63d0\u793a \u7528\u6237\u6635\u79f0\uff0c\u5efa\u8bae\u7528\u6709\u7279\u8272\u81ea\u5df1\u7684\uff0c\u800c\u4e14\u4e0d\u8981\u592a\u957f\uff0c\u8981\u597d\u8bb0\uff0c\u4ee5\u540e\u5bf9\u521b\u5efa\u4ed3\u5e93\u6709\u5f88\u5927\u7684\u5e2e\u52a9\u3002 \u7535\u5b50\u90ae\u7bb1\u5730\u5740\uff0c\u586b\u5199\u4f60\u5e38\u7528\u7684\uff0c\u4e0d\u8981\u4e71\u586b\uff0c\u4e00\u4f1a\u662f\u8981\u53d1\u6fc0\u6d3b\u94fe\u63a5\u5230\u4f60\u90ae\u7bb1\u7684\u3002 \u7528\u6237\u5bc6\u7801\uff0c\u786e\u4fdd\u81f3\u5c1115\u4e2a\u5b57\u7b26\u6216\u81f3\u5c118\u4e2a\u5b57\u7b26\uff08 \u5305\u62ec\u6570\u5b57 \u548c\u5c0f\u5199\u5b57\u6bcd\uff09 \u8f93\u5165\u5b8c\u4f1a\u6709\u4e00\u4e2a\u4eba\u673a\u9a8c\u8bc1\uff0c\u4f60\u53ea\u9700\u628a\u56fe\u7247\u77eb\u6b63\u5373\u53ef\u3002 1.3. \u9009\u62e9\u4e2a\u4eba\u7248 1.4. \u9009\u62e9\u5174\u8da3 1.5.\u9a8c\u8bc1\u90ae\u7bb1 \u5230\u8fd9\u91cc\u57fa\u672c\u5c31\u5b8c\u6210\u4e86\u5bf9github\u5e10\u53f7\u7684\u6ce8\u518c\u3002 \u4e8c\u3001\u521b\u5efa\u4ed3\u5e93 \u00b6 2.1. \u65b0\u5efa\u4e00\u4e2a\u516c\u5171\u4ed3\u5e93 2.2. \u521d\u59cb\u5316\u4ed3\u5e93 \u4e09\u3001\u63d0\u4ea4\u4ee3\u7801 \u00b6 Github \u63d0\u4ea4 pr \u4ee3\u7801commit\u89c4\u7ea6: https://www.conventionalcommits.org/zh-hans/v1.0.0/ git checkout -b lixie //\u5207\u6362\u5230lixie\u5206\u652f git add . git status // \u67e5\u770b\u6682\u5b58\u533a\u63d0\u4ea4\u7684\u5185\u5bb9 git commit -m \"feat(ssh): add lixie for sjtu\" git branch git remote origin git branch //\u67e5\u770b\u5206\u652f git push origin lixie //\u5c06\u4ee3\u7801\u4e0a\u4f20\u8fdc\u7a0blixie\u5206\u652f git rebase origin/master git push origin lixie git push origin lixie -f \u5f3a\u5236\u63d0\u4ea4\u5230lixie\u5206\u533a \u56db\u3001\u914d\u7f6e\u516c\u94a5 \u00b6 4.1. \u751f\u6210\u5bc6\u94a5\u5bf9 root@a100-1:/home/lixie# ssh-keygen //\u4e00\u8def\u56de\u8f66 Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.ssh/id_rsa Your public key has been saved in /root/.ssh/id_rsa.pub The key fingerprint is: SHA256:a92LUGI9FIkRl7wUlOVKqh3Xtsigo2XkG8iau0JKHUE root@a100-1 The key's randomart image is: +---[RSA 3072]----+ | .E o*=*. | | . ..*o | | . .o.. | | . =.o | | . . . S * o | | o o + = X = . | |+ o O = + o | |o o + = . . . | | .=o. . . . | +----[SHA256]-----+ // \u5bb6\u76ee\u5f55\u4e0b\u5c31\u4f1a\u751f\u6210\u51e0\u4e2a\u6587\u4ef6 root@a100-1:~# ls .ssh/ authorized_keys id_rsa id_rsa.pub 4.2. \u5c06\u516c\u94a5\u4e0a\u4f20\u5230github \u9700\u8981\u7ed9\u516c\u94a5\u8d77\u4e00\u4e2a\u540d\u79f0\uff0c\u590d\u5236\u81ea\u5df1\u521a\u521a\u521b\u5efa\u7684\u516c\u94a5 \u4e0a\u4f20\u5b8c\u6210\u4e4b\u540e\uff0c\u5c31\u4e0d\u9700\u8981\u63d0\u4ea4\u7684\u65f6\u5019\u518d\u8f93\u5165\u5bc6\u7801\u9a8c\u8bc1\u4e86\u3002windows\u4e5f\u7c7b\u4f3c\u53ef\u4ee5\u81ea\u884c\u767e\u5ea6\u3002 windows \u4f7f\u7528git \u7f51\u7ad9\u5730\u5740: https://git-for-windows.github.io \u4e0b\u8f7d\u5730\u5740: https://github.com/git-for-windows/git/releases/download/v2.22.0.windows.1/Git-2.22.0-64-bit.exe","title":"Github"},{"location":"Devops/github/#github","text":"Github\u987e\u540d\u601d\u4e49\u662f\u4e00\u4e2aGit\u7248\u672c\u5e93\u7684\u6258\u7ba1\u670d\u52a1\uff0c\u662f\u76ee\u524d\u5168\u7403\u6700\u5927\u7684\u8f6f\u4ef6\u4ed3\u5e93\uff0c\u62e5\u6709\u4e0a\u767e\u4e07\u7684\u5f00\u53d1\u8005\u7528\u6237\uff0c\u4e5f\u662f\u8f6f\u4ef6\u5f00\u53d1\u548c\u5bfb\u627e\u8d44\u6e90\u7684\u6700\u4f73\u9014\u5f84\uff0cGithub\u4e0d\u4ec5\u53ef\u4ee5\u6258\u7ba1\u5404\u79cdGit\u7248\u672c\u4ed3\u5e93\uff0c\u8fd8\u62e5\u6709\u4e86\u66f4\u7f8e\u89c2\u7684Web\u754c\u9762\uff0c\u60a8\u7684\u4ee3\u7801\u6587\u4ef6\u53ef\u4ee5\u88ab\u4efb\u4f55\u4eba\u514b\u9686\uff0c\u4f7f\u5f97\u5f00\u53d1\u8005\u4e3a\u5f00\u6e90\u9879\u8d21\u732e\u4ee3\u7801\u53d8\u5f97\u66f4\u52a0\u5bb9\u6613\uff0c\u5f53\u7136\u4e5f\u53ef\u4ee5\u4ed8\u8d39\u8d2d\u4e70\u79c1\u6709\u5e93\uff0c\u8fd9\u6837\u9ad8\u6027\u4ef7\u6bd4\u7684\u79c1\u6709\u5e93\u771f\u7684\u662f\u5e2e\u52a9\u5230\u4e86\u5f88\u591a\u56e2\u961f\u548c\u4f01\u4e1a\u3002","title":"\u8ba4\u8bc6 Github:"},{"location":"Devops/github/#github_1","text":"1.1. \u8fdb\u5165github\u7684\u5b98\u7f51: https://github.com/ 1.2. \u70b9\u51fb\u6ce8\u518c\u8d26\u53f7 \u6e29\u99a8\u63d0\u793a \u7528\u6237\u6635\u79f0\uff0c\u5efa\u8bae\u7528\u6709\u7279\u8272\u81ea\u5df1\u7684\uff0c\u800c\u4e14\u4e0d\u8981\u592a\u957f\uff0c\u8981\u597d\u8bb0\uff0c\u4ee5\u540e\u5bf9\u521b\u5efa\u4ed3\u5e93\u6709\u5f88\u5927\u7684\u5e2e\u52a9\u3002 \u7535\u5b50\u90ae\u7bb1\u5730\u5740\uff0c\u586b\u5199\u4f60\u5e38\u7528\u7684\uff0c\u4e0d\u8981\u4e71\u586b\uff0c\u4e00\u4f1a\u662f\u8981\u53d1\u6fc0\u6d3b\u94fe\u63a5\u5230\u4f60\u90ae\u7bb1\u7684\u3002 \u7528\u6237\u5bc6\u7801\uff0c\u786e\u4fdd\u81f3\u5c1115\u4e2a\u5b57\u7b26\u6216\u81f3\u5c118\u4e2a\u5b57\u7b26\uff08 \u5305\u62ec\u6570\u5b57 \u548c\u5c0f\u5199\u5b57\u6bcd\uff09 \u8f93\u5165\u5b8c\u4f1a\u6709\u4e00\u4e2a\u4eba\u673a\u9a8c\u8bc1\uff0c\u4f60\u53ea\u9700\u628a\u56fe\u7247\u77eb\u6b63\u5373\u53ef\u3002 1.3. \u9009\u62e9\u4e2a\u4eba\u7248 1.4. \u9009\u62e9\u5174\u8da3 1.5.\u9a8c\u8bc1\u90ae\u7bb1 \u5230\u8fd9\u91cc\u57fa\u672c\u5c31\u5b8c\u6210\u4e86\u5bf9github\u5e10\u53f7\u7684\u6ce8\u518c\u3002","title":"\u4e00\u3001\u6ce8\u518cGithub\u5e10\u53f7"},{"location":"Devops/github/#_1","text":"2.1. \u65b0\u5efa\u4e00\u4e2a\u516c\u5171\u4ed3\u5e93 2.2. \u521d\u59cb\u5316\u4ed3\u5e93","title":"\u4e8c\u3001\u521b\u5efa\u4ed3\u5e93"},{"location":"Devops/github/#_2","text":"Github \u63d0\u4ea4 pr \u4ee3\u7801commit\u89c4\u7ea6: https://www.conventionalcommits.org/zh-hans/v1.0.0/ git checkout -b lixie //\u5207\u6362\u5230lixie\u5206\u652f git add . git status // \u67e5\u770b\u6682\u5b58\u533a\u63d0\u4ea4\u7684\u5185\u5bb9 git commit -m \"feat(ssh): add lixie for sjtu\" git branch git remote origin git branch //\u67e5\u770b\u5206\u652f git push origin lixie //\u5c06\u4ee3\u7801\u4e0a\u4f20\u8fdc\u7a0blixie\u5206\u652f git rebase origin/master git push origin lixie git push origin lixie -f \u5f3a\u5236\u63d0\u4ea4\u5230lixie\u5206\u533a","title":"\u4e09\u3001\u63d0\u4ea4\u4ee3\u7801"},{"location":"Devops/github/#_3","text":"4.1. \u751f\u6210\u5bc6\u94a5\u5bf9 root@a100-1:/home/lixie# ssh-keygen //\u4e00\u8def\u56de\u8f66 Generating public/private rsa key pair. Enter file in which to save the key (/root/.ssh/id_rsa): Enter passphrase (empty for no passphrase): Enter same passphrase again: Your identification has been saved in /root/.ssh/id_rsa Your public key has been saved in /root/.ssh/id_rsa.pub The key fingerprint is: SHA256:a92LUGI9FIkRl7wUlOVKqh3Xtsigo2XkG8iau0JKHUE root@a100-1 The key's randomart image is: +---[RSA 3072]----+ | .E o*=*. | | . ..*o | | . .o.. | | . =.o | | . . . S * o | | o o + = X = . | |+ o O = + o | |o o + = . . . | | .=o. . . . | +----[SHA256]-----+ // \u5bb6\u76ee\u5f55\u4e0b\u5c31\u4f1a\u751f\u6210\u51e0\u4e2a\u6587\u4ef6 root@a100-1:~# ls .ssh/ authorized_keys id_rsa id_rsa.pub 4.2. \u5c06\u516c\u94a5\u4e0a\u4f20\u5230github \u9700\u8981\u7ed9\u516c\u94a5\u8d77\u4e00\u4e2a\u540d\u79f0\uff0c\u590d\u5236\u81ea\u5df1\u521a\u521a\u521b\u5efa\u7684\u516c\u94a5 \u4e0a\u4f20\u5b8c\u6210\u4e4b\u540e\uff0c\u5c31\u4e0d\u9700\u8981\u63d0\u4ea4\u7684\u65f6\u5019\u518d\u8f93\u5165\u5bc6\u7801\u9a8c\u8bc1\u4e86\u3002windows\u4e5f\u7c7b\u4f3c\u53ef\u4ee5\u81ea\u884c\u767e\u5ea6\u3002 windows \u4f7f\u7528git \u7f51\u7ad9\u5730\u5740: https://git-for-windows.github.io \u4e0b\u8f7d\u5730\u5740: https://github.com/git-for-windows/git/releases/download/v2.22.0.windows.1/Git-2.22.0-64-bit.exe","title":"\u56db\u3001\u914d\u7f6e\u516c\u94a5"},{"location":"Helm/helm-install/","text":"Helm \u00b6 Helm \u7b80\u4ecb \u00b6 Helm \u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u7ba1\u7406 Kubernetes \u5e94\u7528\u7a0b\u5e8f - Helm Charts \u53ef\u4ee5\u5b9a\u4e49\u3001\u5b89\u88c5\u548c\u5347\u7ea7\u590d\u6742\u7684 Kubernetes \u5e94\u7528\u7a0b\u5e8f\uff0cCharts \u5305\u5f88\u5bb9\u6613\u521b\u5efa\u3001\u7248\u672c\u7ba1\u7406\u3001\u5206\u4eab\u548c\u5206\u5e03. \u7b80\u5355\u53ef\u4ee5\u7406\u89e3Linux\u4e2dyum\u7684\u7684\u611f\u89c9 Helm \u5b89\u88c5 \u00b6 \u83b7\u53d6\u8f6f\u4ef6 \u5b98\u7f51\u5730\u5740\uff1ahttps://github.com/helm/helm/releases \u4e0b\u8f7d\u5230\u672c\u5730\u89e3\u538b\u540e\uff0c\u5c06 helm \u4e8c\u8fdb\u5236\u5305\u6587\u4ef6\u79fb\u52a8\u5230\u4efb\u610f\u7684 PATH \u8def\u5f84\u4e0b $ helm version version.BuildInfo{Version:\"v3.9.0\", GitCommit:\"7ceeda6c585217a19a1131663d8cd1f7d641b2a7\", GitTreeState:\"clean\", GoVersion:\"go1.18.2\"} Linux \u4e0b\u5b89\u88c5 root@k8s-master:/opt# wget https://get.helm.sh/helm-v3.8.1-linux-amd64.tar.gz cni containerd helm-v3.8.1-linux-amd64.tar.gz root@k8s-master:/opt# tar -xf helm-v3.8.1-linux-amd64.tar.gz root@k8s-master:/opt/linux-amd64# mv helm /usr/bin/ \u7ba1\u7406\u914d\u7f6e \u00b6 Chart\u56fd\u5185\u4ed3\u5e93\u914d\u7f6e \u00b6 \u4ed3\u5e93\u914d\u7f6e \u5fae\u8f6f\u7684\u6e90\uff1ahttp://mirror.azure.cn/kubernetes/charts/ \u963f\u91cc\u7684\u6e90\uff1ahttps://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts \u5b98\u65b9\u7684\u6e90\uff1ahttps://hub.kubeapps.com/charts/incubator \u6dfb\u52a0chart\u5b58\u50a8\u5e93 \u00b6 helm repo add stable http://mirror.azure.cn/kubernetes/charts helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts root@k8s-master:/opt/linux-amd64# helm repo update # \u66f4\u65b0\u6e90 \u67e5\u770b\u5b58\u50a8\u5e93 \u00b6 $ helm repo list NAME URL stable http://mirror.azure.cn/kubernetes/charts/ openbayes https://dev.openbayes.com/charts \u5220\u9664\u5b58\u50a8\u5e93 \u00b6 root@k8s-master:/opt/linux-amd64# helm repo remove aliyun Helm \u90e8\u7f72\u5e94\u7528: \u00b6 Helm \u90e8\u7f72traefix \u00b6 \u90e8\u7f72traefik \u6587\u7ae0\u53c2\u8003: https://github.com/traefik/traefik-helm-chart git clone https://github.com/traefik/traefik-helm-chart.git \u5b9a\u4e49values\u6587\u4ef6 $ cat sjtu-traefik.yaml image : name : traefik tag : \"2.7\" # values-prod.yaml # Create an IngressRoute for the dashboard ingressRoute : dashboard : enabled : false # \u7981\u7528helm\u4e2d\u6e32\u67d3\u7684dashboard\uff0c\u6211\u4eec\u81ea\u5df1\u624b\u52a8\u521b\u5efa # Configure ports ports : web : port : 8000 hostPort : 80 # \u4f7f\u7528 hostport \u6a21\u5f0f # Use nodeport if set. This is useful if you have configured Traefik in a # LoadBalancer # nodePort: 32080 # Port Redirections # Added in 2.2, you can make permanent redirects via entrypoints. # https://docs.traefik.io/routing/entrypoints/#redirection # redirectTo: websecure websecure : port : 8443 hostPort : 443 # \u4f7f\u7528 hostport \u6a21\u5f0f # Options for the main traefik service, where the entrypoints traffic comes # from. service : # \u4f7f\u7528 hostport \u6a21\u5f0f\u5c31\u4e0d\u9700\u8981Service\u4e86 enabled : false # Logs # https://docs.traefik.io/observability/logs/ #logs: # general: # level: DEBUG tolerations : # kubeadm \u5b89\u88c5\u7684\u96c6\u7fa4\u9ed8\u8ba4\u60c5\u51b5\u4e0bmaster\u662f\u6709\u6c61\u70b9\uff0c\u9700\u8981\u5bb9\u5fcd\u8fd9\u4e2a\u6c61\u70b9\u624d\u53ef\u4ee5\u90e8\u7f72 - key : \"node-role.kubernetes.io/master\" operator : \"Equal\" effect : \"NoSchedule\" nodeSelector : # \u56fa\u5b9a\u5230master1\u8282\u70b9\uff08\u8be5\u8282\u70b9\u624d\u53ef\u4ee5\u8bbf\u95ee\u5916\u7f51\uff09 kubernetes.io/hostname : \"master\" \u90e8\u7f72traefik helm upgrade --install traefik traefik/traefik -f ./traefik/values/sjtu-traefik.yaml --namespace kube-system \u67e5\u770b\u8fd9\u6b21\u90e8\u7f72 \u6e29\u99a8\u63d0\u793a \u8fd9\u4e2a\u662f\u6709\u547d\u540d\u7a7a\u95f4\u9650\u5236\u7684\uff0c-A \u53ef\u4ee5\u67e5\u770b\u6240\u6709helm release $ helm list -A NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION traefik kube-system 5 2022-07-08 19:08:15.393244 +0800 CST deployed traefik-10.24.0 2.8.0 Helm \u5347\u7ea7\u56de\u6eda \u00b6 \u5347\u7ea7 \u00b6 \u4e3e\u4f8b\u8bf4\u660e \u4f8b\u5982\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u6765\u5347\u7ea7grafana\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7--set \u5728\u540e\u9762\u4f20\u53c2\u6570 helm upgrade --install grafana grafana/grafana \u6ce8\u610f\u4e8b\u9879 \u5728\u5347\u7ea7\u5e94\u7528\u7a0b\u5e8f\u4e4b\u524d\u53ef\u4ee5\u901a\u8fc7diff\u7684\u65b9\u5f0f\u6765\u67e5\u770b\u4e24\u4e2a\u7248\u672c\u7684\u533a\u522b\uff0c\u786e\u5b9a\u6ca1\u95ee\u9898\uff0c\u518d\u5347\u7ea7 $ helm diff upgrade --install grafana grafana/grafana -f ./grafana.yaml -n infra \u56de\u6eda \u00b6 helm rollback version-id \u65e0\u8bba\u662f\u5347\u7ea7\u8fd8\u662f\u56de\u6eda\u90fd\u662f\u6709\u4e00\u4e2a\u7684\u98ce\u9669\u7684\uff0c\u6ce8\u610f\u9632\u6b62\u8bef\u64cd\u4f5c\u3002","title":"Helm \u7b80\u4ecb\u4e0e\u5b89\u88c5"},{"location":"Helm/helm-install/#helm","text":"","title":"Helm"},{"location":"Helm/helm-install/#helm_1","text":"Helm \u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u7ba1\u7406 Kubernetes \u5e94\u7528\u7a0b\u5e8f - Helm Charts \u53ef\u4ee5\u5b9a\u4e49\u3001\u5b89\u88c5\u548c\u5347\u7ea7\u590d\u6742\u7684 Kubernetes \u5e94\u7528\u7a0b\u5e8f\uff0cCharts \u5305\u5f88\u5bb9\u6613\u521b\u5efa\u3001\u7248\u672c\u7ba1\u7406\u3001\u5206\u4eab\u548c\u5206\u5e03. \u7b80\u5355\u53ef\u4ee5\u7406\u89e3Linux\u4e2dyum\u7684\u7684\u611f\u89c9","title":"Helm \u7b80\u4ecb"},{"location":"Helm/helm-install/#helm_2","text":"\u83b7\u53d6\u8f6f\u4ef6 \u5b98\u7f51\u5730\u5740\uff1ahttps://github.com/helm/helm/releases \u4e0b\u8f7d\u5230\u672c\u5730\u89e3\u538b\u540e\uff0c\u5c06 helm \u4e8c\u8fdb\u5236\u5305\u6587\u4ef6\u79fb\u52a8\u5230\u4efb\u610f\u7684 PATH \u8def\u5f84\u4e0b $ helm version version.BuildInfo{Version:\"v3.9.0\", GitCommit:\"7ceeda6c585217a19a1131663d8cd1f7d641b2a7\", GitTreeState:\"clean\", GoVersion:\"go1.18.2\"} Linux \u4e0b\u5b89\u88c5 root@k8s-master:/opt# wget https://get.helm.sh/helm-v3.8.1-linux-amd64.tar.gz cni containerd helm-v3.8.1-linux-amd64.tar.gz root@k8s-master:/opt# tar -xf helm-v3.8.1-linux-amd64.tar.gz root@k8s-master:/opt/linux-amd64# mv helm /usr/bin/","title":"Helm \u5b89\u88c5"},{"location":"Helm/helm-install/#_1","text":"","title":"\u7ba1\u7406\u914d\u7f6e"},{"location":"Helm/helm-install/#chart","text":"\u4ed3\u5e93\u914d\u7f6e \u5fae\u8f6f\u7684\u6e90\uff1ahttp://mirror.azure.cn/kubernetes/charts/ \u963f\u91cc\u7684\u6e90\uff1ahttps://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts \u5b98\u65b9\u7684\u6e90\uff1ahttps://hub.kubeapps.com/charts/incubator","title":"Chart\u56fd\u5185\u4ed3\u5e93\u914d\u7f6e"},{"location":"Helm/helm-install/#chart_1","text":"helm repo add stable http://mirror.azure.cn/kubernetes/charts helm repo add aliyun https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts root@k8s-master:/opt/linux-amd64# helm repo update # \u66f4\u65b0\u6e90","title":"\u6dfb\u52a0chart\u5b58\u50a8\u5e93"},{"location":"Helm/helm-install/#_2","text":"$ helm repo list NAME URL stable http://mirror.azure.cn/kubernetes/charts/ openbayes https://dev.openbayes.com/charts","title":"\u67e5\u770b\u5b58\u50a8\u5e93"},{"location":"Helm/helm-install/#_3","text":"root@k8s-master:/opt/linux-amd64# helm repo remove aliyun","title":"\u5220\u9664\u5b58\u50a8\u5e93"},{"location":"Helm/helm-install/#helm_3","text":"","title":"Helm \u90e8\u7f72\u5e94\u7528:"},{"location":"Helm/helm-install/#helm-traefix","text":"\u90e8\u7f72traefik \u6587\u7ae0\u53c2\u8003: https://github.com/traefik/traefik-helm-chart git clone https://github.com/traefik/traefik-helm-chart.git \u5b9a\u4e49values\u6587\u4ef6 $ cat sjtu-traefik.yaml image : name : traefik tag : \"2.7\" # values-prod.yaml # Create an IngressRoute for the dashboard ingressRoute : dashboard : enabled : false # \u7981\u7528helm\u4e2d\u6e32\u67d3\u7684dashboard\uff0c\u6211\u4eec\u81ea\u5df1\u624b\u52a8\u521b\u5efa # Configure ports ports : web : port : 8000 hostPort : 80 # \u4f7f\u7528 hostport \u6a21\u5f0f # Use nodeport if set. This is useful if you have configured Traefik in a # LoadBalancer # nodePort: 32080 # Port Redirections # Added in 2.2, you can make permanent redirects via entrypoints. # https://docs.traefik.io/routing/entrypoints/#redirection # redirectTo: websecure websecure : port : 8443 hostPort : 443 # \u4f7f\u7528 hostport \u6a21\u5f0f # Options for the main traefik service, where the entrypoints traffic comes # from. service : # \u4f7f\u7528 hostport \u6a21\u5f0f\u5c31\u4e0d\u9700\u8981Service\u4e86 enabled : false # Logs # https://docs.traefik.io/observability/logs/ #logs: # general: # level: DEBUG tolerations : # kubeadm \u5b89\u88c5\u7684\u96c6\u7fa4\u9ed8\u8ba4\u60c5\u51b5\u4e0bmaster\u662f\u6709\u6c61\u70b9\uff0c\u9700\u8981\u5bb9\u5fcd\u8fd9\u4e2a\u6c61\u70b9\u624d\u53ef\u4ee5\u90e8\u7f72 - key : \"node-role.kubernetes.io/master\" operator : \"Equal\" effect : \"NoSchedule\" nodeSelector : # \u56fa\u5b9a\u5230master1\u8282\u70b9\uff08\u8be5\u8282\u70b9\u624d\u53ef\u4ee5\u8bbf\u95ee\u5916\u7f51\uff09 kubernetes.io/hostname : \"master\" \u90e8\u7f72traefik helm upgrade --install traefik traefik/traefik -f ./traefik/values/sjtu-traefik.yaml --namespace kube-system \u67e5\u770b\u8fd9\u6b21\u90e8\u7f72 \u6e29\u99a8\u63d0\u793a \u8fd9\u4e2a\u662f\u6709\u547d\u540d\u7a7a\u95f4\u9650\u5236\u7684\uff0c-A \u53ef\u4ee5\u67e5\u770b\u6240\u6709helm release $ helm list -A NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION traefik kube-system 5 2022-07-08 19:08:15.393244 +0800 CST deployed traefik-10.24.0 2.8.0","title":"Helm \u90e8\u7f72traefix"},{"location":"Helm/helm-install/#helm_4","text":"","title":"Helm \u5347\u7ea7\u56de\u6eda"},{"location":"Helm/helm-install/#_4","text":"\u4e3e\u4f8b\u8bf4\u660e \u4f8b\u5982\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u6765\u5347\u7ea7grafana\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7--set \u5728\u540e\u9762\u4f20\u53c2\u6570 helm upgrade --install grafana grafana/grafana \u6ce8\u610f\u4e8b\u9879 \u5728\u5347\u7ea7\u5e94\u7528\u7a0b\u5e8f\u4e4b\u524d\u53ef\u4ee5\u901a\u8fc7diff\u7684\u65b9\u5f0f\u6765\u67e5\u770b\u4e24\u4e2a\u7248\u672c\u7684\u533a\u522b\uff0c\u786e\u5b9a\u6ca1\u95ee\u9898\uff0c\u518d\u5347\u7ea7 $ helm diff upgrade --install grafana grafana/grafana -f ./grafana.yaml -n infra","title":"\u5347\u7ea7"},{"location":"Helm/helm-install/#_5","text":"helm rollback version-id \u65e0\u8bba\u662f\u5347\u7ea7\u8fd8\u662f\u56de\u6eda\u90fd\u662f\u6709\u4e00\u4e2a\u7684\u98ce\u9669\u7684\uff0c\u6ce8\u610f\u9632\u6b62\u8bef\u64cd\u4f5c\u3002","title":"\u56de\u6eda"},{"location":"Helm/helm/","text":"Helm \u914d\u7f6egrafana \u00b6 \u83b7\u53d6Token \u00b6 \u53c2\u8003: \u5b98\u7f51 curl -X POST -H \"Content-Type: application/json\" -d '{\"name\":\"apikeycurl\", \"role\": \"Admin\"}' http://admin:strongpassword@localhost:3000/api/auth/keys {\"id\":1,\"name\":\"apikeycurl\",\"key\":\"eyJrIjoiVHV2czQxNTdiQnFEWDJ6VjRXMjJpUTc1bGtkR2NmQUoiLCJuIjoiYXBpa2V5Y3VybCIsImlkIjoxfQ==\"}% \u6253\u5f00dashboardProviders \u00b6 \u6ce8\u610f \u6ce8\u610f\u53bb\u6389dashboardProviders\u540e\u9762\u7684{} dashboardProviders : dashboardproviders.yaml : apiVersion : 1 providers : - name : 'default' orgId : 1 folder : '' type : file disableDeletion : false editable : true options : path : /var/lib/grafana/dashboards/default # \u6dfb\u52a0\u5b98\u7f51dashboard dashboards : default : ceph-cluster : gnetId : 2842 revision : 14 datasource : Prometheus ceph-osd : gnetId : 5336 revision : 5 datasource : Prometheus ceph-pools : gnetId : 5342 revision : 5 datasource : Prometheus token : 'eyJrIjoiVHV2czQxNTdiQnFEWDJ6VjRXMjJpUTc1bGtkR2NmQUoiLCJuIjoiYXBpa2V5Y3VybCIsImlkIjoxfQ=='","title":"Helm \u914d\u7f6egrafana"},{"location":"Helm/helm/#helm-grafana","text":"","title":"Helm \u914d\u7f6egrafana"},{"location":"Helm/helm/#token","text":"\u53c2\u8003: \u5b98\u7f51 curl -X POST -H \"Content-Type: application/json\" -d '{\"name\":\"apikeycurl\", \"role\": \"Admin\"}' http://admin:strongpassword@localhost:3000/api/auth/keys {\"id\":1,\"name\":\"apikeycurl\",\"key\":\"eyJrIjoiVHV2czQxNTdiQnFEWDJ6VjRXMjJpUTc1bGtkR2NmQUoiLCJuIjoiYXBpa2V5Y3VybCIsImlkIjoxfQ==\"}%","title":"\u83b7\u53d6Token"},{"location":"Helm/helm/#dashboardproviders","text":"\u6ce8\u610f \u6ce8\u610f\u53bb\u6389dashboardProviders\u540e\u9762\u7684{} dashboardProviders : dashboardproviders.yaml : apiVersion : 1 providers : - name : 'default' orgId : 1 folder : '' type : file disableDeletion : false editable : true options : path : /var/lib/grafana/dashboards/default # \u6dfb\u52a0\u5b98\u7f51dashboard dashboards : default : ceph-cluster : gnetId : 2842 revision : 14 datasource : Prometheus ceph-osd : gnetId : 5336 revision : 5 datasource : Prometheus ceph-pools : gnetId : 5342 revision : 5 datasource : Prometheus token : 'eyJrIjoiVHV2czQxNTdiQnFEWDJ6VjRXMjJpUTc1bGtkR2NmQUoiLCJuIjoiYXBpa2V5Y3VybCIsImlkIjoxfQ=='","title":"\u6253\u5f00dashboardProviders"},{"location":"Macuse/mac-easy/","text":"Mac \u73af\u5883\u914d\u7f6e \u00b6 \u80cc\u666f \u00b6 \u5728\u7ef4\u62a4\u548c\u7ba1\u7406\u591a\u4e2ak8s\u96c6\u7fa4\u65f6\uff0c\u6bcf\u4e2a\u96c6\u7fa4\u90fd\u6709\u81ea\u5df1\u5bf9\u5e94\u7684config\u6587\u4ef6\uff0c\u90a3\u4e48\u5e26\u6765\u7684\u95ee\u9898\u5c31\u662f\u5728 ~/.kube \u76ee\u5f55\u4e0b\u5c31\u4f1a\u6709\u4e00\u5927\u5806\u5404\u79cd\u73af\u5883\u7684 yaml\uff0c\u5bf9\u4e8e\u7ba1\u7406\u6765\u8bf4\u4e0d\u662f\u7279\u522b\u7684\u53cb\u597d\u3002 \u66f4\u6709\u53ef\u80fd\u5728\u4e0d\u540c\u7684\u96c6\u7fa4\u5207\u6765\u5207\u53bb\uff0c\u9020\u6210\u8fd0\u7ef4\u4e8b\u6545\u3002 kubecm \u7528\u6cd5 \u89e3\u51b3\u7684\u75db\u70b9\u95ee\u9898\uff1a \u7edf\u4e00\u7ba1\u7406\u591a\u4e2ak8s\u96c6\u7fa4 \u6765\u56de\u5207\u6362\u6307\u5b9anamespace\u7e41\u7410 \u5f88\u591a\u65f6\u5019\u4e0d\u77e5\u9053\u81ea\u5df1\u5728\u54ea\u4e2a\u96c6\u7fa4\u4e0b \u5b89\u88c5 \u00b6 Mac\u5b89\u88c5\u5730\u5740\uff1a kubecm https://formulae.brew.sh/formula/kubecm \u4e0b\u8f7d\u597d\u4e86\uff0c\u5982\u4f55\u4f7f\u7528\uff1f \u4f7f\u7528\u8bf4\u660e\uff1a kubecm github\u5730\u5740 kubecm \u6848\u4f8b \u00b6 \u53c2\u6570\u8bf4\u660e\uff1a \u6211\u6700\u5e38\u7528\u7684\u5c31\u662f\u6dfb\u52a0\uff0c\u5220\u9664\uff0c\u5207\u6362\u96c6\u7fa4 Manage your kubeconfig more easily. \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588 \u2588\u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588\u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588 \u2588\u2588 Tips Find more information at: https://kubecm.cloud Usage: kubecm [ command ] Available Commands: add Add KubeConfig to $HOME /.kube/config # \u6dfb\u52a0 alias Generate alias for all contexts clear Clear lapsed context, cluster and user cloud manage kubeconfig from cloud completion Generate completion script create Create new KubeConfig ( experiment ) delete Delete the specified context from the kubeconfig # \u5220\u9664 help Help about any command list List KubeConfig merge Merge multiple kubeconfig files into one namespace Switch or change namespace interactively rename Rename the contexts of kubeconfig switch Switch Kube Context interactively # \u5207\u6362 version Print version info Flags: --config string path of kubeconfig ( default \" $HOME /.kube/config\" ) -h, --help help for kubecm --ui-size int number of list items to show in menu at once ( default 4 ) Use \"kubecm [command] --help\" for more information about a command. \u9996\u5148\u6211\u4eec\u5148\u56de\u5230\uff1a\u5bb6\u76ee\u5f55\u4e0b\u7684 .kube \u76ee\u5f55 $ pwd /Users/beiyiwangdejiyi/.kube \u6dfb\u52a0\u4e00\u4e2a\u96c6\u7fa4 \u00b6 kubecm add -f enflame.yaml \u5220\u9664\u4e00\u4e2a\u96c6\u7fa4 \u00b6 $ kubecm delete # \u9009\u62e9\u5220\u9664\u7684\u96c6\u7fa4\uff0c\u9009\u62e9True Use the arrow keys to navigate: \u2193 \u2191 \u2192 \u2190 and / toggles search Select The Delete Kube Context \ud83d\ude3c ucloud-k3s ( * ) enflame produce \u2193 pve \u5207\u6362\u4e00\u4e2a\u96c6\u7fa4 \u00b6 $ kubecm switch # \u53ef\u4ee5\u4e0a\u4e0b\u5207\u6362\uff0c\u9009\u62e9\u96c6\u7fa4\u73af\u5883 Use the arrow keys to navigate: \u2193 \u2191 \u2192 \u2190 and / toggles search Select Kube Context ucloud-k3s ( * ) bj \ud83d\ude3c dev \u2193 produce \u4ee5\u4e0a\u5c31\u662fkubecm \u7684\u4e00\u4e9b\u5b89\u88c5\u548c\u4f7f\u7528\u65b9\u6cd5\uff0c\u5176\u4ed6\u7684\u5982\u679c\u611f\u5174\u8da3\u53ef\u4ee5\u81ea\u5df1\u8bd5\u4e00\u8bd5\u3002 kubens kubectx \u6587\u7ae0\u5730\u5740\uff1a kubenc kubectx\u5b89\u88c5 \u00b6 \u5982\u679c\u4f60\u4f7f\u7528Homebrew\uff0c\u4f60\u53ef\u4ee5\u50cf\u8fd9\u6837\u5b89\u88c5\uff1a brew install kubectx \u5b89\u88c5\u5b8c\u6210\u4e4b\u540e\uff0c\u6765\u8fd9\u6837\u4f7f\u7528kubens\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5207\u6362namespace\u3002 fzf\u5b89\u88c5 \u00b6 fzf \u5b89\u88c5 fzf\u5b98\u7f51 \u8fd9\u91cc\u9762\u6bd4\u8f83\u597d\u73a9\u7684\u8fd8\u6709\u4e00\u4e2a\u5e26\u6709\u6a21\u7cca\u641c\u7d22\u7684\u4ea4\u4e92\u5f0f\u83dc\u5355\uff0c\u5b89\u88c5\u5b8c\u6210\u4e4b\u540e\u518d\u4f7f\u7528kubens\u5c31\u9999\u7684\u5f88\u554a brew install fzf $( brew --prefix ) /opt/fzf/install \u6e29\u99a8\u63d0\u793a \u5982\u679c\u4e0d\u80fd\u4f7f\u7528\uff0c\u9700\u8981\u5173\u95ed\u7ec8\u7aef\uff0c\u91cd\u65b0\u6253\u5f00 fzf\u9664\u4e86\u8fd9\u4e9b\uff0c\u8fd8\u6709\u5f88\u591a\u7684\u9a9a\u64cd\u4f5c\uff0cshell\u547d\u4ee4\u8865\u5168\uff0c\u53e6\u5916fzf \u91cd\u5199\u4e86 ctrl+r \u641c\u7d22\u5386\u53f2\u547d\u4ee4 word\u6587\u4ef6\u4fee\u590d \u00b6 \u53c2\u8003\u5730\u5740 https://www.51cto.com/article/708448.html","title":"Mac \u5c0f\u529f\u80fd"},{"location":"Macuse/mac-easy/#mac","text":"","title":"Mac \u73af\u5883\u914d\u7f6e"},{"location":"Macuse/mac-easy/#_1","text":"\u5728\u7ef4\u62a4\u548c\u7ba1\u7406\u591a\u4e2ak8s\u96c6\u7fa4\u65f6\uff0c\u6bcf\u4e2a\u96c6\u7fa4\u90fd\u6709\u81ea\u5df1\u5bf9\u5e94\u7684config\u6587\u4ef6\uff0c\u90a3\u4e48\u5e26\u6765\u7684\u95ee\u9898\u5c31\u662f\u5728 ~/.kube \u76ee\u5f55\u4e0b\u5c31\u4f1a\u6709\u4e00\u5927\u5806\u5404\u79cd\u73af\u5883\u7684 yaml\uff0c\u5bf9\u4e8e\u7ba1\u7406\u6765\u8bf4\u4e0d\u662f\u7279\u522b\u7684\u53cb\u597d\u3002 \u66f4\u6709\u53ef\u80fd\u5728\u4e0d\u540c\u7684\u96c6\u7fa4\u5207\u6765\u5207\u53bb\uff0c\u9020\u6210\u8fd0\u7ef4\u4e8b\u6545\u3002 kubecm \u7528\u6cd5 \u89e3\u51b3\u7684\u75db\u70b9\u95ee\u9898\uff1a \u7edf\u4e00\u7ba1\u7406\u591a\u4e2ak8s\u96c6\u7fa4 \u6765\u56de\u5207\u6362\u6307\u5b9anamespace\u7e41\u7410 \u5f88\u591a\u65f6\u5019\u4e0d\u77e5\u9053\u81ea\u5df1\u5728\u54ea\u4e2a\u96c6\u7fa4\u4e0b","title":"\u80cc\u666f"},{"location":"Macuse/mac-easy/#_2","text":"Mac\u5b89\u88c5\u5730\u5740\uff1a kubecm https://formulae.brew.sh/formula/kubecm \u4e0b\u8f7d\u597d\u4e86\uff0c\u5982\u4f55\u4f7f\u7528\uff1f \u4f7f\u7528\u8bf4\u660e\uff1a kubecm github\u5730\u5740","title":"\u5b89\u88c5"},{"location":"Macuse/mac-easy/#kubecm","text":"\u53c2\u6570\u8bf4\u660e\uff1a \u6211\u6700\u5e38\u7528\u7684\u5c31\u662f\u6dfb\u52a0\uff0c\u5220\u9664\uff0c\u5207\u6362\u96c6\u7fa4 Manage your kubeconfig more easily. \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588 \u2588\u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588\u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588\u2588\u2588\u2588\u2588 \u2588\u2588 \u2588\u2588 Tips Find more information at: https://kubecm.cloud Usage: kubecm [ command ] Available Commands: add Add KubeConfig to $HOME /.kube/config # \u6dfb\u52a0 alias Generate alias for all contexts clear Clear lapsed context, cluster and user cloud manage kubeconfig from cloud completion Generate completion script create Create new KubeConfig ( experiment ) delete Delete the specified context from the kubeconfig # \u5220\u9664 help Help about any command list List KubeConfig merge Merge multiple kubeconfig files into one namespace Switch or change namespace interactively rename Rename the contexts of kubeconfig switch Switch Kube Context interactively # \u5207\u6362 version Print version info Flags: --config string path of kubeconfig ( default \" $HOME /.kube/config\" ) -h, --help help for kubecm --ui-size int number of list items to show in menu at once ( default 4 ) Use \"kubecm [command] --help\" for more information about a command. \u9996\u5148\u6211\u4eec\u5148\u56de\u5230\uff1a\u5bb6\u76ee\u5f55\u4e0b\u7684 .kube \u76ee\u5f55 $ pwd /Users/beiyiwangdejiyi/.kube","title":"kubecm \u6848\u4f8b"},{"location":"Macuse/mac-easy/#_3","text":"kubecm add -f enflame.yaml","title":"\u6dfb\u52a0\u4e00\u4e2a\u96c6\u7fa4"},{"location":"Macuse/mac-easy/#_4","text":"$ kubecm delete # \u9009\u62e9\u5220\u9664\u7684\u96c6\u7fa4\uff0c\u9009\u62e9True Use the arrow keys to navigate: \u2193 \u2191 \u2192 \u2190 and / toggles search Select The Delete Kube Context \ud83d\ude3c ucloud-k3s ( * ) enflame produce \u2193 pve","title":"\u5220\u9664\u4e00\u4e2a\u96c6\u7fa4"},{"location":"Macuse/mac-easy/#_5","text":"$ kubecm switch # \u53ef\u4ee5\u4e0a\u4e0b\u5207\u6362\uff0c\u9009\u62e9\u96c6\u7fa4\u73af\u5883 Use the arrow keys to navigate: \u2193 \u2191 \u2192 \u2190 and / toggles search Select Kube Context ucloud-k3s ( * ) bj \ud83d\ude3c dev \u2193 produce \u4ee5\u4e0a\u5c31\u662fkubecm \u7684\u4e00\u4e9b\u5b89\u88c5\u548c\u4f7f\u7528\u65b9\u6cd5\uff0c\u5176\u4ed6\u7684\u5982\u679c\u611f\u5174\u8da3\u53ef\u4ee5\u81ea\u5df1\u8bd5\u4e00\u8bd5\u3002 kubens kubectx \u6587\u7ae0\u5730\u5740\uff1a kubenc","title":"\u5207\u6362\u4e00\u4e2a\u96c6\u7fa4"},{"location":"Macuse/mac-easy/#kubectx","text":"\u5982\u679c\u4f60\u4f7f\u7528Homebrew\uff0c\u4f60\u53ef\u4ee5\u50cf\u8fd9\u6837\u5b89\u88c5\uff1a brew install kubectx \u5b89\u88c5\u5b8c\u6210\u4e4b\u540e\uff0c\u6765\u8fd9\u6837\u4f7f\u7528kubens\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u5207\u6362namespace\u3002","title":"kubectx\u5b89\u88c5"},{"location":"Macuse/mac-easy/#fzf","text":"fzf \u5b89\u88c5 fzf\u5b98\u7f51 \u8fd9\u91cc\u9762\u6bd4\u8f83\u597d\u73a9\u7684\u8fd8\u6709\u4e00\u4e2a\u5e26\u6709\u6a21\u7cca\u641c\u7d22\u7684\u4ea4\u4e92\u5f0f\u83dc\u5355\uff0c\u5b89\u88c5\u5b8c\u6210\u4e4b\u540e\u518d\u4f7f\u7528kubens\u5c31\u9999\u7684\u5f88\u554a brew install fzf $( brew --prefix ) /opt/fzf/install \u6e29\u99a8\u63d0\u793a \u5982\u679c\u4e0d\u80fd\u4f7f\u7528\uff0c\u9700\u8981\u5173\u95ed\u7ec8\u7aef\uff0c\u91cd\u65b0\u6253\u5f00 fzf\u9664\u4e86\u8fd9\u4e9b\uff0c\u8fd8\u6709\u5f88\u591a\u7684\u9a9a\u64cd\u4f5c\uff0cshell\u547d\u4ee4\u8865\u5168\uff0c\u53e6\u5916fzf \u91cd\u5199\u4e86 ctrl+r \u641c\u7d22\u5386\u53f2\u547d\u4ee4","title":"fzf\u5b89\u88c5"},{"location":"Macuse/mac-easy/#word","text":"\u53c2\u8003\u5730\u5740 https://www.51cto.com/article/708448.html","title":"word\u6587\u4ef6\u4fee\u590d"},{"location":"Macuse/mac-usb-system/","text":"Mac \u5236\u4f5cubuntu\u955c\u50cf\uff08\u5176\u4ed6\u53d1\u884c\u7248\u90fd\u53ef\u4ee5\uff09 \u00b6 \u6b65\u9aa4\u4e00 Convert ISO file to RAW img file xxx $ hdiutil convert -format UDRW -o target.img ~/Downloads/CentOS-7-x86_64-Minimal-2009.iso \u6b63\u5728\u8bfb\u53d6Master Boot Record\uff08MBR\uff1a0\uff09\u2026 \u6b63\u5728\u8bfb\u53d6CentOS 7 x86_64 \uff08Apple_ISO\uff1a1\uff09\u2026 \u6b63\u5728\u8bfb\u53d6\uff08Type EF\uff1a2\uff09\u2026 . \u6b63\u5728\u8bfb\u53d6CentOS 7 x86_64 \uff08Apple_ISO\uff1a3\uff09\u2026 ............................................................................... \u5df2\u8017\u65f6\uff1a 1 .235s \u901f\u5ea6\uff1a787.3MB/\u79d2 \u8282\u7701\uff1a0.0% created: /Users/bougou/target.img.dmg Get USB dev id $ diskutil list /dev/disk0 ( internal ) : #: TYPE NAME SIZE IDENTIFIER 0 : GUID_partition_scheme 1 .0 TB disk0 1 : Apple_APFS_ISC 524 .3 MB disk0s1 2 : Apple_APFS Container disk3 994 .7 GB disk0s2 3 : Apple_APFS_Recovery 5 .4 GB disk0s3 /dev/disk3 ( synthesized ) : #: TYPE NAME SIZE IDENTIFIER 0 : APFS Container Scheme - +994.7 GB disk3 Physical Store disk0s2 1 : APFS Volume Macintosh HD 15 .2 GB disk3s1 2 : APFS Snapshot com.apple.os.update-... 15 .2 GB disk3s1s1 3 : APFS Volume Preboot 614 .7 MB disk3s2 4 : APFS Volume Recovery 1 .6 GB disk3s3 5 : APFS Volume Data 120 .9 GB disk3s5 6 : APFS Volume VM 20 .5 KB disk3s6 /dev/disk4 ( external, physical ) : #: TYPE NAME SIZE IDENTIFIER 0 : FDisk_partition_scheme *15.5 GB disk4 1 : 0xEF 9 .0 MB disk4s2 unmountDisk $ diskutil umountDisk /dev/disk4 Unmount of all volumes on disk4 was successful dd and eject USB $ sudo dd if = ~/target.img.dmg of = /dev/disk4 bs = 1m Password: 972 +1 records in 972 +1 records out 1019942912 bytes transferred in 47 .017375 secs ( 21692894 bytes/sec )","title":"Mac \u5236\u4f5cubuntu\u7cfb\u7edf\u76d8"},{"location":"Macuse/mac-usb-system/#mac-ubuntu","text":"\u6b65\u9aa4\u4e00 Convert ISO file to RAW img file xxx $ hdiutil convert -format UDRW -o target.img ~/Downloads/CentOS-7-x86_64-Minimal-2009.iso \u6b63\u5728\u8bfb\u53d6Master Boot Record\uff08MBR\uff1a0\uff09\u2026 \u6b63\u5728\u8bfb\u53d6CentOS 7 x86_64 \uff08Apple_ISO\uff1a1\uff09\u2026 \u6b63\u5728\u8bfb\u53d6\uff08Type EF\uff1a2\uff09\u2026 . \u6b63\u5728\u8bfb\u53d6CentOS 7 x86_64 \uff08Apple_ISO\uff1a3\uff09\u2026 ............................................................................... \u5df2\u8017\u65f6\uff1a 1 .235s \u901f\u5ea6\uff1a787.3MB/\u79d2 \u8282\u7701\uff1a0.0% created: /Users/bougou/target.img.dmg Get USB dev id $ diskutil list /dev/disk0 ( internal ) : #: TYPE NAME SIZE IDENTIFIER 0 : GUID_partition_scheme 1 .0 TB disk0 1 : Apple_APFS_ISC 524 .3 MB disk0s1 2 : Apple_APFS Container disk3 994 .7 GB disk0s2 3 : Apple_APFS_Recovery 5 .4 GB disk0s3 /dev/disk3 ( synthesized ) : #: TYPE NAME SIZE IDENTIFIER 0 : APFS Container Scheme - +994.7 GB disk3 Physical Store disk0s2 1 : APFS Volume Macintosh HD 15 .2 GB disk3s1 2 : APFS Snapshot com.apple.os.update-... 15 .2 GB disk3s1s1 3 : APFS Volume Preboot 614 .7 MB disk3s2 4 : APFS Volume Recovery 1 .6 GB disk3s3 5 : APFS Volume Data 120 .9 GB disk3s5 6 : APFS Volume VM 20 .5 KB disk3s6 /dev/disk4 ( external, physical ) : #: TYPE NAME SIZE IDENTIFIER 0 : FDisk_partition_scheme *15.5 GB disk4 1 : 0xEF 9 .0 MB disk4s2 unmountDisk $ diskutil umountDisk /dev/disk4 Unmount of all volumes on disk4 was successful dd and eject USB $ sudo dd if = ~/target.img.dmg of = /dev/disk4 bs = 1m Password: 972 +1 records in 972 +1 records out 1019942912 bytes transferred in 47 .017375 secs ( 21692894 bytes/sec )","title":"Mac \u5236\u4f5cubuntu\u955c\u50cf\uff08\u5176\u4ed6\u53d1\u884c\u7248\u90fd\u53ef\u4ee5\uff09"},{"location":"Macuse/mac-vscode/","text":"mac \u4f7f\u7528code\u547d\u4ee4\u6253\u5f00VSCode \u00b6 \u89e3\u51b3VSCode\u5feb\u6377\u6307\u4ee4code\u91cd\u542f\u5931\u6548 \u6587\u7ae0\u53c2\u8003: - https://juejin.cn/post/6844903872989757447","title":"Mac vscode\u4f7f\u7528\u6280\u5de7"},{"location":"Macuse/mac-vscode/#mac-codevscode","text":"\u89e3\u51b3VSCode\u5feb\u6377\u6307\u4ee4code\u91cd\u542f\u5931\u6548 \u6587\u7ae0\u53c2\u8003: - https://juejin.cn/post/6844903872989757447","title":"mac \u4f7f\u7528code\u547d\u4ee4\u6253\u5f00VSCode"},{"location":"basic/cncf/","text":"\u4e91\u539f\u751f\u53caCNCF \u00b6 \u4e91\u539f\u751f\u7684\u5b9a\u4e49 \u00b6 https://github.com/cncf/toc/blob/main/DEFINITION.md#%E4%B8%AD%E6 \u4e91\u539f\u751f\u6280\u672f\u6709\u5229\u4e8e\u5404\u7ec4\u7ec7\u5728\u516c\u6709\u4e91\u3001\u79c1\u6709\u4e91\u548c\u6df7\u5408\u4e91\u7b49\u65b0\u578b\u52a8\u6001\u73af\u5883\u4e2d\uff0c\u6784\u5efa\u548c\u8fd0\u884c\u53ef\u5f39\u6027\u6269\u5c55\u7684\u5e94\u7528\u3002\u4e91\u539f\u751f\u7684\u4ee3\u8868\u6280\u672f\u5305\u62ec\u5bb9\u5668\u3001\u670d\u52a1\u7f51\u683c\u3001\u5fae\u670d\u52a1\u3001\u4e0d\u53ef\u53d8\u57fa\u7840\u8bbe\u65bd\u548c\u58f0\u660e\u5f0fAPI\u3002 \u8fd9\u4e9b\u6280\u672f\u80fd\u591f\u6784\u5efa\u5bb9\u9519\u6027\u597d\u3001\u6613\u4e8e\u7ba1\u7406\u548c\u4fbf\u4e8e\u89c2\u5bdf\u7684\u677e\u8026\u5408\u7cfb\u7edf\u3002\u7ed3\u5408\u53ef\u9760\u7684\u81ea\u52a8\u5316\u624b\u6bb5\uff0c\u4e91\u539f\u751f\u6280\u672f\u4f7f\u5de5\u7a0b\u5e08\u80fd\u591f\u8f7b\u677e\u5730\u5bf9\u7cfb\u7edf\u4f5c\u51fa\u9891\u7e41\u548c\u53ef\u9884\u6d4b\u7684\u91cd\u5927\u53d8\u66f4\u3002 \u4e91\u539f\u751f\u8ba1\u7b97\u57fa\u91d1\u4f1a\uff08CNCF\uff09\u81f4\u529b\u4e8e\u57f9\u80b2\u548c\u7ef4\u62a4\u4e00\u4e2a\u5382\u5546\u4e2d\u7acb\u7684\u5f00\u6e90\u751f\u6001\u7cfb\u7edf\uff0c\u6765\u63a8\u5e7f\u4e91\u539f\u751f\u6280\u672f\u3002\u6211\u4eec\u901a\u8fc7\u5c06\u6700\u524d\u6cbf\u7684\u6a21\u5f0f\u6c11\u4e3b\u5316\uff0c\u8ba9\u8fd9\u4e9b\u521b\u65b0\u4e3a\u5927\u4f17\u6240\u7528\u3002 CNCF \u4e91\u539f\u751f\u5bb9\u5668\u751f\u6001\u7cfb\u7edf\u6982\u8981 \u00b6 \u7f51\u7ad9\uff1ahttp://dockone.io/article/3006 \u6587\u6863\u53c2\u8003\uff1a \u7b2c\u4e00\u671f\u6587\u6863\uff1a \u7b2c\u4e8c\u671f\u6587\u6863\uff1a \u7b2c\u4e09\u671f\u6587\u6863\uff1a","title":"\u4e91\u539f\u751f\u7b80\u4ecb"},{"location":"basic/cncf/#cncf","text":"","title":"\u4e91\u539f\u751f\u53caCNCF"},{"location":"basic/cncf/#_1","text":"https://github.com/cncf/toc/blob/main/DEFINITION.md#%E4%B8%AD%E6 \u4e91\u539f\u751f\u6280\u672f\u6709\u5229\u4e8e\u5404\u7ec4\u7ec7\u5728\u516c\u6709\u4e91\u3001\u79c1\u6709\u4e91\u548c\u6df7\u5408\u4e91\u7b49\u65b0\u578b\u52a8\u6001\u73af\u5883\u4e2d\uff0c\u6784\u5efa\u548c\u8fd0\u884c\u53ef\u5f39\u6027\u6269\u5c55\u7684\u5e94\u7528\u3002\u4e91\u539f\u751f\u7684\u4ee3\u8868\u6280\u672f\u5305\u62ec\u5bb9\u5668\u3001\u670d\u52a1\u7f51\u683c\u3001\u5fae\u670d\u52a1\u3001\u4e0d\u53ef\u53d8\u57fa\u7840\u8bbe\u65bd\u548c\u58f0\u660e\u5f0fAPI\u3002 \u8fd9\u4e9b\u6280\u672f\u80fd\u591f\u6784\u5efa\u5bb9\u9519\u6027\u597d\u3001\u6613\u4e8e\u7ba1\u7406\u548c\u4fbf\u4e8e\u89c2\u5bdf\u7684\u677e\u8026\u5408\u7cfb\u7edf\u3002\u7ed3\u5408\u53ef\u9760\u7684\u81ea\u52a8\u5316\u624b\u6bb5\uff0c\u4e91\u539f\u751f\u6280\u672f\u4f7f\u5de5\u7a0b\u5e08\u80fd\u591f\u8f7b\u677e\u5730\u5bf9\u7cfb\u7edf\u4f5c\u51fa\u9891\u7e41\u548c\u53ef\u9884\u6d4b\u7684\u91cd\u5927\u53d8\u66f4\u3002 \u4e91\u539f\u751f\u8ba1\u7b97\u57fa\u91d1\u4f1a\uff08CNCF\uff09\u81f4\u529b\u4e8e\u57f9\u80b2\u548c\u7ef4\u62a4\u4e00\u4e2a\u5382\u5546\u4e2d\u7acb\u7684\u5f00\u6e90\u751f\u6001\u7cfb\u7edf\uff0c\u6765\u63a8\u5e7f\u4e91\u539f\u751f\u6280\u672f\u3002\u6211\u4eec\u901a\u8fc7\u5c06\u6700\u524d\u6cbf\u7684\u6a21\u5f0f\u6c11\u4e3b\u5316\uff0c\u8ba9\u8fd9\u4e9b\u521b\u65b0\u4e3a\u5927\u4f17\u6240\u7528\u3002","title":"\u4e91\u539f\u751f\u7684\u5b9a\u4e49"},{"location":"basic/cncf/#cncf_1","text":"\u7f51\u7ad9\uff1ahttp://dockone.io/article/3006 \u6587\u6863\u53c2\u8003\uff1a \u7b2c\u4e00\u671f\u6587\u6863\uff1a \u7b2c\u4e8c\u671f\u6587\u6863\uff1a \u7b2c\u4e09\u671f\u6587\u6863\uff1a","title":"CNCF \u4e91\u539f\u751f\u5bb9\u5668\u751f\u6001\u7cfb\u7edf\u6982\u8981"},{"location":"basic/etcd/","text":"Etcd \u5907\u4efd \u00b6 https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/configure-upgrade-etcd/ Info \u4ee5\u4e0b\u5907\u4efd\u4e3b\u8981\u662f\u4ee5kubeadm\u5b89\u88c5\u7684k8s \u67e5\u770b\u8bc1\u4e66\u7684\u8def\u5f84 \u00b6 [cka] root@master0:/home/lixie# cat /etc/kubernetes/manifests/etcd.yaml apiVersion: v1 kind: Pod metadata: annotations: kubeadm.kubernetes.io/etcd.advertise-client-urls: https://192.168.159.81:2379 creationTimestamp: null labels: component: etcd tier: control-plane name: etcd namespace: kube-system spec: containers: - command: - etcd - --advertise-client-urls=https://192.168.159.81:2379 - --cert-file=/etc/kubernetes/pki/etcd/server.crt # \u6307\u5b9a crt \u6587\u4ef6 - --client-cert-auth=true - --data-dir=/var/lib/etcd - --initial-advertise-peer-urls=https://192.168.159.81:2380 - --initial-cluster=master0=https://192.168.159.81:2380 - --key-file=/etc/kubernetes/pki/etcd/server.key # \u6307\u5b9a key \u6587\u4ef6 - --listen-client-urls=https://127.0.0.1:2379,https://192.168.159.81:2379 - --listen-metrics-urls=http://127.0.0.1:2381 - --listen-peer-urls=https://192.168.159.81:2380 - --name=master0 - --peer-cert-file=/etc/kubernetes/pki/etcd/peer.crt - --peer-client-cert-auth=true - --peer-key-file=/etc/kubernetes/pki/etcd/peer.key - --peer-trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt # \u6307\u5b9a\u8bc1\u4e66\u6587\u4ef6 - --snapshot-count=10000 - --trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt \u624b\u52a8\u5907\u4efd \u00b6 \u5b89\u88c5etcd\u5ba2\u6237\u7aef \u00b6 apt install etcd-client \u6307\u5b9a\u8def\u5f84\u5907\u4efd \u00b6 \u8fd9\u91cc\u5c06\u5907\u4efd\u6307\u5b9a\u5907\u4efd\u5230 /srv/data/\uff0c\u6307\u5b9a\u7684\u4e09\u4e2a\u6587\u4ef6\u5c31\u662f\u4ee5\u4e0a\u6807\u6ce8\u7684\u4e09\u4e2a\u4f4d\u7f6e export ETCDCTL_API=3 # \u58f0\u660eetcd-api mkdir /srv/data/ etcdctl --endpoints=https://127.0.0.1:2379 \\ --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key \\ snapshot save /srv/data/etcd-snapshot.db \u6821\u9a8c\u7ed3\u679c\uff1a etcdctl --endpoints=https://127.0.0.1:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key snapshot status /srv/data/etcd-snapshot.db \u81ea\u52a8\u5907\u4efd \u00b6 \u8fd8\u539f\uff08kubeadm \u5b89\u88c5\u7684k8s\uff09 \u00b6 \u6a21\u62df\u6545\u969c \u00b6 \u8fd9\u91cc\u6211\u6a21\u62df\u5220\u9664\u4e86\u8fd9\u4e2a\u8d44\u6e90\uff0c\u770b\u4e00\u4f1a\u662f\u5426\u53ef\u4ee5\u8fd8\u539f [ucloud] root@master0:~# k get pod NAME READY STATUS RESTARTS AGE nginx-ds-6mnw5 1/1 Running 0 2d [ucloud] root@master0:~# k delete ds nginx-ds daemonset.apps \"nginx-ds\" deleted \u786e\u8ba4k8s\u7ec4\u4ef6\u7684\u4f4d\u7f6e \u00b6 \u67e5\u770bkubelet\u7684\u72b6\u6001 [ucloud] root@master0:~# systemctl status kubelet \u25cf kubelet.service - kubelet: The Kubernetes Node Agent Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled) Drop-In: /etc/systemd/system/kubelet.service.d # \u67e5\u770b\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6 \u2514\u250010-kubeadm.conf Active: active (running) since Mon 2022-07-04 15:09:15 CST; 1 day 23h ago Docs: https://kubernetes.io/docs/home/ Main PID: 39279 (kubelet) Tasks: 17 (limit: 4390) Memory: 63.3M CGroup: /system.slice/kubelet.service \u67e5\u770b\u6587\u4ef6\uff1a/etc/systemd/system/kubelet.service.d/10-kubeadm.conf [ucloud] root@master0:~# cat /etc/systemd/system/kubelet.service.d/10-kubeadm.conf # Note: This dropin only works with kubeadm and kubelet v1.11+ [Service] Environment=\"KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf\" Environment=\"KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml\" # \u67e5\u770b\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6 # This is a file that \"kubeadm init\" and \"kubeadm join\" generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env # This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use # the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file. EnvironmentFile=-/etc/default/kubelet ExecStart= ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS \u67e5\u770b\u6587\u4ef6\uff1a/var/lib/kubelet/config.yaml [ucloud] root@master0:~# cat /var/lib/kubelet/config.yaml apiVersion: kubelet.config.k8s.io/v1beta1 authentication: anonymous: enabled: false webhook: cacheTTL: 0s enabled: true x509: ...... staticPodPath: /etc/kubernetes/manifests # \u770b\u5230\u8fd9\u884c\uff0c\u5c31\u8bf4\u660e\u914d\u7f6e\u6587\u4ef6\u8fd9\u4e2amanifests\u4e0b streamingConnectionIdleTimeout: 0s syncFrequency: 0s volumeStatsAggPeriod: 0s \u505c\u6b62api-server \u00b6 [ucloud] root@master0:~# mkdir /opt/backup/ -p [ucloud] root@master0:~# cd /etc/kubernetes/manifests [ucloud] root@master0:/etc/kubernetes/manifests# ll total 24 drwxr-xr-x 2 root root 4096 Jul 3 22:01 ./ drwxr-xr-x 5 root root 4096 Jul 3 21:15 ../ -rw------- 1 root root 2294 Jul 3 22:00 etcd.yaml -rw------- 1 root root 4036 Jul 3 22:00 kube-apiserver.yaml -rw------- 1 root root 3541 Jul 3 22:00 kube-controller-manager.yaml -rw------- 1 root root 1464 Jul 3 22:00 kube-scheduler.yaml [ucloud] root@master0:/etc/kubernetes/manifests# mv kube-* /opt/backup/ # \u79fb\u8d70\u4e4b\u540e\u6211\u4eec\u4f1a\u53d1\u73b0\u4e0d\u80fd\u4f7f\u7528kubectl\u547d\u4ee4 \u8fdb\u884c\u8fd8\u539f \u00b6 \u5982\u679c\u6062\u590d\u5931\u8d25\u9700\u8981\u6dfb\u52a0--skip-hash-check\u53c2\u6570 [ucloud] root@master0:~# etcdctl --endpoints=https://127.0.0.1:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key snapshot restore /srv/data/etcd-snapshot.db --data-dir=/var/lib/etcd-restore --skip-hash-check \u4fee\u6539etcd\u7684\u914d\u7f6e\u6587\u4ef6 \u5c06 volume \u914d\u7f6e\u7684 path: /var/lib/etcd \u6539\u6210/var/lib/etcd-restore [ucloud] root@master0:/etc/kubernetes/manifests# pwd /etc/kubernetes/manifests [ucloud] root@master0:/etc/kubernetes/manifests# vim etcd.yaml - hostPath: path: /var/lib/etcd-restore # \u5c06\u6539\u76ee\u5f55\u4fee\u6539\u4e3a\u8fd8\u539fetcd\u7684\u4f4d\u7f6e type: DirectoryOrCreate \u8fd8\u539fk8s\u7ec4\u4ef6 mv /opt/backup/* /etc/kubernetes/manifests systemctl restart kubelet \u6821\u9a8c\u7ed3\u679c\uff1a \u53d1\u73b0\u8bef\u5220\u9664\u7684pod\u8fd8\u539f\u6210\u529f [ucloud] root@master0:/etc/kubernetes/manifests# k get pod NAME READY STATUS RESTARTS AGE nginx-ds-6mnw5 1/1 Running 0 2d","title":"ETCD\u5907\u4efd\u8fd8\u539f"},{"location":"basic/etcd/#etcd","text":"https://kubernetes.io/zh-cn/docs/tasks/administer-cluster/configure-upgrade-etcd/ Info \u4ee5\u4e0b\u5907\u4efd\u4e3b\u8981\u662f\u4ee5kubeadm\u5b89\u88c5\u7684k8s","title":"Etcd \u5907\u4efd"},{"location":"basic/etcd/#_1","text":"[cka] root@master0:/home/lixie# cat /etc/kubernetes/manifests/etcd.yaml apiVersion: v1 kind: Pod metadata: annotations: kubeadm.kubernetes.io/etcd.advertise-client-urls: https://192.168.159.81:2379 creationTimestamp: null labels: component: etcd tier: control-plane name: etcd namespace: kube-system spec: containers: - command: - etcd - --advertise-client-urls=https://192.168.159.81:2379 - --cert-file=/etc/kubernetes/pki/etcd/server.crt # \u6307\u5b9a crt \u6587\u4ef6 - --client-cert-auth=true - --data-dir=/var/lib/etcd - --initial-advertise-peer-urls=https://192.168.159.81:2380 - --initial-cluster=master0=https://192.168.159.81:2380 - --key-file=/etc/kubernetes/pki/etcd/server.key # \u6307\u5b9a key \u6587\u4ef6 - --listen-client-urls=https://127.0.0.1:2379,https://192.168.159.81:2379 - --listen-metrics-urls=http://127.0.0.1:2381 - --listen-peer-urls=https://192.168.159.81:2380 - --name=master0 - --peer-cert-file=/etc/kubernetes/pki/etcd/peer.crt - --peer-client-cert-auth=true - --peer-key-file=/etc/kubernetes/pki/etcd/peer.key - --peer-trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt # \u6307\u5b9a\u8bc1\u4e66\u6587\u4ef6 - --snapshot-count=10000 - --trusted-ca-file=/etc/kubernetes/pki/etcd/ca.crt","title":"\u67e5\u770b\u8bc1\u4e66\u7684\u8def\u5f84"},{"location":"basic/etcd/#_2","text":"","title":"\u624b\u52a8\u5907\u4efd"},{"location":"basic/etcd/#etcd_1","text":"apt install etcd-client","title":"\u5b89\u88c5etcd\u5ba2\u6237\u7aef"},{"location":"basic/etcd/#_3","text":"\u8fd9\u91cc\u5c06\u5907\u4efd\u6307\u5b9a\u5907\u4efd\u5230 /srv/data/\uff0c\u6307\u5b9a\u7684\u4e09\u4e2a\u6587\u4ef6\u5c31\u662f\u4ee5\u4e0a\u6807\u6ce8\u7684\u4e09\u4e2a\u4f4d\u7f6e export ETCDCTL_API=3 # \u58f0\u660eetcd-api mkdir /srv/data/ etcdctl --endpoints=https://127.0.0.1:2379 \\ --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key \\ snapshot save /srv/data/etcd-snapshot.db \u6821\u9a8c\u7ed3\u679c\uff1a etcdctl --endpoints=https://127.0.0.1:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key snapshot status /srv/data/etcd-snapshot.db","title":"\u6307\u5b9a\u8def\u5f84\u5907\u4efd"},{"location":"basic/etcd/#_4","text":"","title":"\u81ea\u52a8\u5907\u4efd"},{"location":"basic/etcd/#kubeadm-k8s","text":"","title":"\u8fd8\u539f\uff08kubeadm \u5b89\u88c5\u7684k8s\uff09"},{"location":"basic/etcd/#_5","text":"\u8fd9\u91cc\u6211\u6a21\u62df\u5220\u9664\u4e86\u8fd9\u4e2a\u8d44\u6e90\uff0c\u770b\u4e00\u4f1a\u662f\u5426\u53ef\u4ee5\u8fd8\u539f [ucloud] root@master0:~# k get pod NAME READY STATUS RESTARTS AGE nginx-ds-6mnw5 1/1 Running 0 2d [ucloud] root@master0:~# k delete ds nginx-ds daemonset.apps \"nginx-ds\" deleted","title":"\u6a21\u62df\u6545\u969c"},{"location":"basic/etcd/#k8s","text":"\u67e5\u770bkubelet\u7684\u72b6\u6001 [ucloud] root@master0:~# systemctl status kubelet \u25cf kubelet.service - kubelet: The Kubernetes Node Agent Loaded: loaded (/lib/systemd/system/kubelet.service; enabled; vendor preset: enabled) Drop-In: /etc/systemd/system/kubelet.service.d # \u67e5\u770b\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6 \u2514\u250010-kubeadm.conf Active: active (running) since Mon 2022-07-04 15:09:15 CST; 1 day 23h ago Docs: https://kubernetes.io/docs/home/ Main PID: 39279 (kubelet) Tasks: 17 (limit: 4390) Memory: 63.3M CGroup: /system.slice/kubelet.service \u67e5\u770b\u6587\u4ef6\uff1a/etc/systemd/system/kubelet.service.d/10-kubeadm.conf [ucloud] root@master0:~# cat /etc/systemd/system/kubelet.service.d/10-kubeadm.conf # Note: This dropin only works with kubeadm and kubelet v1.11+ [Service] Environment=\"KUBELET_KUBECONFIG_ARGS=--bootstrap-kubeconfig=/etc/kubernetes/bootstrap-kubelet.conf --kubeconfig=/etc/kubernetes/kubelet.conf\" Environment=\"KUBELET_CONFIG_ARGS=--config=/var/lib/kubelet/config.yaml\" # \u67e5\u770b\u8fd9\u4e2a\u914d\u7f6e\u6587\u4ef6 # This is a file that \"kubeadm init\" and \"kubeadm join\" generates at runtime, populating the KUBELET_KUBEADM_ARGS variable dynamically EnvironmentFile=-/var/lib/kubelet/kubeadm-flags.env # This is a file that the user can use for overrides of the kubelet args as a last resort. Preferably, the user should use # the .NodeRegistration.KubeletExtraArgs object in the configuration files instead. KUBELET_EXTRA_ARGS should be sourced from this file. EnvironmentFile=-/etc/default/kubelet ExecStart= ExecStart=/usr/bin/kubelet $KUBELET_KUBECONFIG_ARGS $KUBELET_CONFIG_ARGS $KUBELET_KUBEADM_ARGS $KUBELET_EXTRA_ARGS \u67e5\u770b\u6587\u4ef6\uff1a/var/lib/kubelet/config.yaml [ucloud] root@master0:~# cat /var/lib/kubelet/config.yaml apiVersion: kubelet.config.k8s.io/v1beta1 authentication: anonymous: enabled: false webhook: cacheTTL: 0s enabled: true x509: ...... staticPodPath: /etc/kubernetes/manifests # \u770b\u5230\u8fd9\u884c\uff0c\u5c31\u8bf4\u660e\u914d\u7f6e\u6587\u4ef6\u8fd9\u4e2amanifests\u4e0b streamingConnectionIdleTimeout: 0s syncFrequency: 0s volumeStatsAggPeriod: 0s","title":"\u786e\u8ba4k8s\u7ec4\u4ef6\u7684\u4f4d\u7f6e"},{"location":"basic/etcd/#api-server","text":"[ucloud] root@master0:~# mkdir /opt/backup/ -p [ucloud] root@master0:~# cd /etc/kubernetes/manifests [ucloud] root@master0:/etc/kubernetes/manifests# ll total 24 drwxr-xr-x 2 root root 4096 Jul 3 22:01 ./ drwxr-xr-x 5 root root 4096 Jul 3 21:15 ../ -rw------- 1 root root 2294 Jul 3 22:00 etcd.yaml -rw------- 1 root root 4036 Jul 3 22:00 kube-apiserver.yaml -rw------- 1 root root 3541 Jul 3 22:00 kube-controller-manager.yaml -rw------- 1 root root 1464 Jul 3 22:00 kube-scheduler.yaml [ucloud] root@master0:/etc/kubernetes/manifests# mv kube-* /opt/backup/ # \u79fb\u8d70\u4e4b\u540e\u6211\u4eec\u4f1a\u53d1\u73b0\u4e0d\u80fd\u4f7f\u7528kubectl\u547d\u4ee4","title":"\u505c\u6b62api-server"},{"location":"basic/etcd/#_6","text":"\u5982\u679c\u6062\u590d\u5931\u8d25\u9700\u8981\u6dfb\u52a0--skip-hash-check\u53c2\u6570 [ucloud] root@master0:~# etcdctl --endpoints=https://127.0.0.1:2379 --cacert=/etc/kubernetes/pki/etcd/ca.crt --cert=/etc/kubernetes/pki/etcd/server.crt --key=/etc/kubernetes/pki/etcd/server.key snapshot restore /srv/data/etcd-snapshot.db --data-dir=/var/lib/etcd-restore --skip-hash-check \u4fee\u6539etcd\u7684\u914d\u7f6e\u6587\u4ef6 \u5c06 volume \u914d\u7f6e\u7684 path: /var/lib/etcd \u6539\u6210/var/lib/etcd-restore [ucloud] root@master0:/etc/kubernetes/manifests# pwd /etc/kubernetes/manifests [ucloud] root@master0:/etc/kubernetes/manifests# vim etcd.yaml - hostPath: path: /var/lib/etcd-restore # \u5c06\u6539\u76ee\u5f55\u4fee\u6539\u4e3a\u8fd8\u539fetcd\u7684\u4f4d\u7f6e type: DirectoryOrCreate \u8fd8\u539fk8s\u7ec4\u4ef6 mv /opt/backup/* /etc/kubernetes/manifests systemctl restart kubelet \u6821\u9a8c\u7ed3\u679c\uff1a \u53d1\u73b0\u8bef\u5220\u9664\u7684pod\u8fd8\u539f\u6210\u529f [ucloud] root@master0:/etc/kubernetes/manifests# k get pod NAME READY STATUS RESTARTS AGE nginx-ds-6mnw5 1/1 Running 0 2d","title":"\u8fdb\u884c\u8fd8\u539f"},{"location":"basic/k8s-systeminit/","text":"k8s\u96c6\u7fa4\u90e8\u7f72 \u00b6 kubeadm \u521b\u5efa\u96c6\u7fa4 \u00b6 \u6ce8\u610f\u4ee5\u4e0b\u662fcentos\u642d\u5efa \u96c6\u7fa4\u521d\u59cb\u5316 \u00b6 # \u5c06 SELinux \u8bbe\u7f6e\u4e3a permissive \u6a21\u5f0f\uff08\u76f8\u5f53\u4e8e\u5c06\u5176\u7981\u7528\uff09 sudo setenforce 0 sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config #\u5173\u95edswap swapoff -a sed -ri 's/.*swap.*/#&/' /etc/fstab #\u5141\u8bb8 iptables \u68c0\u67e5\u6865\u63a5\u6d41\u91cf cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf br_netfilter EOF cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sudo sysctl --system \u5b89\u88c5kubelet\u3001kubeadm\u3001kubectl cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=0 repo_gpgcheck=0 gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg exclude=kubelet kubeadm kubectl EOF sudo yum install -y kubelet-1.20.9 kubeadm-1.20.9 kubectl-1.20.9 --disableexcludes = kubernetes # \u6240\u6709\u8282\u70b9 sudo systemctl enable --now kubelet \u6e29\u99a8\u63d0\u793a kubelet \u73b0\u5728\u6bcf\u9694\u51e0\u79d2\u5c31\u4f1a\u91cd\u542f\uff0c\u56e0\u4e3a\u5b83\u9677\u5165\u4e86\u4e00\u4e2a\u7b49\u5f85 kubeadm \u6307\u4ee4\u7684\u6b7b\u5faa\u73af \u67e5\u770bkubeadm\u7684\u7248\u672c\uff0c\u5e76\u62c9\u53d6\u8be5\u7248\u672c\u7684images kubeadm config images list --kubernetes-version v1.20.9 > k8s.images root@ubuntu:/home/ubuntu/script# cat k8s.images |awk -F'/' '{print $2}' kube-apiserver:v1.20.9 kube-controller-manager:v1.20.9 kube-scheduler:v1.20.9 kube-proxy:v1.20.9 pause:3.2 etcd:3.4.13-0 coredns:1.7.0 \u811a\u672c\u4e0b\u8f7d\u955c\u50cf root@ubuntu:/home/ubuntu/script# cat ubuntu-k8s-images.sh #!/bin/bash images=' kube-apiserver:v1.20.9 kube-controller-manager:v1.20.9 kube-scheduler:v1.20.9 kube-proxy:v1.20.9 pause:3.2 etcd:3.4.13-0 coredns:1.7.0 ' for i in $images ; do docker pull registry.aliyuncs.com/google_containers/$i done \u521d\u59cb\u5316master\u8282\u70b9\uff1a #\u6240\u6709\u673a\u5668\u6dfb\u52a0master\u57df\u540d\u6620\u5c04\uff0c\u4ee5\u4e0b\u9700\u8981\u4fee\u6539\u4e3a\u81ea\u5df1\u7684 echo \"192.168.8.70 cluster-endpoint\" >> /etc/hosts # \u4e3b\u8282\u70b9\u521d\u59cb\u5316 kubeadm init \\ --apiserver-advertise-address=192.168.159.201 \\ --control-plane-endpoint=cluster-endpoint \\ --image-repository registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images \\ --kubernetes-version v1.20.9 \\ --service-cidr=10.96.0.0/16 \\ --pod-network-cidr=172.16.0.0/16 #\u6240\u6709\u7f51\u7edc\u8303\u56f4\u4e0d\u91cd\u53e0 \u521d\u59cb\u5316\u53d1\u73b0\u6240\u6709\u72b6\u6001\u90fd\u662f NotReady \u5b89\u88c5\u7f51\u7edc\u7ec4\u4ef6: calico Node\u8282\u70b9\u52a0\u5165\u96c6\u7fa4 \u00b6 Warning \u65b0\u4ee4\u724c,\u9ed8\u8ba4\u7684\u4ee4\u724c24\u5c0f\u65f6\u5019\u5931\u6548 kubeadm token create --print-join-command Mac\u8fde\u63a5\u96c6\u7fa4\u62a5\u9519 \u00b6 Mac \u8fde\u63a5k8s\u96c6\u7fa4\u62a5\u9519 x509: certificate signed by unknown authority \u521b\u5efa\u96c6\u7fa4\u7684\u65f6\u5019\u6ca1\u6709\u6267\u884c\u5916\u7f51\u5730\u5740.\u5bfc\u81f4\u8bc1\u4e66\u4e0d\u80fd\u6b63\u5e38\u4f7f\u7528 \u5c06 master \u7684\u5916\u7f51\u5730\u5740\u548c\u4e3b\u673a\u540d\u89e3\u6790\u5230\u672c\u5730 hosts \u6e05\u7406k8s\u96c6\u7fa4 \u00b6 Success [root@k8s-master ~]# kubeadm reset [root@k8s-master ~]# kubectl delete node 192.168.200.112 [root@k8s-node01 ~]# docker rm -f $(docker ps -aq) [root@k8s-node01 ~]# systemctl stop kubelet [root@k8s-node01 ~]# rm -rf /etc/kubernetes/* [root@k8s-node01 ~]# rm -rf /var/lib/kubelet/* \u5f3a\u5236\u5220\u9664namespace \u00b6 delete namespace \u6253\u5f00\u4e00\u4e2a\u65b0\u7a97\u53e3\uff1aroot@master30:~# kubectl proxy --port=8001 \u65b9\u6cd5\u4e8c $ NAMESPACE_NAME=rook-ceph cat <<EOF | curl -X PUT \\ 127.0.0.1:8001/api/v1/namespaces/$NAMESPACE_NAME/finalize \\ -H \"Content-Type : application/json\" \\ --data-binary @- { \"kind\" : \"Namespace\" , \"apiVersion\" : \"v1\" , \"metadata\" : { \"name\" : \"$NAMESPACE_NAME\" }, \"spec\" : { \"finalizers\" : null } } EOF System OOM encountered \u539f\u56e0\u63cf\u8ff0\uff1a \u4e0a\u8ff0\u4e24\u79cdOOM\uff08\u8fdb\u7a0bOOM\uff0c\u5bb9\u5668OOM\uff09\u53d1\u751f\u540e\uff0c\u90fd\u53ef\u80fd\u4f1a\u4f34\u968f\u4e00\u4e2a\u7cfb\u7edfOOM\u4e8b\u4ef6\uff0c\u8be5\u4e8b\u4ef6\u7684\u539f\u56e0\u662f\u7531\u4e0a\u8ff0OOM\u4e8b\u4ef6\u4f34\u968f\u5bfc\u81f4\u3002 \u89e3\u51b3\u65b9\u6848\uff1a \u9700\u8981\u89e3\u51b3\u4e0a\u9762\u8fdb\u7a0bOOM\u6216\u8005\u5bb9\u5668CgroupOOM\u7684\u95ee\u9898 \u5c0f\u6280\u5de7 \u00b6 \u5c0f\u6280\u5de7 Mac \u7ba1\u7406kubernetes\uff0c\u5408\u5e76yaml https://aisensiy.me/kubeconfig-management","title":"\u96c6\u7fa4\u90e8\u7f72"},{"location":"basic/k8s-systeminit/#k8s","text":"","title":"k8s\u96c6\u7fa4\u90e8\u7f72"},{"location":"basic/k8s-systeminit/#kubeadm","text":"\u6ce8\u610f\u4ee5\u4e0b\u662fcentos\u642d\u5efa","title":"kubeadm \u521b\u5efa\u96c6\u7fa4"},{"location":"basic/k8s-systeminit/#_1","text":"# \u5c06 SELinux \u8bbe\u7f6e\u4e3a permissive \u6a21\u5f0f\uff08\u76f8\u5f53\u4e8e\u5c06\u5176\u7981\u7528\uff09 sudo setenforce 0 sudo sed -i 's/^SELINUX=enforcing$/SELINUX=permissive/' /etc/selinux/config #\u5173\u95edswap swapoff -a sed -ri 's/.*swap.*/#&/' /etc/fstab #\u5141\u8bb8 iptables \u68c0\u67e5\u6865\u63a5\u6d41\u91cf cat <<EOF | sudo tee /etc/modules-load.d/k8s.conf br_netfilter EOF cat <<EOF | sudo tee /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF sudo sysctl --system \u5b89\u88c5kubelet\u3001kubeadm\u3001kubectl cat <<EOF | sudo tee /etc/yum.repos.d/kubernetes.repo [kubernetes] name=Kubernetes baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64 enabled=1 gpgcheck=0 repo_gpgcheck=0 gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg exclude=kubelet kubeadm kubectl EOF sudo yum install -y kubelet-1.20.9 kubeadm-1.20.9 kubectl-1.20.9 --disableexcludes = kubernetes # \u6240\u6709\u8282\u70b9 sudo systemctl enable --now kubelet \u6e29\u99a8\u63d0\u793a kubelet \u73b0\u5728\u6bcf\u9694\u51e0\u79d2\u5c31\u4f1a\u91cd\u542f\uff0c\u56e0\u4e3a\u5b83\u9677\u5165\u4e86\u4e00\u4e2a\u7b49\u5f85 kubeadm \u6307\u4ee4\u7684\u6b7b\u5faa\u73af \u67e5\u770bkubeadm\u7684\u7248\u672c\uff0c\u5e76\u62c9\u53d6\u8be5\u7248\u672c\u7684images kubeadm config images list --kubernetes-version v1.20.9 > k8s.images root@ubuntu:/home/ubuntu/script# cat k8s.images |awk -F'/' '{print $2}' kube-apiserver:v1.20.9 kube-controller-manager:v1.20.9 kube-scheduler:v1.20.9 kube-proxy:v1.20.9 pause:3.2 etcd:3.4.13-0 coredns:1.7.0 \u811a\u672c\u4e0b\u8f7d\u955c\u50cf root@ubuntu:/home/ubuntu/script# cat ubuntu-k8s-images.sh #!/bin/bash images=' kube-apiserver:v1.20.9 kube-controller-manager:v1.20.9 kube-scheduler:v1.20.9 kube-proxy:v1.20.9 pause:3.2 etcd:3.4.13-0 coredns:1.7.0 ' for i in $images ; do docker pull registry.aliyuncs.com/google_containers/$i done \u521d\u59cb\u5316master\u8282\u70b9\uff1a #\u6240\u6709\u673a\u5668\u6dfb\u52a0master\u57df\u540d\u6620\u5c04\uff0c\u4ee5\u4e0b\u9700\u8981\u4fee\u6539\u4e3a\u81ea\u5df1\u7684 echo \"192.168.8.70 cluster-endpoint\" >> /etc/hosts # \u4e3b\u8282\u70b9\u521d\u59cb\u5316 kubeadm init \\ --apiserver-advertise-address=192.168.159.201 \\ --control-plane-endpoint=cluster-endpoint \\ --image-repository registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images \\ --kubernetes-version v1.20.9 \\ --service-cidr=10.96.0.0/16 \\ --pod-network-cidr=172.16.0.0/16 #\u6240\u6709\u7f51\u7edc\u8303\u56f4\u4e0d\u91cd\u53e0 \u521d\u59cb\u5316\u53d1\u73b0\u6240\u6709\u72b6\u6001\u90fd\u662f NotReady \u5b89\u88c5\u7f51\u7edc\u7ec4\u4ef6: calico","title":"\u96c6\u7fa4\u521d\u59cb\u5316"},{"location":"basic/k8s-systeminit/#node","text":"Warning \u65b0\u4ee4\u724c,\u9ed8\u8ba4\u7684\u4ee4\u724c24\u5c0f\u65f6\u5019\u5931\u6548 kubeadm token create --print-join-command","title":"Node\u8282\u70b9\u52a0\u5165\u96c6\u7fa4"},{"location":"basic/k8s-systeminit/#mac","text":"Mac \u8fde\u63a5k8s\u96c6\u7fa4\u62a5\u9519 x509: certificate signed by unknown authority \u521b\u5efa\u96c6\u7fa4\u7684\u65f6\u5019\u6ca1\u6709\u6267\u884c\u5916\u7f51\u5730\u5740.\u5bfc\u81f4\u8bc1\u4e66\u4e0d\u80fd\u6b63\u5e38\u4f7f\u7528 \u5c06 master \u7684\u5916\u7f51\u5730\u5740\u548c\u4e3b\u673a\u540d\u89e3\u6790\u5230\u672c\u5730 hosts","title":"Mac\u8fde\u63a5\u96c6\u7fa4\u62a5\u9519"},{"location":"basic/k8s-systeminit/#k8s_1","text":"Success [root@k8s-master ~]# kubeadm reset [root@k8s-master ~]# kubectl delete node 192.168.200.112 [root@k8s-node01 ~]# docker rm -f $(docker ps -aq) [root@k8s-node01 ~]# systemctl stop kubelet [root@k8s-node01 ~]# rm -rf /etc/kubernetes/* [root@k8s-node01 ~]# rm -rf /var/lib/kubelet/*","title":"\u6e05\u7406k8s\u96c6\u7fa4"},{"location":"basic/k8s-systeminit/#namespace","text":"delete namespace \u6253\u5f00\u4e00\u4e2a\u65b0\u7a97\u53e3\uff1aroot@master30:~# kubectl proxy --port=8001 \u65b9\u6cd5\u4e8c $ NAMESPACE_NAME=rook-ceph cat <<EOF | curl -X PUT \\ 127.0.0.1:8001/api/v1/namespaces/$NAMESPACE_NAME/finalize \\ -H \"Content-Type : application/json\" \\ --data-binary @- { \"kind\" : \"Namespace\" , \"apiVersion\" : \"v1\" , \"metadata\" : { \"name\" : \"$NAMESPACE_NAME\" }, \"spec\" : { \"finalizers\" : null } } EOF System OOM encountered \u539f\u56e0\u63cf\u8ff0\uff1a \u4e0a\u8ff0\u4e24\u79cdOOM\uff08\u8fdb\u7a0bOOM\uff0c\u5bb9\u5668OOM\uff09\u53d1\u751f\u540e\uff0c\u90fd\u53ef\u80fd\u4f1a\u4f34\u968f\u4e00\u4e2a\u7cfb\u7edfOOM\u4e8b\u4ef6\uff0c\u8be5\u4e8b\u4ef6\u7684\u539f\u56e0\u662f\u7531\u4e0a\u8ff0OOM\u4e8b\u4ef6\u4f34\u968f\u5bfc\u81f4\u3002 \u89e3\u51b3\u65b9\u6848\uff1a \u9700\u8981\u89e3\u51b3\u4e0a\u9762\u8fdb\u7a0bOOM\u6216\u8005\u5bb9\u5668CgroupOOM\u7684\u95ee\u9898","title":"\u5f3a\u5236\u5220\u9664namespace"},{"location":"basic/k8s-systeminit/#_2","text":"\u5c0f\u6280\u5de7 Mac \u7ba1\u7406kubernetes\uff0c\u5408\u5e76yaml https://aisensiy.me/kubeconfig-management","title":"\u5c0f\u6280\u5de7"},{"location":"basic/k8s-update/","text":"k8s \u7248\u672c\u5347\u7ea7 \u00b6 \u6ce8\u610f \u8bf7\u6ce8\u610f\u4ee5\u4e0b\u5347\u7ea7\u662fkubeadm\u5b89\u88c5\u7684k8s\u5662 \u7248\u672c\u9700\u6c42 \u00b6 k8s \u7684 \u7248\u672c\u4e3av1.19.16\uff0c\u5982\u679c\u8981\u5347\u7ea7\u5230v1.23.8 Warning \u6ce8\u610f\uff1a \u5347\u7ea7\u4e0d\u80fd\u6a2a\u8de8\u4e24\u4e2a\u5927\u7248\u672c,\u56e0\u6b64\u9700\u8981\u5347\u7ea7\u52064\u6b21\u8fdb\u884c\u5347\u7ea7\uff0c\u9700\u89811.20.15--1.21.14--1.22.11--1.23.8 \uff08\u5347\u7ea7\u56db\u6b21\uff09 \u6240\u6709\u8282\u70b9\u6267\u884c\uff1aapt update \u4e3b\u8282\u70b9: \u00b6 [ ucloud ] root@master0:~# apt-cache policy kubeadm | grep 1 .20. 1 .20.15-00 500 # ************\u6240\u6709\u8282\u70b9\uff0cmaster\u548cnode\u8282\u70b9\u90fd\u9700\u8981\u5347\u7ea7********* apt-get install kubeadm = 1 .20.15-00 # \u67e5\u770bk8s\u7248\u672c\u9700\u8981\u7684\u955c\u50cf kubeadm config images list --kubernetes-version v1.20.15 # \u9a8c\u8bc1\u5347\u7ea7\u8ba1\u5212 $ kubeadm upgrade plan # \u770b\u5230\u5982\u4e0b\u4fe1\u606f\uff0c\u53ef\u5347\u7ea7\u5230\u6307\u5b9a\u7248\u672c # \u770betcd\u7248\u672c\u662f\u5426\u53d1\u751f\u53d8\u5316 # \u4e3b\u8282\u70b9\u5347\u7ea7\uff0c\u5982\u679c\u4e0d\u9700\u8981\u5347\u7ea7etcd\uff0c\u6dfb\u52a0# --etcd-upgrade=false \u53c2\u6570\u5ffd\u7565\u5373\u53ef kubeadm upgrade apply v1.20.15 \u6ce8\u610f\uff1a \u8fd9\u65f6\u6211\u4eec\u53d1\u73b0k8s\u7684\u7248\u672c\u8fd8\u662f\u6ca1\u6709\u53d8\u5316\uff0c\u66f4\u65b0kubelet\u3002 \u4e3b\u8282\u70b9\uff1a apt install -y kubelet = 1 .20.15-00 kubectl = 1 .20.15-00 Error \u8fd9\u79cd\u60c5\u51b5\u53ef\u80fd\u662f\u4e4b\u524d\u5347\u7ea7\u6ca1\u6709\u8fdb\u884cnode\u8282\u70b9\u7684kubeadm\u5347\u7ea7\u5bfc\u81f4\u7684. [sjtu] root@master:/home/lixie# kubeadm upgrade plan [upgrade/config] Making sure the configuration is correct: [upgrade/config] Reading configuration from the cluster... [upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml' [preflight] Running pre-flight checks. [upgrade] Running cluster health checks [upgrade/health] FATAL: [preflight] Some fatal errors occurred: [ERROR ControlPlaneNodesReady]: there are NotReady control-planes in the cluster: [master] [preflight] If you know what you are doing, you can make a check non-fatal with `--ignore-preflight-errors=...` To see the stack trace of this error execute with --v=5 or higher \u89e3\u51b3\uff1a\uff08\u91cd\u65b0\u5b89\u88c5\u8be5\u7248\u672ckubelet\u548ckubectl\uff09 apt install kubelet=1.19.16-00 apt install kubectl=1.19.16-00 \u4ece\u8282\u70b9: \u00b6 node\u8282\u70b9\u5347\u7ea7kubelet\u7684\u914d\u7f6e\uff08\u6240\u6709node\u8282\u70b9\uff09 sudo kubeadm upgrade node \u5b89\u88c5kubelet\u548ckubectl apt install -y kubelet = 1 .20.15-00 kubectl = 1 .20.15-00 kubelet --version # \u67e5\u770b\u7248\u672c Kubernetes v1.23.8 \u9644\u4ef6 \u00b6 k8s\u8bc1\u4e66\u8fc7\u671f\u5904\u7406 \u00b6 \u95ee\u9898\uff1a \u5904\u7406k8s\u8bc1\u4e66\u8fc7\u671f","title":"K8S\u5347\u7ea7"},{"location":"basic/k8s-update/#k8s","text":"\u6ce8\u610f \u8bf7\u6ce8\u610f\u4ee5\u4e0b\u5347\u7ea7\u662fkubeadm\u5b89\u88c5\u7684k8s\u5662","title":"k8s \u7248\u672c\u5347\u7ea7"},{"location":"basic/k8s-update/#_1","text":"k8s \u7684 \u7248\u672c\u4e3av1.19.16\uff0c\u5982\u679c\u8981\u5347\u7ea7\u5230v1.23.8 Warning \u6ce8\u610f\uff1a \u5347\u7ea7\u4e0d\u80fd\u6a2a\u8de8\u4e24\u4e2a\u5927\u7248\u672c,\u56e0\u6b64\u9700\u8981\u5347\u7ea7\u52064\u6b21\u8fdb\u884c\u5347\u7ea7\uff0c\u9700\u89811.20.15--1.21.14--1.22.11--1.23.8 \uff08\u5347\u7ea7\u56db\u6b21\uff09 \u6240\u6709\u8282\u70b9\u6267\u884c\uff1aapt update","title":"\u7248\u672c\u9700\u6c42"},{"location":"basic/k8s-update/#_2","text":"[ ucloud ] root@master0:~# apt-cache policy kubeadm | grep 1 .20. 1 .20.15-00 500 # ************\u6240\u6709\u8282\u70b9\uff0cmaster\u548cnode\u8282\u70b9\u90fd\u9700\u8981\u5347\u7ea7********* apt-get install kubeadm = 1 .20.15-00 # \u67e5\u770bk8s\u7248\u672c\u9700\u8981\u7684\u955c\u50cf kubeadm config images list --kubernetes-version v1.20.15 # \u9a8c\u8bc1\u5347\u7ea7\u8ba1\u5212 $ kubeadm upgrade plan # \u770b\u5230\u5982\u4e0b\u4fe1\u606f\uff0c\u53ef\u5347\u7ea7\u5230\u6307\u5b9a\u7248\u672c # \u770betcd\u7248\u672c\u662f\u5426\u53d1\u751f\u53d8\u5316 # \u4e3b\u8282\u70b9\u5347\u7ea7\uff0c\u5982\u679c\u4e0d\u9700\u8981\u5347\u7ea7etcd\uff0c\u6dfb\u52a0# --etcd-upgrade=false \u53c2\u6570\u5ffd\u7565\u5373\u53ef kubeadm upgrade apply v1.20.15 \u6ce8\u610f\uff1a \u8fd9\u65f6\u6211\u4eec\u53d1\u73b0k8s\u7684\u7248\u672c\u8fd8\u662f\u6ca1\u6709\u53d8\u5316\uff0c\u66f4\u65b0kubelet\u3002 \u4e3b\u8282\u70b9\uff1a apt install -y kubelet = 1 .20.15-00 kubectl = 1 .20.15-00 Error \u8fd9\u79cd\u60c5\u51b5\u53ef\u80fd\u662f\u4e4b\u524d\u5347\u7ea7\u6ca1\u6709\u8fdb\u884cnode\u8282\u70b9\u7684kubeadm\u5347\u7ea7\u5bfc\u81f4\u7684. [sjtu] root@master:/home/lixie# kubeadm upgrade plan [upgrade/config] Making sure the configuration is correct: [upgrade/config] Reading configuration from the cluster... [upgrade/config] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml' [preflight] Running pre-flight checks. [upgrade] Running cluster health checks [upgrade/health] FATAL: [preflight] Some fatal errors occurred: [ERROR ControlPlaneNodesReady]: there are NotReady control-planes in the cluster: [master] [preflight] If you know what you are doing, you can make a check non-fatal with `--ignore-preflight-errors=...` To see the stack trace of this error execute with --v=5 or higher \u89e3\u51b3\uff1a\uff08\u91cd\u65b0\u5b89\u88c5\u8be5\u7248\u672ckubelet\u548ckubectl\uff09 apt install kubelet=1.19.16-00 apt install kubectl=1.19.16-00","title":"\u4e3b\u8282\u70b9:"},{"location":"basic/k8s-update/#_3","text":"node\u8282\u70b9\u5347\u7ea7kubelet\u7684\u914d\u7f6e\uff08\u6240\u6709node\u8282\u70b9\uff09 sudo kubeadm upgrade node \u5b89\u88c5kubelet\u548ckubectl apt install -y kubelet = 1 .20.15-00 kubectl = 1 .20.15-00 kubelet --version # \u67e5\u770b\u7248\u672c Kubernetes v1.23.8","title":"\u4ece\u8282\u70b9:"},{"location":"basic/k8s-update/#_4","text":"","title":"\u9644\u4ef6"},{"location":"basic/k8s-update/#k8s_1","text":"\u95ee\u9898\uff1a \u5904\u7406k8s\u8bc1\u4e66\u8fc7\u671f","title":"k8s\u8bc1\u4e66\u8fc7\u671f\u5904\u7406"},{"location":"basic/overview/","text":"K8S\u7b80\u4ecb \u00b6","title":"K8S\u7b80\u4ecb"},{"location":"basic/overview/#k8s","text":"","title":"K8S\u7b80\u4ecb"},{"location":"error/dev/","text":"Dev\u96c6\u7fa4\u95ee\u9898 \u00b6 rook-ceph\u96c6\u7fa4\u5d29\u6e83 \u73b0\u8c61: rook-ceph\u96c6\u7fa4\u9664\u4e86mon\uff0c\u6240\u6709pod\u7684\u72b6\u6001\u5904\u4e8eCrashLoopBackOff mgr \u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c operator\u7684log\u4e2d\u65e0\u660e\u663e\u62a5\u9519\uff0cceph-cluster-controller: failed to get ceph daemons versions, this typically happens during the first cluster initialization. failed to run 'ceph versions' mon \u88aboperator\u4e00\u5171\u8d77\u67654\u4e2adeploy \u9519\u8bef\u76f8\u4f3c\u5ea6: https://github.com/rook/rook/issues/6530 \u521d\u6b65\u6000\u7591\u662frook-ceph\u7684osd\u548c\u7cfb\u7edf\u78c1\u76d8\u4f7f\u7528\u5feb\u6ee1\u800c\u5bfc\u81f4\u7684\u96c6\u7fa4\u5d29\u6e83\uff0c\u53ea\u6709mon\u6b63\u5e38\uff0cmgr\u548cosd\u90fd\u5f02\u5e38 \u65e0\u6cd5\u6b63\u5e38running $ kubectl -n rook-ceph get pod -w ... rook-ceph-mgr-a-7fd6649d8c-jqvmv 0 /1 CrashLoopBackOff 35 20h rook-ceph-osd-0-58c8d8ccf8-96wtd 0 /1 Init:CrashLoopBackOff 1 6s rook-ceph-osd-0-58c8d8ccf8-96wtd 0 /1 Init:2/4 2 18s rook-ceph-osd-0-58c8d8ccf8-96wtd 0 /1 Init:Error 2 19s rook-ceph-osd-0-58c8d8ccf8-96wtd 0 /1 Init:CrashLoopBackOff 2 31s \u9996\u5148\u9700\u8981\u5c06\u96c6\u7fa4\u6062\u590d\u5230\u6b63\u5e38\u7684\u4e00\u4e2a\u72b6\u6001\uff0c\u8fd9\u91cc\u6709\u4e2a\u95ee\u9898\u5c31\u662fmon\u4e00\u4e2a\u5904\u4e8e\u4e00\u4e2a4\u526f\u672c\u7684\u72b6\u6001,\u6709\u4e00\u4e2a\u526f\u672c\u72b6\u6001\u5f02\u5e38 \u67e5\u770b\u5f02\u5e38\u72b6\u6001\u4e0bmon\u7684configmap,\u8fd9\u9700\u8981\u5c06\u5f02\u5e38\u7684\u90a3\u4e2apod\u7684\u6240\u6709\u914d\u7f6e\u5220\u9664 $ kg configmap rook-ceph-mon-endpoints -o yaml apiVersion : v1 data : csi-cluster-config-json : '[{\"clusterID\":\"rook-ceph\",\"monitors\":[\"10.0.0.225:6789\",\"10.0.0.10:6789\",\"10.0.0.79:6789\",\"10.0.0.225:6789\"]}]' data : c=10.0.0.10:6789,a=10.0.0.79:6789,p=10.0.0.225:6789,q=10.0.0.225:6789 mapping : '{\"node\":{\"a\":{\"Name\":\"node1\",\"Hostname\":\"node1\",\"Address\":\"10.0.0.79\"},\"c\":{\"Name\":\"node0\",\"Hostname\":\"node0\",\"Address\":\"10.0.0.10\"},\"p\":{\"Name\":\"master0\",\"Hostname\":\"master0\",\"Address\":\"10.0.0.225\"},\"q\":{\"Name\":\"master0\",\"Hostname\":\"master0\",\"Address\":\"10.0.0.225\"}}}' maxMonId : \"16\" kind : ConfigMap metadata : creationTimestamp : \"2020-12-16T18:00:19Z\" name : rook-ceph-mon-endpoints namespace : rook-ceph ownerReferences : - apiVersion : ceph.rook.io/v1 blockOwnerDeletion : true controller : true kind : CephCluster name : rook-ceph uid : ee10d125-4428-4e88-983a-53190bc3411c resourceVersion : \"555335505\" uid : 1ee20194-f90e-4736-8d7f-89ac0314556c \u7559\u4e0b\u4e09\u4e2a\u6b63\u5e38\u7684mon $ k get configmap rook-ceph-mon-endpoints -o yaml apiVersion : v1 data : csi-cluster-config-json : '[{\"clusterID\":\"rook-ceph\",\"monitors\":[\"10.0.0.225:6789\",\"10.0.0.10:6789\",\"10.0.0.79:6789\"]}]' data : q=10.0.0.225:6789,c=10.0.0.10:6789,a=10.0.0.79:6789 mapping : '{\"node\":{\"a\":{\"Name\":\"node1\",\"Hostname\":\"node1\",\"Address\":\"10.0.0.79\"},\"c\":{\"Name\":\"node0\",\"Hostname\":\"node0\",\"Address\":\"10.0.0.10\"},\"q\":{\"Name\":\"master0\",\"Hostname\":\"master0\",\"Address\":\"10.0.0.225\"}}}' maxMonId : \"16\" kind : ConfigMap metadata : creationTimestamp : \"2020-12-16T18:00:19Z\" name : rook-ceph-mon-endpoints namespace : rook-ceph ownerReferences : - apiVersion : ceph.rook.io/v1 blockOwnerDeletion : true controller : true kind : CephCluster name : rook-ceph uid : ee10d125-4428-4e88-983a-53190bc3411c resourceVersion : \"555840878\" uid : 1ee20194-f90e-4736-8d7f-89ac0314556c \u4fee\u6539\u5b8c\u6210\u53d1\u73b0mgr\u6b63\u5728\u6062\u590d\uff0c\u96c6\u7fa4\u7684\u72b6\u6001\u6162\u6162\u6062\u590d\u6b63\u5e38,\u4e00\u76f4\u7b49\u5230\u96c6\u7fa4\u6062\u590d\u6b63\u5e38\u3002\u8fd9\u65f6\u67e5\u770b\u96c6\u7fa4\u7684\u72b6\u6001 \u8fd8\u662f\u6709\u4e00\u4e9b\u5f02\u5e38\uff0c\u5927\u6982\u7684\u610f\u601d\u5c31\u662fmon-a\u6240\u5728\u7684\u673a\u5668\u7684\u7cfb\u7edf\u76d8\u5feb\u6ee1\u4e86 \u9700\u8981\u8fdb\u884c\u4e0b\u4e00\u6b65\uff0c\u6269\u5bb9\u7cfb\u7edf\u76d8\uff0c\u673a\u5668\u5728ucloud\u4e91\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u5728ui\u754c\u9762\u8fdb\u884c\u6269\u5bb9\uff0c\u8fd9\u91cc\u53ef\u4ee5\u53c2\u8003 Ucloud\u6269\u5bb9 Ubuntu\uff1a sudo apt-get install cloud-initramfs-growroot LANG=en_US.UTF-8 growpart /dev/vda 1 \u8fd9\u65f6\uff0c\u6211\u4eec\u518d\u8fdb\u884c\u67e5\u770b\u6211\u4eec\u7684ceph\u96c6\u7fa4 [ root@rook-ceph-tools-84fc455b76-5dlwr / ] # ceph -s cluster: id: fc55d844-ed6b-4c0b-9f0f-a6b453ffb9b6 health: HEALTH_WARN 1 pool ( s ) do not have an application enabled 2 pool ( s ) have no replicas configured services: mon: 3 daemons, quorum a,c,q ( age 20h ) mgr: a ( active, since 18h ) mds: myfs:1 { 0 = myfs-b = up:active } 1 up:standby-replay osd: 7 osds: 7 up ( since 18h ) , 7 in ( since 18h ) task status: scrub status: mds.myfs-a: idle mds.myfs-b: idle data: pools: 6 pools, 241 pgs objects: 369 .17k objects, 92 GiB usage: 181 GiB used, 259 GiB / 440 GiB avail pgs: 241 active+clean io: client: 3 .3 KiB/s rd, 9 .3 KiB/s wr, 3 op/s rd, 1 op/s wr","title":"Dev\u73af\u5883\u96c6\u7fa4"},{"location":"error/dev/#dev","text":"rook-ceph\u96c6\u7fa4\u5d29\u6e83 \u73b0\u8c61: rook-ceph\u96c6\u7fa4\u9664\u4e86mon\uff0c\u6240\u6709pod\u7684\u72b6\u6001\u5904\u4e8eCrashLoopBackOff mgr \u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c operator\u7684log\u4e2d\u65e0\u660e\u663e\u62a5\u9519\uff0cceph-cluster-controller: failed to get ceph daemons versions, this typically happens during the first cluster initialization. failed to run 'ceph versions' mon \u88aboperator\u4e00\u5171\u8d77\u67654\u4e2adeploy \u9519\u8bef\u76f8\u4f3c\u5ea6: https://github.com/rook/rook/issues/6530 \u521d\u6b65\u6000\u7591\u662frook-ceph\u7684osd\u548c\u7cfb\u7edf\u78c1\u76d8\u4f7f\u7528\u5feb\u6ee1\u800c\u5bfc\u81f4\u7684\u96c6\u7fa4\u5d29\u6e83\uff0c\u53ea\u6709mon\u6b63\u5e38\uff0cmgr\u548cosd\u90fd\u5f02\u5e38 \u65e0\u6cd5\u6b63\u5e38running $ kubectl -n rook-ceph get pod -w ... rook-ceph-mgr-a-7fd6649d8c-jqvmv 0 /1 CrashLoopBackOff 35 20h rook-ceph-osd-0-58c8d8ccf8-96wtd 0 /1 Init:CrashLoopBackOff 1 6s rook-ceph-osd-0-58c8d8ccf8-96wtd 0 /1 Init:2/4 2 18s rook-ceph-osd-0-58c8d8ccf8-96wtd 0 /1 Init:Error 2 19s rook-ceph-osd-0-58c8d8ccf8-96wtd 0 /1 Init:CrashLoopBackOff 2 31s \u9996\u5148\u9700\u8981\u5c06\u96c6\u7fa4\u6062\u590d\u5230\u6b63\u5e38\u7684\u4e00\u4e2a\u72b6\u6001\uff0c\u8fd9\u91cc\u6709\u4e2a\u95ee\u9898\u5c31\u662fmon\u4e00\u4e2a\u5904\u4e8e\u4e00\u4e2a4\u526f\u672c\u7684\u72b6\u6001,\u6709\u4e00\u4e2a\u526f\u672c\u72b6\u6001\u5f02\u5e38 \u67e5\u770b\u5f02\u5e38\u72b6\u6001\u4e0bmon\u7684configmap,\u8fd9\u9700\u8981\u5c06\u5f02\u5e38\u7684\u90a3\u4e2apod\u7684\u6240\u6709\u914d\u7f6e\u5220\u9664 $ kg configmap rook-ceph-mon-endpoints -o yaml apiVersion : v1 data : csi-cluster-config-json : '[{\"clusterID\":\"rook-ceph\",\"monitors\":[\"10.0.0.225:6789\",\"10.0.0.10:6789\",\"10.0.0.79:6789\",\"10.0.0.225:6789\"]}]' data : c=10.0.0.10:6789,a=10.0.0.79:6789,p=10.0.0.225:6789,q=10.0.0.225:6789 mapping : '{\"node\":{\"a\":{\"Name\":\"node1\",\"Hostname\":\"node1\",\"Address\":\"10.0.0.79\"},\"c\":{\"Name\":\"node0\",\"Hostname\":\"node0\",\"Address\":\"10.0.0.10\"},\"p\":{\"Name\":\"master0\",\"Hostname\":\"master0\",\"Address\":\"10.0.0.225\"},\"q\":{\"Name\":\"master0\",\"Hostname\":\"master0\",\"Address\":\"10.0.0.225\"}}}' maxMonId : \"16\" kind : ConfigMap metadata : creationTimestamp : \"2020-12-16T18:00:19Z\" name : rook-ceph-mon-endpoints namespace : rook-ceph ownerReferences : - apiVersion : ceph.rook.io/v1 blockOwnerDeletion : true controller : true kind : CephCluster name : rook-ceph uid : ee10d125-4428-4e88-983a-53190bc3411c resourceVersion : \"555335505\" uid : 1ee20194-f90e-4736-8d7f-89ac0314556c \u7559\u4e0b\u4e09\u4e2a\u6b63\u5e38\u7684mon $ k get configmap rook-ceph-mon-endpoints -o yaml apiVersion : v1 data : csi-cluster-config-json : '[{\"clusterID\":\"rook-ceph\",\"monitors\":[\"10.0.0.225:6789\",\"10.0.0.10:6789\",\"10.0.0.79:6789\"]}]' data : q=10.0.0.225:6789,c=10.0.0.10:6789,a=10.0.0.79:6789 mapping : '{\"node\":{\"a\":{\"Name\":\"node1\",\"Hostname\":\"node1\",\"Address\":\"10.0.0.79\"},\"c\":{\"Name\":\"node0\",\"Hostname\":\"node0\",\"Address\":\"10.0.0.10\"},\"q\":{\"Name\":\"master0\",\"Hostname\":\"master0\",\"Address\":\"10.0.0.225\"}}}' maxMonId : \"16\" kind : ConfigMap metadata : creationTimestamp : \"2020-12-16T18:00:19Z\" name : rook-ceph-mon-endpoints namespace : rook-ceph ownerReferences : - apiVersion : ceph.rook.io/v1 blockOwnerDeletion : true controller : true kind : CephCluster name : rook-ceph uid : ee10d125-4428-4e88-983a-53190bc3411c resourceVersion : \"555840878\" uid : 1ee20194-f90e-4736-8d7f-89ac0314556c \u4fee\u6539\u5b8c\u6210\u53d1\u73b0mgr\u6b63\u5728\u6062\u590d\uff0c\u96c6\u7fa4\u7684\u72b6\u6001\u6162\u6162\u6062\u590d\u6b63\u5e38,\u4e00\u76f4\u7b49\u5230\u96c6\u7fa4\u6062\u590d\u6b63\u5e38\u3002\u8fd9\u65f6\u67e5\u770b\u96c6\u7fa4\u7684\u72b6\u6001 \u8fd8\u662f\u6709\u4e00\u4e9b\u5f02\u5e38\uff0c\u5927\u6982\u7684\u610f\u601d\u5c31\u662fmon-a\u6240\u5728\u7684\u673a\u5668\u7684\u7cfb\u7edf\u76d8\u5feb\u6ee1\u4e86 \u9700\u8981\u8fdb\u884c\u4e0b\u4e00\u6b65\uff0c\u6269\u5bb9\u7cfb\u7edf\u76d8\uff0c\u673a\u5668\u5728ucloud\u4e91\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u5728ui\u754c\u9762\u8fdb\u884c\u6269\u5bb9\uff0c\u8fd9\u91cc\u53ef\u4ee5\u53c2\u8003 Ucloud\u6269\u5bb9 Ubuntu\uff1a sudo apt-get install cloud-initramfs-growroot LANG=en_US.UTF-8 growpart /dev/vda 1 \u8fd9\u65f6\uff0c\u6211\u4eec\u518d\u8fdb\u884c\u67e5\u770b\u6211\u4eec\u7684ceph\u96c6\u7fa4 [ root@rook-ceph-tools-84fc455b76-5dlwr / ] # ceph -s cluster: id: fc55d844-ed6b-4c0b-9f0f-a6b453ffb9b6 health: HEALTH_WARN 1 pool ( s ) do not have an application enabled 2 pool ( s ) have no replicas configured services: mon: 3 daemons, quorum a,c,q ( age 20h ) mgr: a ( active, since 18h ) mds: myfs:1 { 0 = myfs-b = up:active } 1 up:standby-replay osd: 7 osds: 7 up ( since 18h ) , 7 in ( since 18h ) task status: scrub status: mds.myfs-a: idle mds.myfs-b: idle data: pools: 6 pools, 241 pgs objects: 369 .17k objects, 92 GiB usage: 181 GiB used, 259 GiB / 440 GiB avail pgs: 241 active+clean io: client: 3 .3 KiB/s rd, 9 .3 KiB/s wr, 3 op/s rd, 1 op/s wr","title":"Dev\u96c6\u7fa4\u95ee\u9898"},{"location":"error/tjtu/","text":"\u5929\u6d25\u5927\u5b66\u96c6\u7fa4\u95ee\u9898 \u00b6 \u95ee\u9898\u590d\u73b0 \u4ece\u4e0b\u56fe\u53ef\u4ee5\u770b\u51fa\u6709\u5f88\u591a\u7684\u4efb\u52a1\u5904\u4e8e\u6570\u636e\u540c\u6b65\u5173\u95ed\u7684\u4e00\u4e2a\u72b6\u6001 \u95ee\u9898\u6392\u67e5 \u67e5\u770bk8s\u96c6\u7fa4\u7684\u72b6\u6001\uff0c\u53d1\u73b0\u4e00\u4e0bpod\u5904\u4e8e\u5f02\u5e38\u72b6\u6001\uff0c\u8fd9\u4e9b\u5f02\u5e38\u7684pod\u53ea\u80fd\u5168\u90e8\u5220\u9664\u91cd\u5efa \u9700\u8981\u67e5\u770b\u4e00\u4e0b\u5f02\u5e38pod\u7684\u8be6\u7ec6\u4fe1\u606f \u95ee\u9898\u51fa\u73b0 \u4ee5\u4e0a\u53ef\u4ee5\u770b\u5230pod\u5728\u521b\u5efa\u7f16\u53f7\u4e3a9\u7684gpu\u51fa\u73b0\u62a5\u9519\uff0c\u5bfc\u81f4\u8fd9\u6837\u7684\u60c5\u51b5\u53ef\u80fd\u5c31\u662fgpu\u51fa\u95ee\u9898\u4e86 \u63a5\u4e0b\u6765\u53ef\u4ee5\u68c0\u67e5\u8fd9\u4e2apod\u6240\u5728\u7684\u673a\u5668\u4e0a\u7684gpu\uff0c\u770b\u662f\u5426\u51fa\u73b0\u95ee\u9898 \u53ef\u4ee5\u901a\u8fc7 nvidia-smi -L \u547d\u4ee4\u6765\u67e5\u770b \u68c0\u67e5gpu \u51fa\u73b0\u4ee5\u4e0b\u60c5\u51b5\uff0c\u5c1d\u8bd5\u91cd\u542f\u770b\u770b\u662f\u5426\u80fd\u4fee\u590d \u5929\u6d25\u5927\u5b66\u96c6\u7fa4gpu\u786c\u4ef6\u635f\u574f GPU\u635f\u574f \u53ef\u4ee5\u901a\u8fc7nvidia-smi -L \u67e5\u770bgpu\u60c5\u51b5 nvidia-smi Unable to determine the device handle for GPU 0000 :89:00.0: Unknown Error \u611f\u89c9\u662f\u8fd9\u5757\u5361 0000:89:00.0 \u51fa\u95ee\u9898\u4e86\u3002\u7136\u540e\u53bb\u6267\u884c\u4e0b dmesg \u770b\u770b\u60c5\u51b5\uff1a $ dmesg -T [ Mon May 9 20 :37:33 2022 ] xhci_hcd 0000 :89:00.2: PCI post-resume error -19! [ Mon May 9 20 :37:33 2022 ] xhci_hcd 0000 :89:00.2: HC died ; cleaning up [ Mon May 9 20 :37:34 2022 ] nvidia-gpu 0000 :89:00.3: i2c timeout error ffffffff [ Mon May 9 20 :37:34 2022 ] ucsi_ccg 6 -0008: i2c_transfer failed -110 $ nvidia-smi drain -p 0000 :89:00.0 -m 1 Successfully set GPU 00000000 :89:00.0 drain state to: drainin \u5c4f\u853d\u5b8c\u6210\u8fd9\u53f0\u673a\u5668\uff0c\u9700\u8981\u8fdb\u884c\u91cd\u65b0\u542f\u52a8","title":"\u5929\u6d25\u96c6\u7fa4"},{"location":"error/tjtu/#_1","text":"\u95ee\u9898\u590d\u73b0 \u4ece\u4e0b\u56fe\u53ef\u4ee5\u770b\u51fa\u6709\u5f88\u591a\u7684\u4efb\u52a1\u5904\u4e8e\u6570\u636e\u540c\u6b65\u5173\u95ed\u7684\u4e00\u4e2a\u72b6\u6001 \u95ee\u9898\u6392\u67e5 \u67e5\u770bk8s\u96c6\u7fa4\u7684\u72b6\u6001\uff0c\u53d1\u73b0\u4e00\u4e0bpod\u5904\u4e8e\u5f02\u5e38\u72b6\u6001\uff0c\u8fd9\u4e9b\u5f02\u5e38\u7684pod\u53ea\u80fd\u5168\u90e8\u5220\u9664\u91cd\u5efa \u9700\u8981\u67e5\u770b\u4e00\u4e0b\u5f02\u5e38pod\u7684\u8be6\u7ec6\u4fe1\u606f \u95ee\u9898\u51fa\u73b0 \u4ee5\u4e0a\u53ef\u4ee5\u770b\u5230pod\u5728\u521b\u5efa\u7f16\u53f7\u4e3a9\u7684gpu\u51fa\u73b0\u62a5\u9519\uff0c\u5bfc\u81f4\u8fd9\u6837\u7684\u60c5\u51b5\u53ef\u80fd\u5c31\u662fgpu\u51fa\u95ee\u9898\u4e86 \u63a5\u4e0b\u6765\u53ef\u4ee5\u68c0\u67e5\u8fd9\u4e2apod\u6240\u5728\u7684\u673a\u5668\u4e0a\u7684gpu\uff0c\u770b\u662f\u5426\u51fa\u73b0\u95ee\u9898 \u53ef\u4ee5\u901a\u8fc7 nvidia-smi -L \u547d\u4ee4\u6765\u67e5\u770b \u68c0\u67e5gpu \u51fa\u73b0\u4ee5\u4e0b\u60c5\u51b5\uff0c\u5c1d\u8bd5\u91cd\u542f\u770b\u770b\u662f\u5426\u80fd\u4fee\u590d \u5929\u6d25\u5927\u5b66\u96c6\u7fa4gpu\u786c\u4ef6\u635f\u574f GPU\u635f\u574f \u53ef\u4ee5\u901a\u8fc7nvidia-smi -L \u67e5\u770bgpu\u60c5\u51b5 nvidia-smi Unable to determine the device handle for GPU 0000 :89:00.0: Unknown Error \u611f\u89c9\u662f\u8fd9\u5757\u5361 0000:89:00.0 \u51fa\u95ee\u9898\u4e86\u3002\u7136\u540e\u53bb\u6267\u884c\u4e0b dmesg \u770b\u770b\u60c5\u51b5\uff1a $ dmesg -T [ Mon May 9 20 :37:33 2022 ] xhci_hcd 0000 :89:00.2: PCI post-resume error -19! [ Mon May 9 20 :37:33 2022 ] xhci_hcd 0000 :89:00.2: HC died ; cleaning up [ Mon May 9 20 :37:34 2022 ] nvidia-gpu 0000 :89:00.3: i2c timeout error ffffffff [ Mon May 9 20 :37:34 2022 ] ucsi_ccg 6 -0008: i2c_transfer failed -110 $ nvidia-smi drain -p 0000 :89:00.0 -m 1 Successfully set GPU 00000000 :89:00.0 drain state to: drainin \u5c4f\u853d\u5b8c\u6210\u8fd9\u53f0\u673a\u5668\uff0c\u9700\u8981\u8fdb\u884c\u91cd\u65b0\u542f\u52a8","title":"\u5929\u6d25\u5927\u5b66\u96c6\u7fa4\u95ee\u9898"},{"location":"network/ZeroTier/","text":"ZeroTier \u5185\u7f51 \u00b6 \u80cc\u666f \u00b6 \u968f\u7740\u4e92\u8054\u7f51\u7684\u666e\u53ca\uff0c\u53ef\u7528\u7684\u516c\u7f51 IPv4 \u5730\u5740\u8d8a\u6765\u8d8a\u5c11\uff0c\u73b0\u5728\u7684\u8fd0\u8425\u5546\u57fa\u672c\u4e0d\u7ed9\u5bb6\u7528\u5bbd\u5e26\u5206\u914d\u516c\u7f51 IP \u4e86\u3002\u5982\u679c\u4f60\u60f3\u901a\u8fc7\u5916\u7f51\u8bbf\u95ee\u5230\u5185\u7f51\u7684\u8d44\u6e90\uff0c\u76ee\u524d\u53ea\u80fd\u91c7\u7528\u5185\u7f51\u7a7f\u900f\u7684\u8f6f\u4ef6\u6765\u5b9e\u73b0\u3002\u5e38\u89c1\u7684\u5185\u7f51\u7a7f\u900f\u5982: frp \u8fd9\u6837\u7684\u5de5\u5177\uff0c\u4f46\u662f\u5982\u679c\u8981\u4f7f\u7528\u8fd9\u6837\u7684\u5de5\u5177\u9700\u8981\u6709\u4e00\u53f0\u5177\u5907\u516c\u7f51\u5730\u5740\u7684\u670d\u52a1\u5668\u624d\u53ef\u4ee5\u3002 \u505a\u4e3a\u4e00\u540d\u4f18\u79c0\u7684\u6280\u672f\u4eba\u5458\uff0c\u5f53\u7136\u662f\u80fd\u767d\u5ad6\u5c31\u767d\u5ad6\uff0c\u4e0b\u9762\u4e3b\u8981\u6765\u4ecb\u7ecd\u4e00\u6b3e\u4e0d\u9700\u8981\u516c\u7f51\u7684P2P\u5de5\u5177ZeroTier \u539f\u7406 \u00b6 ZeroTier \u8fd9\u4e00\u7c7b P2P VPN \u662f\u5728\u4e92\u8054\u7f51\u7684\u57fa\u7840\u4e0a\u5c06\u81ea\u5df1\u7684\u6240\u6709\u8bbe\u5907\u7ec4\u6210\u4e00\u4e2a\u79c1\u6709\u7684\u7f51\u7edc\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e92\u8054\u7f51\u8fde\u63a5\u7684\u5c40\u57df\u7f51\u3002 \u5927\u767d\u8bdd\u5c31\u662f\u4e00\u5806\u670d\u52a1\u5668\u5b89\u88c5\u4e0a\u8fd9\u4e2a\u8f6f\u4ef6\u5c31\u7ec4\u5efa\u4e86\u4e00\u4e2a\u5185\u7f51\uff0c\u5927\u5bb6\u901a\u8fc7\u8fd9\u4e2a\u7279\u5b9a\u7f51\u6bb5\u5185\u7f51\u53ef\u4ee5\u4e92\u76f8\u8bbf\u95ee\u3002 \u4f18\u70b9 \u5185\u7f51\u7a7f\u900f\u5de5\u5177\uff08\u514d\u8d39\uff09 ZeroTier \u652f\u6301 Windows\u3001macOS\u3001Linux \u4e09\u5927\u4e3b\u6d41\u5e73\u53f0\uff0ciOS\u3001Android \u4e24\u5927\u79fb\u52a8\u5e73\u53f0 \u6211\u4eec\u6b63\u5728\u9010\u6b65\u7528 Tailscale \u66ff\u6362\u6389 ZeroTier \u7f51\u7edc\uff0cZeroTier \u5c06\u4f5c\u4e3a Tailscale \u4e0d\u53ef\u7528\u65f6\u7684\u5907\u9009\u65b9\u6848 \u5b98\u7f51\u5730\u5740: https://www.zerotier.com/ \u4e0b\u8f7d\u5ba2\u6237\u7aef: https://www.zerotier.com/download/ Linux (DEB/RPM) \u00b6 curl -s https://install.zerotier.com | sudo bash macOS \u00b6 \u53ef\u9009\u62e9\u5b98\u65b9\u7684 DMG \u5b89\u88c5\uff0c\u6216\u4ece Homebrew \u8fdb\u884c\u5b89\u88c5\uff1a brew cask install zerotier-one \u6e29\u99a8\u63d0\u793a \u6211\u8fd9\u8fb9\u4e3b\u8981\u662f\u4ee5\u4f7f\u7528linux\u548cmac\u4e3a\u4e3b\uff0c\u5176\u4ed6\u5e73\u53f0\u8bf7\u76f4\u63a5\u8bbf\u95ee\u4e0a\u65b9\u7684 Zerotier \u5b98\u7f51\u8fdb\u884c\u4e0b\u8f7d \u5b89\u88c5 \u00b6 \u64cd\u4f5c\u6b65\u9aa4 Linux\u6216\u8005Mac\u5b89\u88c5zerotier \u52a0\u5165\u5230zerotier\u7f51\u7edc zerotier\u7684UI\u754c\u9762\u52fe\u9009\u521a\u521a\u6dfb\u52a0\u7684\u8282\u70b9 \u5b89\u88c5: \u53c2\u8003\u5b98\u7f51 curl -s https://install.zerotier.com | sudo bash \u8282\u70b9\u52a0\u5165zerotier\u7f51\u7edc\uff0c\u52a0\u5165\u7f51\u7edc\u4e4b\u524d\u9700\u8981\u63d0\u524d\u521b\u5efa\u8fd9\u4e2a\u7f51\u7edc root@user:/home/user# zerotier-cli join b15644912ebd050d 200 join OK \u767b\u9646\u81ea\u5df1\u7684zerotier\u5e10\u53f7\uff0c\u52fe\u9009\u5141\u8bb8\u5bf9\u5e94\u673a\u5668\u5c31\u53ef\u4ee5\u4e86\uff0c\u8fd9\u91cc\u63a8\u8350\u4f7f\u7528github\u5e10\u53f7\u3002","title":"ZeroTier\u7ec4\u7f51"},{"location":"network/ZeroTier/#zerotier","text":"","title":"ZeroTier \u5185\u7f51"},{"location":"network/ZeroTier/#_1","text":"\u968f\u7740\u4e92\u8054\u7f51\u7684\u666e\u53ca\uff0c\u53ef\u7528\u7684\u516c\u7f51 IPv4 \u5730\u5740\u8d8a\u6765\u8d8a\u5c11\uff0c\u73b0\u5728\u7684\u8fd0\u8425\u5546\u57fa\u672c\u4e0d\u7ed9\u5bb6\u7528\u5bbd\u5e26\u5206\u914d\u516c\u7f51 IP \u4e86\u3002\u5982\u679c\u4f60\u60f3\u901a\u8fc7\u5916\u7f51\u8bbf\u95ee\u5230\u5185\u7f51\u7684\u8d44\u6e90\uff0c\u76ee\u524d\u53ea\u80fd\u91c7\u7528\u5185\u7f51\u7a7f\u900f\u7684\u8f6f\u4ef6\u6765\u5b9e\u73b0\u3002\u5e38\u89c1\u7684\u5185\u7f51\u7a7f\u900f\u5982: frp \u8fd9\u6837\u7684\u5de5\u5177\uff0c\u4f46\u662f\u5982\u679c\u8981\u4f7f\u7528\u8fd9\u6837\u7684\u5de5\u5177\u9700\u8981\u6709\u4e00\u53f0\u5177\u5907\u516c\u7f51\u5730\u5740\u7684\u670d\u52a1\u5668\u624d\u53ef\u4ee5\u3002 \u505a\u4e3a\u4e00\u540d\u4f18\u79c0\u7684\u6280\u672f\u4eba\u5458\uff0c\u5f53\u7136\u662f\u80fd\u767d\u5ad6\u5c31\u767d\u5ad6\uff0c\u4e0b\u9762\u4e3b\u8981\u6765\u4ecb\u7ecd\u4e00\u6b3e\u4e0d\u9700\u8981\u516c\u7f51\u7684P2P\u5de5\u5177ZeroTier","title":"\u80cc\u666f"},{"location":"network/ZeroTier/#_2","text":"ZeroTier \u8fd9\u4e00\u7c7b P2P VPN \u662f\u5728\u4e92\u8054\u7f51\u7684\u57fa\u7840\u4e0a\u5c06\u81ea\u5df1\u7684\u6240\u6709\u8bbe\u5907\u7ec4\u6210\u4e00\u4e2a\u79c1\u6709\u7684\u7f51\u7edc\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e92\u8054\u7f51\u8fde\u63a5\u7684\u5c40\u57df\u7f51\u3002 \u5927\u767d\u8bdd\u5c31\u662f\u4e00\u5806\u670d\u52a1\u5668\u5b89\u88c5\u4e0a\u8fd9\u4e2a\u8f6f\u4ef6\u5c31\u7ec4\u5efa\u4e86\u4e00\u4e2a\u5185\u7f51\uff0c\u5927\u5bb6\u901a\u8fc7\u8fd9\u4e2a\u7279\u5b9a\u7f51\u6bb5\u5185\u7f51\u53ef\u4ee5\u4e92\u76f8\u8bbf\u95ee\u3002 \u4f18\u70b9 \u5185\u7f51\u7a7f\u900f\u5de5\u5177\uff08\u514d\u8d39\uff09 ZeroTier \u652f\u6301 Windows\u3001macOS\u3001Linux \u4e09\u5927\u4e3b\u6d41\u5e73\u53f0\uff0ciOS\u3001Android \u4e24\u5927\u79fb\u52a8\u5e73\u53f0 \u6211\u4eec\u6b63\u5728\u9010\u6b65\u7528 Tailscale \u66ff\u6362\u6389 ZeroTier \u7f51\u7edc\uff0cZeroTier \u5c06\u4f5c\u4e3a Tailscale \u4e0d\u53ef\u7528\u65f6\u7684\u5907\u9009\u65b9\u6848 \u5b98\u7f51\u5730\u5740: https://www.zerotier.com/ \u4e0b\u8f7d\u5ba2\u6237\u7aef: https://www.zerotier.com/download/","title":"\u539f\u7406"},{"location":"network/ZeroTier/#linux-debrpm","text":"curl -s https://install.zerotier.com | sudo bash","title":"Linux (DEB/RPM)"},{"location":"network/ZeroTier/#macos","text":"\u53ef\u9009\u62e9\u5b98\u65b9\u7684 DMG \u5b89\u88c5\uff0c\u6216\u4ece Homebrew \u8fdb\u884c\u5b89\u88c5\uff1a brew cask install zerotier-one \u6e29\u99a8\u63d0\u793a \u6211\u8fd9\u8fb9\u4e3b\u8981\u662f\u4ee5\u4f7f\u7528linux\u548cmac\u4e3a\u4e3b\uff0c\u5176\u4ed6\u5e73\u53f0\u8bf7\u76f4\u63a5\u8bbf\u95ee\u4e0a\u65b9\u7684 Zerotier \u5b98\u7f51\u8fdb\u884c\u4e0b\u8f7d","title":"macOS"},{"location":"network/ZeroTier/#_3","text":"\u64cd\u4f5c\u6b65\u9aa4 Linux\u6216\u8005Mac\u5b89\u88c5zerotier \u52a0\u5165\u5230zerotier\u7f51\u7edc zerotier\u7684UI\u754c\u9762\u52fe\u9009\u521a\u521a\u6dfb\u52a0\u7684\u8282\u70b9 \u5b89\u88c5: \u53c2\u8003\u5b98\u7f51 curl -s https://install.zerotier.com | sudo bash \u8282\u70b9\u52a0\u5165zerotier\u7f51\u7edc\uff0c\u52a0\u5165\u7f51\u7edc\u4e4b\u524d\u9700\u8981\u63d0\u524d\u521b\u5efa\u8fd9\u4e2a\u7f51\u7edc root@user:/home/user# zerotier-cli join b15644912ebd050d 200 join OK \u767b\u9646\u81ea\u5df1\u7684zerotier\u5e10\u53f7\uff0c\u52fe\u9009\u5141\u8bb8\u5bf9\u5e94\u673a\u5668\u5c31\u53ef\u4ee5\u4e86\uff0c\u8fd9\u91cc\u63a8\u8350\u4f7f\u7528github\u5e10\u53f7\u3002","title":"\u5b89\u88c5"},{"location":"network/frp/","text":"\u4e00\u3001\u5185\u7f51\u7a7f\u900fFrp\uff1a \u00b6 \u4e0b\u8f7d\u5730\u5740\uff1a https://github.com/fatedier/frp/releases 1.1\u3001\u6982\u8ff0\uff1a \u00b6 1.1.1\uff1afrp\u5185\u7f51\u7a7f\u900f\u5de5\u5177\uff1a \u00b6 \u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684\u53cd\u5411\u4ee3\u7406\u5e94\u7528\uff0c\u53ef\u4ee5\u5e2e\u52a9\u60a8\u8f7b\u677e\u5730\u8fdb\u884c\u5185\u7f51\u7a7f\u900f\uff0c\u5bf9\u5916\u7f51\u63d0\u4f9b\u670d\u52a1\uff0c\u652f\u6301 tcp, http, https \u7b49\u534f\u8bae\u7c7b\u578b\uff0c\u5e76\u4e14 web \u670d\u52a1\u652f\u6301\u6839\u636e\u57df\u540d\u8fdb\u884c\u8def\u7531\u8f6c\u53d1\u3002 1.1.2\uff1afrp\u7684\u4f5c\u7528\uff1a \u00b6 \u5229\u7528\u5904\u4e8e\u5185\u7f51\u6216\u9632\u706b\u5899\u540e\u7684\u673a\u5668\uff0c\u5bf9\u5916\u7f51\u73af\u5883\u63d0\u4f9b http \u6216 https \u670d\u52a1\u3002 \u5bf9\u4e8e http \u670d\u52a1\u652f\u6301\u57fa\u4e8e\u57df\u540d\u7684\u865a\u62df\u4e3b\u673a\uff0c\u652f\u6301\u81ea\u5b9a\u4e49\u57df\u540d\u7ed1\u5b9a\uff0c\u4f7f\u591a\u4e2a\u57df\u540d\u53ef\u4ee5\u5171\u7528\u4e00\u4e2a80\u7aef\u53e3\u3002 \u5229\u7528\u5904\u4e8e\u5185\u7f51\u6216\u9632\u706b\u5899\u540e\u7684\u673a\u5668\uff0c\u5bf9\u5916\u7f51\u73af\u5883\u63d0\u4f9b tcp \u670d\u52a1\uff0c\u4f8b\u5982\u5728\u5bb6\u91cc\u901a\u8fc7 ssh \u8bbf\u95ee\u5904\u4e8e\u516c\u53f8\u5185\u7f51\u73af\u5883\u5185\u7684\u4e3b\u673a\u3002 \u53ef\u67e5\u770b\u901a\u8fc7\u4ee3\u7406\u7684\u6240\u6709 http \u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u8be6\u7ec6\u4fe1\u606f\u3002\uff08\u5f85\u5f00\u53d1\uff09 2.1\u3001\u9879\u76ee\u601d\u8def\u53ca\u91cd\u96be\u70b9\u5185\u5bb9 \u00b6 \u6e29\u99a8\u63d0\u793a \u4ee5\u4e0b\u6b65\u9aa4\u53ea\u9488\u5bf9\u9488\u5bf9\u4e8ecentos \u64cd\u4f5c\u7cfb\u7edf 2.1.1\uff1a\u9879\u76ee\u62d3\u6251\u56fe\uff1a \u00b6 2.1.2\uff1a\u5b9e\u9a8c\u601d\u8def\uff1a \u00b6 \u7b2c\u4e00\u6b65 \u8d2d\u4e70\u4e00\u53f0\u4e91\u670d\u52a1\u5668\u4f5c\u4e3afrp-server\u7aef\uff0c\u4e3b\u8981\u662f\u9700\u8981\u4e00\u4e2a\u56fa\u5b9a\u516c\u7f51\u5730\u5740\uff0c\u5982\u679c\u516c\u53f8\u6709\u56fa\u5b9a\u516c\u7f51\u5730\u5740\u6700\u597d \u7b2c\u4e8c\u6b65 \u5728\u516c\u53f8\u6216\u8005\u5185\u7f51\u51c6\u5907\u4e00\u53f0\u4e3b\u673a\u4f5c\u4e3afrp-client\u7aef \u7b2c\u4e09\u6b65 \u5728\u516c\u53f8\u6216\u8005\u5185\u7f51\u51c6\u5907\u4e00\u53f0\u4e3b\u673a\u6765\u90e8\u7f72vpn \u7b2c\u56db\u6b65 \u5229\u7528\u7a7f\u900f\u6765\u5b9e\u73b0\u8fde\u63a5VPN 2.1.3\uff1afrp\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e\uff1a \u00b6 [ root@localhost frpc ] # ll \u603b\u7528\u91cf 21136 -rwxr-xr-x 1 root root 10466752 8\u6708 18 2021 frpc -rw-r--r-- 1 root root 6818 8\u6708 18 2021 frpc_full.ini -rw-r--r-- 1 root root 283 5\u6708 2 23 :35 frpc.ini -rwxr-xr-x 1 root root 11133376 8\u6708 18 2021 frps -rw-r--r-- 1 root root 2199 8\u6708 18 2021 frps_full.ini -rw-r--r-- 1 root root 26 8\u6708 18 2021 frps.ini -rw-r--r-- 1 root root 11358 8\u6708 18 2021 LICENSE -rw-r--r-- 1 root root 21 8\u6708 18 2021 run.sh drwxrwxr-x 2 root root 88 8\u6708 18 2021 systemd \u6587\u4ef6\u8bf4\u660e\uff1a frpc # \u5ba2\u6237\u7aef\u4e8c\u8fdb\u5236\u6587\u4ef6 frpc_full.ini # \u5ba2\u6237\u7aef\u914d\u7f6e\u6587\u4ef6\u5b8c\u6574\u793a\u4f8b frpc.ini # \u5ba2\u6237\u7aef\u914d\u7f6e\u6587\u4ef6 frps # \u670d\u52a1\u7aef\u4e8c\u8fdb\u5236\u6587\u4ef6 frps_full.ini # \u670d\u52a1\u7aef\u914d\u7f6e\u6587\u4ef6\u5b8c\u6574\u793a\u4f8b frps.in1 # \u670d\u52a1\u7aef\u914d\u7f6e\u6587\u4ef6 3.1\u3001Frp\u90e8\u7f72\uff1a \u00b6 3.1.1\uff1a\u90e8\u7f72frps\uff1a \u00b6 \u6ce8\u91ca\uff1a\u4e00\u822cfrps \u662f\u516c\u7f51\u4e0a\u7684\u4e00\u53f0\u4e91\u670d\u52a1\u5668\uff0c\u8fd9\u91cc\u53ef\u4ee5\u662f\u4efb\u610f\u7684\u4e91\u5e73\u53f0\uff0c\u6ce8\u610f\u4e00\u5b9a\u8bb0\u5f97\u5f00\u5b89\u5168\u7ec4\uff01\uff01\uff01 [ root@VM-16-9-centos frps ] # cat frps.ini [ common ] bind_port = 50070 vhost_http_port = 50080 vhost_https_port = 50443 token = $pF @7zz^LDuh7^xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx \u8fd9\u4e2atoken\u662f\u7528\u4e8e\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u8fde\u63a5 # \u542f\u52a8 ./frps -c ./frps.ini 3.1.2\uff1a\u90e8\u7f72frpc\uff1a \u00b6 [ root@moban frp_0.38.0_linux_amd64 ] # cat frpc.ini [ common ] server_addr = 115 .29.189.57 # server_addr\u8868\u793a\u4e0efrps\u8fde\u63a5\u7684\u5730\u5740 server_port = 50081 # \u4e0efrps\u8fde\u63a5\u7684\u7aef\u53e3 token = pass@word1 # \u914d\u7f6etoken\u7528\u6765\u9a8c\u8bc1 [ openvpn ] type = udp local_ip = 192 .168.8.82 local_port = 51194 remote_port = 51194 # remote_port\u8868\u793a\u7528\u6237\u8bbf\u95ee\u516c\u7f51\u5730\u5740+\u7aef\u53e3,\u5c31\u53cd\u5411\u4ee3\u7406\u5230local_ip+\u7aef\u53e3 # \u542f\u52a8 ./frps -c ./frps.ini 3.1.3\uff1anj\u5730\u533a\uff1a192.165.0.20 \u00b6 [ root@moban frp_0.26.0_linux_amd64 ] # cat frpc.ini [ common ] tls_enable = true server_addr = 39 .104.160.84 server_port = 50070 token = $pF @xxxxxx [ openvpn-nj ] type = udp local_ip = 192 .165.0.21 local_port = 31194 remote_port = 31194 [ root@moban frp_0.26.0_linux_amd64 ] # cat frp.sh ./frpc -c ./frpc.ini 3.1.4\uff1abj\u5730\u533a\uff1a \u00b6 [ root@frp-40 frpc ] # cat frpc.ini [ common ] tls_enable = true server_addr = 39 .104.160.84 server_port = 50070 token = $pF @7zz^LDuh7^X0Uxxxxx 4.1\u3001vpn\u90e8\u7f72\uff1a \u00b6 4.4.1\uff1avpn\u90e8\u7f72\u811a\u672c\uff1a \u00b6 #!/bin/bash # \u642d\u5efavpenvpn\u811a\u672c # \u4f5c\u8005:lixie # \u65e5\u671f:2021-10-19 # openvpn\u662f\u670d\u52a1\u7aef,easy-rsa\u662f\u8bc1\u4e66\u7ba1\u7406\u5de5\u5177 yum -y install wget mkdir -p /etc/yum.repos.d/backup mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup/ wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo yum -y install openvpn easy-rsa & > /dev/null # \u83b7\u53d6openvpn\u548ceasy-rsa\u7684\u7248\u672c OPENVER = $( rpm -qi openvpn | awk -F \": \" 'NR==2{print $2}' ) EASYVER = $( rpm -qi easy-rsa | awk -F \": \" 'NR==2{print $2}' ) #echo \"openvpn-$OPENVER\" #echo \"easy-rsa-$EASYVER\" #\u751f\u6210\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6 #cp /usr/share/doc/openvpn-$OPENVER/sample/sample-config-files/server.conf /etc/openvpn/ cat << EOF >> /etc/openvpn/server/server.conf local 0.0.0.0 port 41194 proto udp dev tun ca /etc/openvpn/certs/ca.crt cert /etc/openvpn/certs/server.crt dh /etc/openvpn/certs/dh.pem push \"route 192.168.0.0 255.255.0.0\" server 10.10.0.0 255.255.255.0 ifconfig-pool-persist /var/log/openvpn/ipp.txt client-to-client keepalive 10 120 comp-lzo max-clients 100 persist-key persist-tun status /var/log/openvpn/openvpn-status.log log-append /var/log/openvpn/openvpn.log verb 3 key /etc/openvpn/certs/server.key cipher AES-256-CBC client-config-dir /etc/openvpn/ccd auth-user-pass-verify /etc/openvpn/checkpsw.sh via-env username-as-common-name script-security 3 verify-client-cert none EOF # \u6ce8\u610f\uff01\uff01\uff01 \u8fd9\u91cc\u521b\u5efa\u5b8c\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u9700\u8981\u505a\u4e2a\u914d\u7f6e\u6587\u4ef6\u7684\u8f6f\u8fde\u63a5\uff0c\u56e0\u4e3a\u5f53\u524d\u7248\u672c\u7684 openvpn systemd \u542f\u52a8\u6587\u4ef6\u4e2d\u8bfb\u53d6\u7684\u662f.service.conf\u914d\u7f6e cd /etc/openvpn/server/ && ln -sf server.conf .service.conf #\u51c6\u5907\u8bc1\u4e66\u7b7e\u53d1\u76f8\u5173\u6587\u4ef6 cp -r /usr/share/easy-rsa/ /etc/openvpn/easy-rsa-server #\u51c6\u5907\u7b7e\u53d1\u8bc1\u4e66\u76f8\u5173\u53d8\u91cf\u7684\u914d\u7f6e\u6587\u4ef6 cp /usr/share/doc/easy-rsa- $EASYVER /vars.example /etc/openvpn/easy-rsa-server/3/vars #CA\u7684\u8bc1\u4e66\u6709\u6548\u671f\u9ed8\u4e3a\u4e3a10\u5e74,\u53ef\u4ee5\u9002\u5f53\u5ef6\u957f,\u6bd4\u5982:36500\u5929 sed -i '/3650/ s/3650/36500/g' /etc/openvpn/easy-rsa-server/3/vars #\u670d\u52a1\u5668\u8bc1\u4e66\u9ed8\u4e3a\u4e3a825\u5929 sed -i '/825/ s/825/82500/g' /etc/openvpn/easy-rsa-server/3/vars \u521d\u59cb\u5316\u6570\u636e,\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u751f\u6210pki\u76ee\u5f55\u53ca\u76f8\u5173\u6587\u4ef6 cd /etc/openvpn/easy-rsa-server/3/ pwd ./easyrsa init-pki \u521b\u5efaCA\u673a\u6784 cd /etc/openvpn/easy-rsa-server/3 ./easyrsa build-ca nopass <<EOF EOF # \u521b\u5efa\u670d\u52a1\u7aef\u8bc1\u4e66\u7533\u8bf7 cd /etc/openvpn/easy-rsa-server/3 ./easyrsa gen-req server nopass <<EOF EOF ## \u9881\u53d1\u670d\u52a1\u7aef\u8bc1\u4e66 # cd /etc/openvpn/easy-rsa-server/3 ./easyrsa sign server server <<EOF yes EOF # \u521b\u5efa Diffie-Hellman \u5bc6\u94a5,\u8fd9\u4e2a\u6b65\u9aa4\u5b8c\u4e86\u670d\u52a1\u5668\u90e8\u5206\u5c31\u5b8c\u6210\u4e86 cd /etc/openvpn/easy-rsa-server/3 ./easyrsa gen-dh #\u4e3a\u5ba2\u6237\u7aef\u51c6\u5907\u8bc1\u4e66\u73af\u5883 cp -r /usr/share/easy-rsa/ /etc/openvpn/easy-rsa-client cp /usr/share/doc/easy-rsa- $EASYVER /vars.example /etc/openvpn/easy-rsa-client/3/vars cd /etc/openvpn/easy-rsa-client/3/ ./easyrsa init-pki # \u5c06CA\u548c\u670d\u52a1\u5668\u8bc1\u4e66\u76f8\u5173\u6587\u4ef6\u590d\u5236\u5230\u670d\u52a1\u5668\u76f8\u5e94\u7684\u76ee\u5f55 mkdir /etc/openvpn/certs cp /etc/openvpn/easy-rsa-server/3/pki/ca.crt /etc/openvpn/certs/ cp /etc/openvpn/easy-rsa-server/3/pki/issued/server.crt /etc/openvpn/certs/ cp /etc/openvpn/easy-rsa-server/3/pki/private/server.key /etc/openvpn/certs/ cp /etc/openvpn/easy-rsa-server/3/pki/dh.pem /etc/openvpn/certs/ # \u4fee\u6539\u670d\u52a1\u5668\u7aef\u914d\u7f6e\u6587\u4ef6 # \u521b\u5efa\u65e5\u5fd7\u76ee\u5f55 mkdir /etc/openvpn/ccd mkdir /var/log/openvpn chown openvpn.openvpn /var/log/openvpn cat <<EOF>> /etc/openvpn/psw-file LIXIE ABC123, EOF chmod 600 /etc/openvpn/psw-file chown openvpn:openvpn /etc/openvpn/psw-file chmod +x /etc/openvpn/checkpsw.sh chown -R openvpn:openvpn /etc/openvpn/ #\u5728\u670d\u52a1\u5668\u5f00\u542fip_forward\u8f6c\u53d1\u529f\u80fd echo net.ipv4.ip_forward = 1 >> /etc/sysctl.conf && sysctl -p & > /dev/null echo 'iptables -t nat -A POSTROUTING -s 10.10.0.0/24 -j MASQUERADE' >> /etc/rc.d/rc.local chmod +x /etc/rc.d/rc.local /etc/rc.d/rc.local systemctl daemon-reload systemctl start openvpn-server@.service.service systemctl enable openvpn-server@.service.service 4.4.2\uff1a\u65b0\u589e\u7528\u6237\u811a\u672c\uff1a \u00b6 cat <<EOF>> /etc/openvpn/checkpsw.sh #!/bin/sh ########################################################### # checkpsw.sh (C) 2004 Mathias Sundman <mathias@openvpn.se> # # This script will authenticate OpenVPN users against # a plain text file. The passfile should simply contain # one row per user with the username first followed by # one or more space(s) or tab(s) and then the password. PASSFILE=\"/etc/openvpn/psw-file\" LOG_FILE=\"/var/log/openvpn/password.log\" TIME_STAMP=`date \"+%Y-%m-%d %T\"` ########################################################### if [ ! -r \"${PASSFILE}\" ]; then echo \"${TIME_STAMP}: Could not open password file \\\"${PASSFILE}\\\" for reading.\" >> ${LOG_FILE} exit 1 fi CORRECT_PASSWORD=`awk '!/^;/&&!/^#/&&$1==\"'${username}'\"{print $2;exit}' ${PASSFILE}` if [ \"${CORRECT_PASSWORD}\" = \"\" ]; then echo \"${TIME_STAMP}: User does not exist: username=\\\"${username}\\\", password= \\\"${password}\\\".\" >> ${LOG_FILE} exit 1 fi if [ \"${password}\" = \"${CORRECT_PASSWORD}\" ]; then echo \"${TIME_STAMP}: Successful authentication: username=\\\"${username}\\\".\" >> ${LOG_FILE} exit 0 fi echo \"${TIME_STAMP}: Incorrect password: username=\\\"${username}\\\", password= \\\"${password}\\\".\" >> ${LOG_FILE} exit 1 EOF \u6ce8\u610f\uff1a\u9700\u8981\u7ed9\u8fd9\u4e2a\u811a\u672c\u4e00\u4e2a\u6267\u884c\u6743\u9650 4.4.3\uff1a\u90e8\u7f72iptables\uff1a \u00b6 \u9632\u706b\u5899\u914d\u7f6e\uff08firewalld\u914d\u7f6e\u6216\u8005iptables\u914d\u7f6e\u9009\u4e00\u4e2a\uff09 # firewalld\u914d\u7f6e firewall-cmd --permanent --add-masquerade firewall-cmd --permanent --add-service = openvpn # \u6216\u8005\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7aef\u53e3 # firewall-cmd --permanent --add-port=1194/tcp firewall-cmd --permanent --direct --passthrough ipv4 -t nat -A POSTROUTING -s 10 .8.0.0/24 -o eth0 -j MASQUERADE firewall-cmd --reload # iptables \uff08\u548c\u4e0a\u9762\u7684\u7f51\u6bb5\u914d\u7f6e\u4e0d\u540c\uff0c\u4fee\u6539\u4e0b\u9762\u7684\u7f51\u6bb5\u5373\u53ef\uff09 yum install iptables-services systemctl enable iptables iptables -X iptables -F iptables -Z iptables -P INPUT ACCEPT iptables -P OUTPUT ACCEPT iptables -P FORWARD ACCEPT service iptables save iptables -t nat -A POSTROUTING -s 10 .10.0.0/255.255.255.0 -o eth0 -j MASQUERADE iptables -A FORWARD -s 10 .10.0.0/24 -d 192 .168.0.0/24 -i tun0 -j ACCEPT iptables -A FORWARD -s 192 .168.0.0/24 -d 10 .10.0.0/24 -i eth0 -j ACCEPT service iptables save 4.4.4\uff1a\u51c6\u5907\u5ba2\u6237\u7aef\u8bc1\u4e66\uff1a \u00b6 \u5907\u6ce8\uff1a\u5b89\u88c5openvpn\u5ba2\u6237\u7aef\u8f6f\u4ef6\uff1aconfig\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0ca\u8bc1\u4e66\u548c.opvn client dev tun proto udp # \u516c\u7f51ip\u9700\u8981\u4fee\u6539 remote \u516c\u7f51\u5730\u5740 41194 resolv-retry infinite nobind persist-key persist-tun ca ca.crt comp-lzo verb 3 cipher AES-256-CBC auth-user-pass 5.1\uff1a\u5176\u4ed6\u6848\u4f8b\u914d\u7f6e\uff1a \u00b6 \u9644\u4ef6\uff1a \u00b6 \u5b66\u4e60\u535a\u5ba2\uff1a https://www.jianshu.com/p/09603d9e0b6c","title":"frp \u5185\u7f51\u7a7f\u900f"},{"location":"network/frp/#frp","text":"\u4e0b\u8f7d\u5730\u5740\uff1a https://github.com/fatedier/frp/releases","title":"\u4e00\u3001\u5185\u7f51\u7a7f\u900fFrp\uff1a"},{"location":"network/frp/#11","text":"","title":"1.1\u3001\u6982\u8ff0\uff1a"},{"location":"network/frp/#111frp","text":"\u662f\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684\u53cd\u5411\u4ee3\u7406\u5e94\u7528\uff0c\u53ef\u4ee5\u5e2e\u52a9\u60a8\u8f7b\u677e\u5730\u8fdb\u884c\u5185\u7f51\u7a7f\u900f\uff0c\u5bf9\u5916\u7f51\u63d0\u4f9b\u670d\u52a1\uff0c\u652f\u6301 tcp, http, https \u7b49\u534f\u8bae\u7c7b\u578b\uff0c\u5e76\u4e14 web \u670d\u52a1\u652f\u6301\u6839\u636e\u57df\u540d\u8fdb\u884c\u8def\u7531\u8f6c\u53d1\u3002","title":"1.1.1\uff1afrp\u5185\u7f51\u7a7f\u900f\u5de5\u5177\uff1a"},{"location":"network/frp/#112frp","text":"\u5229\u7528\u5904\u4e8e\u5185\u7f51\u6216\u9632\u706b\u5899\u540e\u7684\u673a\u5668\uff0c\u5bf9\u5916\u7f51\u73af\u5883\u63d0\u4f9b http \u6216 https \u670d\u52a1\u3002 \u5bf9\u4e8e http \u670d\u52a1\u652f\u6301\u57fa\u4e8e\u57df\u540d\u7684\u865a\u62df\u4e3b\u673a\uff0c\u652f\u6301\u81ea\u5b9a\u4e49\u57df\u540d\u7ed1\u5b9a\uff0c\u4f7f\u591a\u4e2a\u57df\u540d\u53ef\u4ee5\u5171\u7528\u4e00\u4e2a80\u7aef\u53e3\u3002 \u5229\u7528\u5904\u4e8e\u5185\u7f51\u6216\u9632\u706b\u5899\u540e\u7684\u673a\u5668\uff0c\u5bf9\u5916\u7f51\u73af\u5883\u63d0\u4f9b tcp \u670d\u52a1\uff0c\u4f8b\u5982\u5728\u5bb6\u91cc\u901a\u8fc7 ssh \u8bbf\u95ee\u5904\u4e8e\u516c\u53f8\u5185\u7f51\u73af\u5883\u5185\u7684\u4e3b\u673a\u3002 \u53ef\u67e5\u770b\u901a\u8fc7\u4ee3\u7406\u7684\u6240\u6709 http \u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u8be6\u7ec6\u4fe1\u606f\u3002\uff08\u5f85\u5f00\u53d1\uff09","title":"1.1.2\uff1afrp\u7684\u4f5c\u7528\uff1a"},{"location":"network/frp/#21","text":"\u6e29\u99a8\u63d0\u793a \u4ee5\u4e0b\u6b65\u9aa4\u53ea\u9488\u5bf9\u9488\u5bf9\u4e8ecentos \u64cd\u4f5c\u7cfb\u7edf","title":"2.1\u3001\u9879\u76ee\u601d\u8def\u53ca\u91cd\u96be\u70b9\u5185\u5bb9"},{"location":"network/frp/#211","text":"","title":"2.1.1\uff1a\u9879\u76ee\u62d3\u6251\u56fe\uff1a"},{"location":"network/frp/#212","text":"\u7b2c\u4e00\u6b65 \u8d2d\u4e70\u4e00\u53f0\u4e91\u670d\u52a1\u5668\u4f5c\u4e3afrp-server\u7aef\uff0c\u4e3b\u8981\u662f\u9700\u8981\u4e00\u4e2a\u56fa\u5b9a\u516c\u7f51\u5730\u5740\uff0c\u5982\u679c\u516c\u53f8\u6709\u56fa\u5b9a\u516c\u7f51\u5730\u5740\u6700\u597d \u7b2c\u4e8c\u6b65 \u5728\u516c\u53f8\u6216\u8005\u5185\u7f51\u51c6\u5907\u4e00\u53f0\u4e3b\u673a\u4f5c\u4e3afrp-client\u7aef \u7b2c\u4e09\u6b65 \u5728\u516c\u53f8\u6216\u8005\u5185\u7f51\u51c6\u5907\u4e00\u53f0\u4e3b\u673a\u6765\u90e8\u7f72vpn \u7b2c\u56db\u6b65 \u5229\u7528\u7a7f\u900f\u6765\u5b9e\u73b0\u8fde\u63a5VPN","title":"2.1.2\uff1a\u5b9e\u9a8c\u601d\u8def\uff1a"},{"location":"network/frp/#213frp","text":"[ root@localhost frpc ] # ll \u603b\u7528\u91cf 21136 -rwxr-xr-x 1 root root 10466752 8\u6708 18 2021 frpc -rw-r--r-- 1 root root 6818 8\u6708 18 2021 frpc_full.ini -rw-r--r-- 1 root root 283 5\u6708 2 23 :35 frpc.ini -rwxr-xr-x 1 root root 11133376 8\u6708 18 2021 frps -rw-r--r-- 1 root root 2199 8\u6708 18 2021 frps_full.ini -rw-r--r-- 1 root root 26 8\u6708 18 2021 frps.ini -rw-r--r-- 1 root root 11358 8\u6708 18 2021 LICENSE -rw-r--r-- 1 root root 21 8\u6708 18 2021 run.sh drwxrwxr-x 2 root root 88 8\u6708 18 2021 systemd \u6587\u4ef6\u8bf4\u660e\uff1a frpc # \u5ba2\u6237\u7aef\u4e8c\u8fdb\u5236\u6587\u4ef6 frpc_full.ini # \u5ba2\u6237\u7aef\u914d\u7f6e\u6587\u4ef6\u5b8c\u6574\u793a\u4f8b frpc.ini # \u5ba2\u6237\u7aef\u914d\u7f6e\u6587\u4ef6 frps # \u670d\u52a1\u7aef\u4e8c\u8fdb\u5236\u6587\u4ef6 frps_full.ini # \u670d\u52a1\u7aef\u914d\u7f6e\u6587\u4ef6\u5b8c\u6574\u793a\u4f8b frps.in1 # \u670d\u52a1\u7aef\u914d\u7f6e\u6587\u4ef6","title":"2.1.3\uff1afrp\u914d\u7f6e\u6587\u4ef6\u8bf4\u660e\uff1a"},{"location":"network/frp/#31frp","text":"","title":"3.1\u3001Frp\u90e8\u7f72\uff1a"},{"location":"network/frp/#311frps","text":"\u6ce8\u91ca\uff1a\u4e00\u822cfrps \u662f\u516c\u7f51\u4e0a\u7684\u4e00\u53f0\u4e91\u670d\u52a1\u5668\uff0c\u8fd9\u91cc\u53ef\u4ee5\u662f\u4efb\u610f\u7684\u4e91\u5e73\u53f0\uff0c\u6ce8\u610f\u4e00\u5b9a\u8bb0\u5f97\u5f00\u5b89\u5168\u7ec4\uff01\uff01\uff01 [ root@VM-16-9-centos frps ] # cat frps.ini [ common ] bind_port = 50070 vhost_http_port = 50080 vhost_https_port = 50443 token = $pF @7zz^LDuh7^xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx \u8fd9\u4e2atoken\u662f\u7528\u4e8e\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u8fde\u63a5 # \u542f\u52a8 ./frps -c ./frps.ini","title":"3.1.1\uff1a\u90e8\u7f72frps\uff1a"},{"location":"network/frp/#312frpc","text":"[ root@moban frp_0.38.0_linux_amd64 ] # cat frpc.ini [ common ] server_addr = 115 .29.189.57 # server_addr\u8868\u793a\u4e0efrps\u8fde\u63a5\u7684\u5730\u5740 server_port = 50081 # \u4e0efrps\u8fde\u63a5\u7684\u7aef\u53e3 token = pass@word1 # \u914d\u7f6etoken\u7528\u6765\u9a8c\u8bc1 [ openvpn ] type = udp local_ip = 192 .168.8.82 local_port = 51194 remote_port = 51194 # remote_port\u8868\u793a\u7528\u6237\u8bbf\u95ee\u516c\u7f51\u5730\u5740+\u7aef\u53e3,\u5c31\u53cd\u5411\u4ee3\u7406\u5230local_ip+\u7aef\u53e3 # \u542f\u52a8 ./frps -c ./frps.ini","title":"3.1.2\uff1a\u90e8\u7f72frpc\uff1a"},{"location":"network/frp/#313nj192165020","text":"[ root@moban frp_0.26.0_linux_amd64 ] # cat frpc.ini [ common ] tls_enable = true server_addr = 39 .104.160.84 server_port = 50070 token = $pF @xxxxxx [ openvpn-nj ] type = udp local_ip = 192 .165.0.21 local_port = 31194 remote_port = 31194 [ root@moban frp_0.26.0_linux_amd64 ] # cat frp.sh ./frpc -c ./frpc.ini","title":"3.1.3\uff1anj\u5730\u533a\uff1a192.165.0.20"},{"location":"network/frp/#314bj","text":"[ root@frp-40 frpc ] # cat frpc.ini [ common ] tls_enable = true server_addr = 39 .104.160.84 server_port = 50070 token = $pF @7zz^LDuh7^X0Uxxxxx","title":"3.1.4\uff1abj\u5730\u533a\uff1a"},{"location":"network/frp/#41vpn","text":"","title":"4.1\u3001vpn\u90e8\u7f72\uff1a"},{"location":"network/frp/#441vpn","text":"#!/bin/bash # \u642d\u5efavpenvpn\u811a\u672c # \u4f5c\u8005:lixie # \u65e5\u671f:2021-10-19 # openvpn\u662f\u670d\u52a1\u7aef,easy-rsa\u662f\u8bc1\u4e66\u7ba1\u7406\u5de5\u5177 yum -y install wget mkdir -p /etc/yum.repos.d/backup mv /etc/yum.repos.d/*.repo /etc/yum.repos.d/backup/ wget -O /etc/yum.repos.d/CentOS-Base.repo https://mirrors.aliyun.com/repo/Centos-7.repo wget -O /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo yum -y install openvpn easy-rsa & > /dev/null # \u83b7\u53d6openvpn\u548ceasy-rsa\u7684\u7248\u672c OPENVER = $( rpm -qi openvpn | awk -F \": \" 'NR==2{print $2}' ) EASYVER = $( rpm -qi easy-rsa | awk -F \": \" 'NR==2{print $2}' ) #echo \"openvpn-$OPENVER\" #echo \"easy-rsa-$EASYVER\" #\u751f\u6210\u670d\u52a1\u5668\u914d\u7f6e\u6587\u4ef6 #cp /usr/share/doc/openvpn-$OPENVER/sample/sample-config-files/server.conf /etc/openvpn/ cat << EOF >> /etc/openvpn/server/server.conf local 0.0.0.0 port 41194 proto udp dev tun ca /etc/openvpn/certs/ca.crt cert /etc/openvpn/certs/server.crt dh /etc/openvpn/certs/dh.pem push \"route 192.168.0.0 255.255.0.0\" server 10.10.0.0 255.255.255.0 ifconfig-pool-persist /var/log/openvpn/ipp.txt client-to-client keepalive 10 120 comp-lzo max-clients 100 persist-key persist-tun status /var/log/openvpn/openvpn-status.log log-append /var/log/openvpn/openvpn.log verb 3 key /etc/openvpn/certs/server.key cipher AES-256-CBC client-config-dir /etc/openvpn/ccd auth-user-pass-verify /etc/openvpn/checkpsw.sh via-env username-as-common-name script-security 3 verify-client-cert none EOF # \u6ce8\u610f\uff01\uff01\uff01 \u8fd9\u91cc\u521b\u5efa\u5b8c\u914d\u7f6e\u6587\u4ef6\u540e\uff0c\u9700\u8981\u505a\u4e2a\u914d\u7f6e\u6587\u4ef6\u7684\u8f6f\u8fde\u63a5\uff0c\u56e0\u4e3a\u5f53\u524d\u7248\u672c\u7684 openvpn systemd \u542f\u52a8\u6587\u4ef6\u4e2d\u8bfb\u53d6\u7684\u662f.service.conf\u914d\u7f6e cd /etc/openvpn/server/ && ln -sf server.conf .service.conf #\u51c6\u5907\u8bc1\u4e66\u7b7e\u53d1\u76f8\u5173\u6587\u4ef6 cp -r /usr/share/easy-rsa/ /etc/openvpn/easy-rsa-server #\u51c6\u5907\u7b7e\u53d1\u8bc1\u4e66\u76f8\u5173\u53d8\u91cf\u7684\u914d\u7f6e\u6587\u4ef6 cp /usr/share/doc/easy-rsa- $EASYVER /vars.example /etc/openvpn/easy-rsa-server/3/vars #CA\u7684\u8bc1\u4e66\u6709\u6548\u671f\u9ed8\u4e3a\u4e3a10\u5e74,\u53ef\u4ee5\u9002\u5f53\u5ef6\u957f,\u6bd4\u5982:36500\u5929 sed -i '/3650/ s/3650/36500/g' /etc/openvpn/easy-rsa-server/3/vars #\u670d\u52a1\u5668\u8bc1\u4e66\u9ed8\u4e3a\u4e3a825\u5929 sed -i '/825/ s/825/82500/g' /etc/openvpn/easy-rsa-server/3/vars \u521d\u59cb\u5316\u6570\u636e,\u5728\u5f53\u524d\u76ee\u5f55\u4e0b\u751f\u6210pki\u76ee\u5f55\u53ca\u76f8\u5173\u6587\u4ef6 cd /etc/openvpn/easy-rsa-server/3/ pwd ./easyrsa init-pki \u521b\u5efaCA\u673a\u6784 cd /etc/openvpn/easy-rsa-server/3 ./easyrsa build-ca nopass <<EOF EOF # \u521b\u5efa\u670d\u52a1\u7aef\u8bc1\u4e66\u7533\u8bf7 cd /etc/openvpn/easy-rsa-server/3 ./easyrsa gen-req server nopass <<EOF EOF ## \u9881\u53d1\u670d\u52a1\u7aef\u8bc1\u4e66 # cd /etc/openvpn/easy-rsa-server/3 ./easyrsa sign server server <<EOF yes EOF # \u521b\u5efa Diffie-Hellman \u5bc6\u94a5,\u8fd9\u4e2a\u6b65\u9aa4\u5b8c\u4e86\u670d\u52a1\u5668\u90e8\u5206\u5c31\u5b8c\u6210\u4e86 cd /etc/openvpn/easy-rsa-server/3 ./easyrsa gen-dh #\u4e3a\u5ba2\u6237\u7aef\u51c6\u5907\u8bc1\u4e66\u73af\u5883 cp -r /usr/share/easy-rsa/ /etc/openvpn/easy-rsa-client cp /usr/share/doc/easy-rsa- $EASYVER /vars.example /etc/openvpn/easy-rsa-client/3/vars cd /etc/openvpn/easy-rsa-client/3/ ./easyrsa init-pki # \u5c06CA\u548c\u670d\u52a1\u5668\u8bc1\u4e66\u76f8\u5173\u6587\u4ef6\u590d\u5236\u5230\u670d\u52a1\u5668\u76f8\u5e94\u7684\u76ee\u5f55 mkdir /etc/openvpn/certs cp /etc/openvpn/easy-rsa-server/3/pki/ca.crt /etc/openvpn/certs/ cp /etc/openvpn/easy-rsa-server/3/pki/issued/server.crt /etc/openvpn/certs/ cp /etc/openvpn/easy-rsa-server/3/pki/private/server.key /etc/openvpn/certs/ cp /etc/openvpn/easy-rsa-server/3/pki/dh.pem /etc/openvpn/certs/ # \u4fee\u6539\u670d\u52a1\u5668\u7aef\u914d\u7f6e\u6587\u4ef6 # \u521b\u5efa\u65e5\u5fd7\u76ee\u5f55 mkdir /etc/openvpn/ccd mkdir /var/log/openvpn chown openvpn.openvpn /var/log/openvpn cat <<EOF>> /etc/openvpn/psw-file LIXIE ABC123, EOF chmod 600 /etc/openvpn/psw-file chown openvpn:openvpn /etc/openvpn/psw-file chmod +x /etc/openvpn/checkpsw.sh chown -R openvpn:openvpn /etc/openvpn/ #\u5728\u670d\u52a1\u5668\u5f00\u542fip_forward\u8f6c\u53d1\u529f\u80fd echo net.ipv4.ip_forward = 1 >> /etc/sysctl.conf && sysctl -p & > /dev/null echo 'iptables -t nat -A POSTROUTING -s 10.10.0.0/24 -j MASQUERADE' >> /etc/rc.d/rc.local chmod +x /etc/rc.d/rc.local /etc/rc.d/rc.local systemctl daemon-reload systemctl start openvpn-server@.service.service systemctl enable openvpn-server@.service.service","title":"4.4.1\uff1avpn\u90e8\u7f72\u811a\u672c\uff1a"},{"location":"network/frp/#442","text":"cat <<EOF>> /etc/openvpn/checkpsw.sh #!/bin/sh ########################################################### # checkpsw.sh (C) 2004 Mathias Sundman <mathias@openvpn.se> # # This script will authenticate OpenVPN users against # a plain text file. The passfile should simply contain # one row per user with the username first followed by # one or more space(s) or tab(s) and then the password. PASSFILE=\"/etc/openvpn/psw-file\" LOG_FILE=\"/var/log/openvpn/password.log\" TIME_STAMP=`date \"+%Y-%m-%d %T\"` ########################################################### if [ ! -r \"${PASSFILE}\" ]; then echo \"${TIME_STAMP}: Could not open password file \\\"${PASSFILE}\\\" for reading.\" >> ${LOG_FILE} exit 1 fi CORRECT_PASSWORD=`awk '!/^;/&&!/^#/&&$1==\"'${username}'\"{print $2;exit}' ${PASSFILE}` if [ \"${CORRECT_PASSWORD}\" = \"\" ]; then echo \"${TIME_STAMP}: User does not exist: username=\\\"${username}\\\", password= \\\"${password}\\\".\" >> ${LOG_FILE} exit 1 fi if [ \"${password}\" = \"${CORRECT_PASSWORD}\" ]; then echo \"${TIME_STAMP}: Successful authentication: username=\\\"${username}\\\".\" >> ${LOG_FILE} exit 0 fi echo \"${TIME_STAMP}: Incorrect password: username=\\\"${username}\\\", password= \\\"${password}\\\".\" >> ${LOG_FILE} exit 1 EOF \u6ce8\u610f\uff1a\u9700\u8981\u7ed9\u8fd9\u4e2a\u811a\u672c\u4e00\u4e2a\u6267\u884c\u6743\u9650","title":"4.4.2\uff1a\u65b0\u589e\u7528\u6237\u811a\u672c\uff1a"},{"location":"network/frp/#443iptables","text":"\u9632\u706b\u5899\u914d\u7f6e\uff08firewalld\u914d\u7f6e\u6216\u8005iptables\u914d\u7f6e\u9009\u4e00\u4e2a\uff09 # firewalld\u914d\u7f6e firewall-cmd --permanent --add-masquerade firewall-cmd --permanent --add-service = openvpn # \u6216\u8005\u6dfb\u52a0\u81ea\u5b9a\u4e49\u7aef\u53e3 # firewall-cmd --permanent --add-port=1194/tcp firewall-cmd --permanent --direct --passthrough ipv4 -t nat -A POSTROUTING -s 10 .8.0.0/24 -o eth0 -j MASQUERADE firewall-cmd --reload # iptables \uff08\u548c\u4e0a\u9762\u7684\u7f51\u6bb5\u914d\u7f6e\u4e0d\u540c\uff0c\u4fee\u6539\u4e0b\u9762\u7684\u7f51\u6bb5\u5373\u53ef\uff09 yum install iptables-services systemctl enable iptables iptables -X iptables -F iptables -Z iptables -P INPUT ACCEPT iptables -P OUTPUT ACCEPT iptables -P FORWARD ACCEPT service iptables save iptables -t nat -A POSTROUTING -s 10 .10.0.0/255.255.255.0 -o eth0 -j MASQUERADE iptables -A FORWARD -s 10 .10.0.0/24 -d 192 .168.0.0/24 -i tun0 -j ACCEPT iptables -A FORWARD -s 192 .168.0.0/24 -d 10 .10.0.0/24 -i eth0 -j ACCEPT service iptables save","title":"4.4.3\uff1a\u90e8\u7f72iptables\uff1a"},{"location":"network/frp/#444","text":"\u5907\u6ce8\uff1a\u5b89\u88c5openvpn\u5ba2\u6237\u7aef\u8f6f\u4ef6\uff1aconfig\u914d\u7f6e\u6587\u4ef6\u4e2d\u6dfb\u52a0ca\u8bc1\u4e66\u548c.opvn client dev tun proto udp # \u516c\u7f51ip\u9700\u8981\u4fee\u6539 remote \u516c\u7f51\u5730\u5740 41194 resolv-retry infinite nobind persist-key persist-tun ca ca.crt comp-lzo verb 3 cipher AES-256-CBC auth-user-pass","title":"4.4.4\uff1a\u51c6\u5907\u5ba2\u6237\u7aef\u8bc1\u4e66\uff1a"},{"location":"network/frp/#51","text":"","title":"5.1\uff1a\u5176\u4ed6\u6848\u4f8b\u914d\u7f6e\uff1a"},{"location":"network/frp/#_1","text":"\u5b66\u4e60\u535a\u5ba2\uff1a https://www.jianshu.com/p/09603d9e0b6c","title":"\u9644\u4ef6\uff1a"},{"location":"prometheus/1.%20prometheus/","text":"curl -X POST -H \"Content-Type: application/json\" -d '{\"name\":\"apikeycurl\", \"role\": \"Admin\"}' http://admin:strongpassword@localhost:3000/api/auth/keys {\"id\":1,\"name\":\"apikeycurl\",\"key\":\"eyJrIjoiVHV2czQxNTdiQnFEWDJ6VjRXMjJpUTc1bGtkR2NmQUoiLCJuIjoiYXBpa2V5Y3VybCIsImlkIjoxfQ==\"}%","title":"1. prometheus"},{"location":"ubuntu/ubuntu-bmc/","text":"\u8ba4\u8bc6BMC \u00b6 \u57fa\u677f\u7ba1\u7406\u63a7\u5236\u5668 \u652f\u6301IPMI\uff08\u667a\u80fd\u5e73\u53f0\u7ba1\u7406\u63a5\u53e3\uff09 \u7528\u6237\u53ef\u4ee5\u5229\u7528IPMI\u6765\u76d1\u89c6\u670d\u52a1\u5668\u7684\u7269\u7406\u5065\u5eb7\u7279\u5f81\uff0c\u5982\u98ce\u6247\uff0c\u7535\u6e90\uff0c\u5185\u5b58\uff0c\u78c1\u76d8\u7b49 \u597d\u5904\uff1a \u5de5\u7a0b\u5e08\u53ef\u4ee5\u8fdc\u7a0b\u5728\u529e\u516c\u5ba4\u4e2d\u5bf9\u670d\u52a1\u5668\u5f00\u673a \u5173\u673a \u91cd\u88c5\u7cfb\u7edf \u67e5\u770b\u786c\u4ef6\u72b6\u6001 \u8fd9\u6837\u5c31\u53ef\u4ee5\u51cf\u5c11\u53bb\u673a\u623f\u7684\u6b21\u6570\uff0c\u6765\u5b8c\u6210\u6211\u4eec\u7684\u6d3b \u5e26\u5916\u7ba1\u7406\u53e3\u89c6\u56fe: \u00b6 \u914d\u7f6eBMC\u5e26\u5916\u7ba1\u7406\u5730\u5740 \u00b6 apt-get install ipmitool ipmitool lan print # \u67e5\u770bBMC\u7684\u5730\u5740 ipmitool lan set 1 ipsrc static ipmitool lan set 1 ipaddr 192 .168.2.21 ipmitool lan set 1 netmask 255 .255.255.0 ipmitool lan set 1 defgw ipaddr 192 .168.2.1 \u8fd9\u6837\u8bbf\u95ee\u8fd9\u4e2a\u5730\u5740\u7684443\u7aef\u53e3\uff0c\u5c31\u53ef\u4ee5\u8bbf\u95ee\u5230\u5e26\u5916\u7ba1\u7406\u4e86\u3002 Mac \u4e0assh\u8f6c\u53d1\u8bbf\u95ee ssh -L 3443:192.168.2.20:443 router2.c1","title":"BMC\u5e26\u5916\u7ba1\u7406"},{"location":"ubuntu/ubuntu-bmc/#bmc","text":"\u57fa\u677f\u7ba1\u7406\u63a7\u5236\u5668 \u652f\u6301IPMI\uff08\u667a\u80fd\u5e73\u53f0\u7ba1\u7406\u63a5\u53e3\uff09 \u7528\u6237\u53ef\u4ee5\u5229\u7528IPMI\u6765\u76d1\u89c6\u670d\u52a1\u5668\u7684\u7269\u7406\u5065\u5eb7\u7279\u5f81\uff0c\u5982\u98ce\u6247\uff0c\u7535\u6e90\uff0c\u5185\u5b58\uff0c\u78c1\u76d8\u7b49 \u597d\u5904\uff1a \u5de5\u7a0b\u5e08\u53ef\u4ee5\u8fdc\u7a0b\u5728\u529e\u516c\u5ba4\u4e2d\u5bf9\u670d\u52a1\u5668\u5f00\u673a \u5173\u673a \u91cd\u88c5\u7cfb\u7edf \u67e5\u770b\u786c\u4ef6\u72b6\u6001 \u8fd9\u6837\u5c31\u53ef\u4ee5\u51cf\u5c11\u53bb\u673a\u623f\u7684\u6b21\u6570\uff0c\u6765\u5b8c\u6210\u6211\u4eec\u7684\u6d3b","title":"\u8ba4\u8bc6BMC"},{"location":"ubuntu/ubuntu-bmc/#_1","text":"","title":"\u5e26\u5916\u7ba1\u7406\u53e3\u89c6\u56fe:"},{"location":"ubuntu/ubuntu-bmc/#bmc_1","text":"apt-get install ipmitool ipmitool lan print # \u67e5\u770bBMC\u7684\u5730\u5740 ipmitool lan set 1 ipsrc static ipmitool lan set 1 ipaddr 192 .168.2.21 ipmitool lan set 1 netmask 255 .255.255.0 ipmitool lan set 1 defgw ipaddr 192 .168.2.1 \u8fd9\u6837\u8bbf\u95ee\u8fd9\u4e2a\u5730\u5740\u7684443\u7aef\u53e3\uff0c\u5c31\u53ef\u4ee5\u8bbf\u95ee\u5230\u5e26\u5916\u7ba1\u7406\u4e86\u3002 Mac \u4e0assh\u8f6c\u53d1\u8bbf\u95ee ssh -L 3443:192.168.2.20:443 router2.c1","title":"\u914d\u7f6eBMC\u5e26\u5916\u7ba1\u7406\u5730\u5740"},{"location":"ubuntu/ubuntu-system/","text":"\u7cfb\u7edf\u5b89\u88c5 \u00b6 \u6b63\u6240\u8c13\u4e0d\u4f1a\u88c5\u7cfb\u7edf\u7684\u8fd0\u7ef4\u5c31\u4e0d\u662f\u597d\u8fd0\u7ef4\u7684\u7406\u5ff5\uff0c\u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e0bubuntu\u7cfb\u7edf\u5b89\u88c5 \u51c6\u5907\u5de5\u4f5c \u6b65\u9aa4\u4e00: \u4e0b\u8f7diso\u955c\u50cf \u4e0b\u8f7d\u5730\u5740: https://mirrors.aliyun.com/ubuntu-releases/ \u6b65\u9aa4\u4e8c: \u5236\u4f5c\u7cfb\u7edf\u76d8 \u53ef\u4ee5\u53c2\u8003\u4f7f\u7528\u6280\u5de7\u4e2d\u7684Mac\u5236\u4f5c\u7cfb\u7edf\u76d8\u8fd9\u7bc7\u6587\u7ae0 \u6b65\u9aa4\u4e09: \u88c5\u5c31\u5b8c\u4e8b\u4e86 1.1. \u9009\u62e9\u8bed\u8a00 1.2. \u9009\u62e9\u952e\u76d8\uff08\u672c\u6b65\u9aa4\u76f4\u63a5\u9ed8\u8ba4\u6309\u56de\u8f66\u5373\u53ef\u3002\uff09 1.3. \u914d\u7f6e\u7f51\u7edc\uff08\u4e00\u822c\u60c5\u51b5\u4f1a\u76f4\u63a5\u8df3\u8fc7\u8fd9\u4e00\u6b65\uff09 1.4. \u9009\u62e9\u4ee3\u7406\uff08\u9ed8\u8ba4\u56de\u8f66\u8df3\u8fc7\uff09 1.5. \u914d\u7f6e\u955c\u50cf\u6e90\uff08\u8df3\u8fc7\uff09 1.6. \u9009\u62e9\u78c1\u76d8\uff08\u8fd9\u4e2a\u6b65\u9aa4\u6bd4\u8f83\u5173\u952e\uff09 \u9009\u62e9\u78c1\u76d8\u8fd9\u4e00\u6b65\u9700\u8981\u6ce8\u610f\uff0c\u9700\u8981\u6240\u6709\u78c1\u76d8\u7a7a\u95f4\u5206\u7ed9\u6839\u5206\u533a 1.7. \u7528\u6237\u4fe1\u606f 1.8. openssh server \u5207\u8bb0\u8981\u9009\u62e9\u4e0a ( \u5207\u8bb0 ) \u7cfb\u7edf\u521d\u59cb\u5316 \u00b6 \u521d\u59cb\u5316\u6b65\u9aa4 \u6dfb\u52a0hosts\u4fe1\u606f \u4fee\u6539\u56fd\u5185apt\u6e90 \u6e05\u534e\u6e90 \u963f\u91cc\u6e90 \u6dfb\u52a0\u7ba1\u7406\u5458\u7528\u6237 \u901a\u5e38\u51e0\u4e2a\u7ba1\u7406\u4eba\u5458\u51e0\u4e2a\u7ba1\u7406\u7528\u6237 \u4fee\u6539\u5185\u6838\u53c2\u6570 \u5b89\u88c5\u57fa\u7840\u8f6f\u4ef6\uff0cgpu\u9a71\u52a8 \u5b89\u88c5docker \u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6 \u5b89\u88c5kubernetes \u5b89\u88c5\u6307\u5b9akubeadm\u7248\u672c \u4ee5\u4e0a\u521d\u59cb\u5316\u53ef\u4ee5\u901a\u8fc7\u8dd1ansible\u6765\u5b9e\u73b0\uff0c\u4e0b\u9762\u5177\u4f53\u62c6\u5206\u6765\u914d\u7f6e\u4e00\u4e0b \u6e29\u99a8\u63d0\u793a \u4ee5\u4e0b\u64cd\u4f5c\u7cfb\u7edf\u7248\u672c\u662f\u4ee5\u6700\u65b0\u7684ubuntu22.04 \u4e3a\u4f8b\u5b50\u6765\u6f14\u793a \u66f4\u6362\u56fd\u5185\u6e90 \u00b6 ubuntu22.04 \u6e05\u534e\u6e90 \u9700\u8981\u6ce8\u610f\u4e00\u4e0b\uff0c\u5982\u679capt update \u62a5\u9519\uff0c\u5c31\u5c06https\u6539\u6210http \u5982\u679c\u9700\u8981\u6dfb\u52a0\u5176\u4ed6\u7684\u7248\u672c\u7684\u6e90\u53ef\u4ee5\u8bbf\u95ee: https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/ # \u9ed8\u8ba4\u6ce8\u91ca\u4e86\u6e90\u7801\u955c\u50cf\u4ee5\u63d0\u9ad8 apt update \u901f\u5ea6\uff0c\u5982\u6709\u9700\u8981\u53ef\u81ea\u884c\u53d6\u6d88\u6ce8\u91ca deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-security main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-security main restricted universe multiverse # \u9884\u53d1\u5e03\u8f6f\u4ef6\u6e90\uff0c\u4e0d\u5efa\u8bae\u542f\u7528 # deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse \u5b89\u5168 \u00b6 \u4e94: \u7cfb\u7edf\u5b89\u5168 \u00b6 \u901a\u5e38\u5728\u4f01\u4e1a\u4e2d\uff0c\u670d\u52a1\u5668\u4f1a\u906d\u53d7\u5916\u6765\u7684\u5f88\u591a\u7684\u6076\u610f\u653b\u51fb\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u7684\u5b89\u5168\u5c31\u663e\u5f97\u683c\u5916\u7684\u91cd\u8981\u3002\u9996\u5148\u80af\u5b9a\u60f3\u5230\u7684\u662f\u670d\u52a1\u5668\u7684\u5e10\u53f7\u548c\u5bc6\u7801\u7ba1\u7406\uff0c\u901a\u5e38\u7684\u60c5\u51b5\u4e0b\u4f1a\u7981\u6b62root\u8fd9\u6837\u7684\u7ba1\u7406\u5458\u7528\u6237\u767b\u9646\uff0c\u4e5f\u4f1a\u7981\u6b62\u5bc6\u7801\u8fd9\u6837\u7684\u65b9\u5f0f\u767b\u9646\u3002 \u539f\u56e0: root\u7528\u6237\u7684\u6743\u9650\u592a\u9ad8\uff0c\u5982\u679c\u4e00\u65e6\u5e10\u53f7\u5bc6\u7801\u6cc4\u6f0f\uff0c\u5c31\u4f1a\u9020\u6210\u5f88\u4e25\u91cd\u7684\u540e\u679c\u3002 \u7981\u6b62\u5bc6\u7801\u65b9\u5f0f\u767b\u9646\u4e5f\u662f\u4e3a\u4e86\u5b89\u5168\u8003\u8651\uff0c\u6bd5\u7adf\u5bc6\u7801\u4e22\u5931\u4e5f\u662f\u5f88\u5e73\u5e38\u7684\u4e8b\u60c5\u3002\u63a8\u8350\u4f7f\u7528\u516c\u94a5\u7684\u65b9\u5f0f\u6765\u767b\u9646\u670d\u52a1\u5668\u3002 5.1: \u7981\u6b62root\u7528\u6237: \uff08centos/ubuntu\u90fd\u9002\u7528\uff09 \u00b6 \u53ef\u4ee5\u4fee\u6539 /etc/ssh/sshd_config \u914d\u7f6e\u6587\u4ef6 \u6dfb\u52a0: PermitRootLogin yes \u914d\u7f6e\uff08\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5728\u5b8c\u6210\u521d\u59cb\u5316\u5c31\u7981\u6b62root\u767b\u9646\u4e86\uff09 yes \u4e3a\u5141\u8bb8root\u767b\u9646 no \u4e3a\u7981\u6b62root\u767b\u9646 \u91cd\u65b0\u542f\u52a8sshd\u670d\u52a1\u3002 systemctl restart sshd \u5f53\u7136\u4e5f\u53ef\u4ee5\u52a0\u5165\u7cfb\u7edf\u521d\u59cb\u5316\u6b65\u9aa4\u4e2d\uff0c\u7565\uff5e 5.2: \u5bc6\u94a5\u5bf9\u6765\u767b\u9646\u670d\u52a1\u5668 \u00b6 \u751f\u6210\u516c\u94a5\u548c\u79c1\u94a5 root@user:~# ssh-keygen //\u4e00\u8def\u56de\u8f66 Generating public/private rsa key pair. Enter file in which to save the key ( /root/.ssh/id_rsa ) : Enter passphrase ( empty for no passphrase ) : Enter same passphrase again: Your identification has been saved in /root/.ssh/id_rsa Your public key has been saved in /root/.ssh/id_rsa.pub The key fingerprint is: SHA256:J0s/ZHIRTj/UCcDQLHtxd5Qa0p3r2CYlcz7lPS7VaXU root@user The key ' s randomart image is: +--- [ RSA 3072 ] ----+ | . = +.+o.o+ | | .o == .o++. | | ooo+.o.. | | . .. = +E | | S. = X.B | | . X o @+ | | . o * o | | . . . | | . | +---- [ SHA256 ] -----+ \u8fd9\u4e2a\u65f6\u5019\u5728.ssh\u76ee\u5f55\u4e0b\u751f\u6210\u51e0\u4e2a\u6587\u4ef6 root@user:~# ll .ssh/ total 16 drwx------ 2 root root 4096 Sep 20 09 :46 ./ drwx------ 5 root root 4096 Sep 20 09 :35 ../ -rw------- 1 root root 0 May 24 15 :30 authorized_keys // \u8fd9\u4e2a\u662f\u6388\u6743\u6587\u4ef6 -rw------- 1 root root 2590 Sep 20 09 :46 id_rsa // \u8fd9\u4e2a\u662f\u79c1\u94a5\u6587\u4ef6 -rw-r--r-- 1 root root 563 Sep 20 09 :46 id_rsa.pub //\u8fd9\u4e2a\u662f\u516c\u94a5\u6587\u4ef6 \u5c06\u516c\u94a5\u52a0\u5165user\u7528\u6237\u4e0b: .ssh/authorized_keys root@user:/home/user# ls -a .ssh/ . .. authorized_keys root@user:/home/user# cat .ssh/authorized_keys ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDwWSc73tyq4TAkXxt3rWmGggbpgdm+egc8mOSDu0hauuvPdieIe1qUbKsIKC1O93KyDPlsfP5gcwqdEmf5Di0S6CCxRh6ENyZ9mtN+s1pCDeHiKbjhPyG4o71tafIDOjhcbpEtCwPA0YTrp5i1oO466qYHeFmTCmkcDFhuEKZx78EZdTwbFH0vhOGTymLFgUVauzmd45ZxpTzaZHrd093nFHWg6FeZWk2axkDiijLALNxiAAaECn2S69y5SxXgKSqpe4Z25b2cKKySlM1lBv1eI7CSxAUoxuXSpcgoRiVUx5VgJwkixKvq8NpihYEkV5pFRjB8W0ssu1YF6d+3MlzOkwa+kir9JJlLq+F/rrBTfF2mCLBgg0KE+voDd8vjEkqSmweNs2gEO7Gi/fUEfcabNAOuNNPL2dhdFl+BH2TCofDYvZcWd8Wrl/0qoW5nbUdCaC7aznb0lpVgseB/gj6ah3adCzfA/W8S+1znD9VMHDdMNy+AN8eeQQ6d2t05SOc = \u8bdd\u4e0d\u591a\u8bf4\u6d4b\u8bd5\u767b\u9646 $ ssh user@172.30.42.244 //\u8fd9\u662f\u6211\u4eec\u4f7f\u7528user\u7528\u6237\u767b\u9646\uff0c\u5c31\u4e0d\u9700\u8981\u5bc6\u7801\u4e86 Welcome to Ubuntu 20 .04.4 LTS ( GNU/Linux 5 .4.0-113-generic x86_64 ) \u7981\u6b62\u7528\u6237\u5bc6\u7801\u767b\u9646 \u4e3a\u4e86\u5b89\u5168\u7684\u8003\u8651\uff0c\u6211\u4eec\u9700\u8981\u5173\u95ed\u7528\u6237\u5bc6\u7801\u767b\u9646\u7684\u8fd9\u79cd\u65b9\u5f0f PubkeyAuthentication yes # \u542f\u7528\u516c\u544a\u5bc6\u94a5\u914d\u5bf9\u8ba4\u8bc1\u65b9\u5f0f RSAAuthentication yes # \u5141\u8bb8RSA\u5bc6\u94a5 PasswordAuthentication no # \u7981\u6b62\u5bc6\u7801\u9a8c\u8bc1\u767b\u5f55,\u5982\u679c\u542f\u7528\u7684\u8bdd,RSA\u8ba4\u8bc1\u767b\u5f55\u5c31\u6ca1\u6709\u610f\u4e49\u4e86 PermitRootLogin no # \u7981\u7528root\u8d26\u6237\u767b\u5f55\uff0c\u975e\u5fc5\u8981\uff0c\u4f46\u4e3a\u4e86\u5b89\u5168\u6027\uff0c\u8bf7\u914d\u7f6e \u8fd9\u6837\u7ed3\u5408\u4e0a\u4e00\u6b65\u9aa4\uff0c\u5173\u95ed\u7528\u6237\u8d26\u53f7\u5bc6\u7801\u9a8c\u8bc1\u65b9\u5f0f\uff0c\u53ea\u91c7\u7528\u5bc6\u94a5\u5bf9\u4f1a\u5b89\u5168\u5f88\u591a\u3002 SSH \u65e0\u6cd5\u767b\u9646 \u53ef\u4ee5ping\u901a\u4f46\u65e0\u6cd5ssh ssh -v ip \u65e0\u660e\u663e\u62a5\u9519 \u8003\u8651\u662f\u5426\u662f\u670d\u52a1\u7aef\u7981\u6b62\u5ba2\u6237\u7aef \u5728/etc/hosts.allow\u6587\u4ef6\u4e2d\u52a0\u4e0a sshd: ALL \uff0c\u91cd\u542fsshd \u4fee\u6539\u7f51\u5361\u914d\u7f6e root@ubuntu:/home/ubuntu# cat /etc/netplan/00-installer-config.yaml # This is the network config written by 'subiquity' network: ethernets: ens18: addresses: - 192.168.1.114/24 gateway4: 192.168.1.1 nameservers: addresses: - 192.168.1.1 search: - 202.106.46.151 version: 2 \u6e05\u9664\u5185\u6838\u7f13\u5b58 https://www.tecmint.com/clear-ram-memory-cache-buffer-and-swap-space-on-linux/ Ubuntu \u7cfb\u7edf\u7ba1\u7406 && \u5b89\u88c5\u53ca\u7ba1\u7406\u7a0b\u5e8f: \u00b6 dpkg \u5305\u5b89\u88c5 \u00b6 \uff081\uff09\u683c\u5f0f \u00b6 dpkg [\u9009\u9879] \u5305\u6587\u4ef6 \uff082\uff09\u7528\u6cd5 \u00b6 \u53c2\u6570 Description - i \u5b89\u88c5 deb \u8f6f\u4ef6\u5305 - r \u5220\u9664 deb \u8f6f\u4ef6\u5305 -r --purge \u8fde\u540c\u914d\u7f6e\u6587\u4ef6\u4e00\u8d77\u5220\u9664 -l \u67e5\u770b\u7cfb\u7edf\u4e2d\u5df2\u5b89\u88c5\u8f6f\u4ef6\u5305\u4fe1\u606f -p \u5378\u8f7d\u8f6f\u4ef6\u5305\u53ca\u5176\u914d\u7f6e\u6587\u4ef6\uff0c\u4f46\u65e0\u6cd5\u89e3\u51b3\u4f9d\u8d56\u5173\u7cfb \uff083\uff09\u8f85\u52a9\u9009\u9879 \u00b6 --force-all \u5f3a\u5236\u5b89\u88c5\u4e00\u4e2a\u5305(\u5ffd\u7565\u4f9d\u8d56\u53ca\u5176\u5b83\u95ee\u9898) apt \u5305\u5b89\u88c5 \u5378\u8f7d \u00b6 \uff081\uff09\u683c\u5f0f \u00b6 apt [options] [command] [package ...] \uff082\uff09\u7528\u6cd5 \u00b6 apt install -y package_name //\u5b89\u88c5 apt remove package_name //\u5378\u8f7d apt update //\u5217\u51fa\u6240\u6709\u53ef\u66f4\u65b0\u7684\u8f6f\u4ef6\u6e05\u5355\u547d\u4ee4 \uff083\uff09\u6848\u4f8b \u00b6 // \u8fc7\u6ee4\u51fa\u6765\u4ee5rc\u5f00\u5934\u548cnvidia\u7684\u5305\u5e76\u5378\u8f7d dpkg -l | grep nvidia | grep \"^rc\" | awk '{print $2}' | grep -E 'nvidia' | xargs dpkg --purge dpkg -l | grep nvidia | grep \"^ii\" | awk '{print $2}' | grep -E '^nvidia' | xargs dpkg --force-all -r \u9644\u4ef6: \u00b6 \u6587\u7ae0\u5730\u5740: ubuntu\u5b89\u88c5\u53c2\u8003:","title":"Ubuntu\u64cd\u4f5c\u7cfb\u7edf"},{"location":"ubuntu/ubuntu-system/#_1","text":"\u6b63\u6240\u8c13\u4e0d\u4f1a\u88c5\u7cfb\u7edf\u7684\u8fd0\u7ef4\u5c31\u4e0d\u662f\u597d\u8fd0\u7ef4\u7684\u7406\u5ff5\uff0c\u4e0b\u9762\u4ecb\u7ecd\u4e00\u4e0bubuntu\u7cfb\u7edf\u5b89\u88c5 \u51c6\u5907\u5de5\u4f5c \u6b65\u9aa4\u4e00: \u4e0b\u8f7diso\u955c\u50cf \u4e0b\u8f7d\u5730\u5740: https://mirrors.aliyun.com/ubuntu-releases/ \u6b65\u9aa4\u4e8c: \u5236\u4f5c\u7cfb\u7edf\u76d8 \u53ef\u4ee5\u53c2\u8003\u4f7f\u7528\u6280\u5de7\u4e2d\u7684Mac\u5236\u4f5c\u7cfb\u7edf\u76d8\u8fd9\u7bc7\u6587\u7ae0 \u6b65\u9aa4\u4e09: \u88c5\u5c31\u5b8c\u4e8b\u4e86 1.1. \u9009\u62e9\u8bed\u8a00 1.2. \u9009\u62e9\u952e\u76d8\uff08\u672c\u6b65\u9aa4\u76f4\u63a5\u9ed8\u8ba4\u6309\u56de\u8f66\u5373\u53ef\u3002\uff09 1.3. \u914d\u7f6e\u7f51\u7edc\uff08\u4e00\u822c\u60c5\u51b5\u4f1a\u76f4\u63a5\u8df3\u8fc7\u8fd9\u4e00\u6b65\uff09 1.4. \u9009\u62e9\u4ee3\u7406\uff08\u9ed8\u8ba4\u56de\u8f66\u8df3\u8fc7\uff09 1.5. \u914d\u7f6e\u955c\u50cf\u6e90\uff08\u8df3\u8fc7\uff09 1.6. \u9009\u62e9\u78c1\u76d8\uff08\u8fd9\u4e2a\u6b65\u9aa4\u6bd4\u8f83\u5173\u952e\uff09 \u9009\u62e9\u78c1\u76d8\u8fd9\u4e00\u6b65\u9700\u8981\u6ce8\u610f\uff0c\u9700\u8981\u6240\u6709\u78c1\u76d8\u7a7a\u95f4\u5206\u7ed9\u6839\u5206\u533a 1.7. \u7528\u6237\u4fe1\u606f 1.8. openssh server \u5207\u8bb0\u8981\u9009\u62e9\u4e0a ( \u5207\u8bb0 )","title":"\u7cfb\u7edf\u5b89\u88c5"},{"location":"ubuntu/ubuntu-system/#_2","text":"\u521d\u59cb\u5316\u6b65\u9aa4 \u6dfb\u52a0hosts\u4fe1\u606f \u4fee\u6539\u56fd\u5185apt\u6e90 \u6e05\u534e\u6e90 \u963f\u91cc\u6e90 \u6dfb\u52a0\u7ba1\u7406\u5458\u7528\u6237 \u901a\u5e38\u51e0\u4e2a\u7ba1\u7406\u4eba\u5458\u51e0\u4e2a\u7ba1\u7406\u7528\u6237 \u4fee\u6539\u5185\u6838\u53c2\u6570 \u5b89\u88c5\u57fa\u7840\u8f6f\u4ef6\uff0cgpu\u9a71\u52a8 \u5b89\u88c5docker \u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6 \u5b89\u88c5kubernetes \u5b89\u88c5\u6307\u5b9akubeadm\u7248\u672c \u4ee5\u4e0a\u521d\u59cb\u5316\u53ef\u4ee5\u901a\u8fc7\u8dd1ansible\u6765\u5b9e\u73b0\uff0c\u4e0b\u9762\u5177\u4f53\u62c6\u5206\u6765\u914d\u7f6e\u4e00\u4e0b \u6e29\u99a8\u63d0\u793a \u4ee5\u4e0b\u64cd\u4f5c\u7cfb\u7edf\u7248\u672c\u662f\u4ee5\u6700\u65b0\u7684ubuntu22.04 \u4e3a\u4f8b\u5b50\u6765\u6f14\u793a","title":"\u7cfb\u7edf\u521d\u59cb\u5316"},{"location":"ubuntu/ubuntu-system/#_3","text":"ubuntu22.04 \u6e05\u534e\u6e90 \u9700\u8981\u6ce8\u610f\u4e00\u4e0b\uff0c\u5982\u679capt update \u62a5\u9519\uff0c\u5c31\u5c06https\u6539\u6210http \u5982\u679c\u9700\u8981\u6dfb\u52a0\u5176\u4ed6\u7684\u7248\u672c\u7684\u6e90\u53ef\u4ee5\u8bbf\u95ee: https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/ # \u9ed8\u8ba4\u6ce8\u91ca\u4e86\u6e90\u7801\u955c\u50cf\u4ee5\u63d0\u9ad8 apt update \u901f\u5ea6\uff0c\u5982\u6709\u9700\u8981\u53ef\u81ea\u884c\u53d6\u6d88\u6ce8\u91ca deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-updates main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-backports main restricted universe multiverse deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-security main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-security main restricted universe multiverse # \u9884\u53d1\u5e03\u8f6f\u4ef6\u6e90\uff0c\u4e0d\u5efa\u8bae\u542f\u7528 # deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ jammy-proposed main restricted universe multiverse","title":"\u66f4\u6362\u56fd\u5185\u6e90"},{"location":"ubuntu/ubuntu-system/#_4","text":"","title":"\u5b89\u5168"},{"location":"ubuntu/ubuntu-system/#_5","text":"\u901a\u5e38\u5728\u4f01\u4e1a\u4e2d\uff0c\u670d\u52a1\u5668\u4f1a\u906d\u53d7\u5916\u6765\u7684\u5f88\u591a\u7684\u6076\u610f\u653b\u51fb\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u7684\u5b89\u5168\u5c31\u663e\u5f97\u683c\u5916\u7684\u91cd\u8981\u3002\u9996\u5148\u80af\u5b9a\u60f3\u5230\u7684\u662f\u670d\u52a1\u5668\u7684\u5e10\u53f7\u548c\u5bc6\u7801\u7ba1\u7406\uff0c\u901a\u5e38\u7684\u60c5\u51b5\u4e0b\u4f1a\u7981\u6b62root\u8fd9\u6837\u7684\u7ba1\u7406\u5458\u7528\u6237\u767b\u9646\uff0c\u4e5f\u4f1a\u7981\u6b62\u5bc6\u7801\u8fd9\u6837\u7684\u65b9\u5f0f\u767b\u9646\u3002 \u539f\u56e0: root\u7528\u6237\u7684\u6743\u9650\u592a\u9ad8\uff0c\u5982\u679c\u4e00\u65e6\u5e10\u53f7\u5bc6\u7801\u6cc4\u6f0f\uff0c\u5c31\u4f1a\u9020\u6210\u5f88\u4e25\u91cd\u7684\u540e\u679c\u3002 \u7981\u6b62\u5bc6\u7801\u65b9\u5f0f\u767b\u9646\u4e5f\u662f\u4e3a\u4e86\u5b89\u5168\u8003\u8651\uff0c\u6bd5\u7adf\u5bc6\u7801\u4e22\u5931\u4e5f\u662f\u5f88\u5e73\u5e38\u7684\u4e8b\u60c5\u3002\u63a8\u8350\u4f7f\u7528\u516c\u94a5\u7684\u65b9\u5f0f\u6765\u767b\u9646\u670d\u52a1\u5668\u3002","title":"\u4e94: \u7cfb\u7edf\u5b89\u5168"},{"location":"ubuntu/ubuntu-system/#51-root-centosubuntu","text":"\u53ef\u4ee5\u4fee\u6539 /etc/ssh/sshd_config \u914d\u7f6e\u6587\u4ef6 \u6dfb\u52a0: PermitRootLogin yes \u914d\u7f6e\uff08\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5728\u5b8c\u6210\u521d\u59cb\u5316\u5c31\u7981\u6b62root\u767b\u9646\u4e86\uff09 yes \u4e3a\u5141\u8bb8root\u767b\u9646 no \u4e3a\u7981\u6b62root\u767b\u9646 \u91cd\u65b0\u542f\u52a8sshd\u670d\u52a1\u3002 systemctl restart sshd \u5f53\u7136\u4e5f\u53ef\u4ee5\u52a0\u5165\u7cfb\u7edf\u521d\u59cb\u5316\u6b65\u9aa4\u4e2d\uff0c\u7565\uff5e","title":"5.1: \u7981\u6b62root\u7528\u6237: \uff08centos/ubuntu\u90fd\u9002\u7528\uff09"},{"location":"ubuntu/ubuntu-system/#52","text":"\u751f\u6210\u516c\u94a5\u548c\u79c1\u94a5 root@user:~# ssh-keygen //\u4e00\u8def\u56de\u8f66 Generating public/private rsa key pair. Enter file in which to save the key ( /root/.ssh/id_rsa ) : Enter passphrase ( empty for no passphrase ) : Enter same passphrase again: Your identification has been saved in /root/.ssh/id_rsa Your public key has been saved in /root/.ssh/id_rsa.pub The key fingerprint is: SHA256:J0s/ZHIRTj/UCcDQLHtxd5Qa0p3r2CYlcz7lPS7VaXU root@user The key ' s randomart image is: +--- [ RSA 3072 ] ----+ | . = +.+o.o+ | | .o == .o++. | | ooo+.o.. | | . .. = +E | | S. = X.B | | . X o @+ | | . o * o | | . . . | | . | +---- [ SHA256 ] -----+ \u8fd9\u4e2a\u65f6\u5019\u5728.ssh\u76ee\u5f55\u4e0b\u751f\u6210\u51e0\u4e2a\u6587\u4ef6 root@user:~# ll .ssh/ total 16 drwx------ 2 root root 4096 Sep 20 09 :46 ./ drwx------ 5 root root 4096 Sep 20 09 :35 ../ -rw------- 1 root root 0 May 24 15 :30 authorized_keys // \u8fd9\u4e2a\u662f\u6388\u6743\u6587\u4ef6 -rw------- 1 root root 2590 Sep 20 09 :46 id_rsa // \u8fd9\u4e2a\u662f\u79c1\u94a5\u6587\u4ef6 -rw-r--r-- 1 root root 563 Sep 20 09 :46 id_rsa.pub //\u8fd9\u4e2a\u662f\u516c\u94a5\u6587\u4ef6 \u5c06\u516c\u94a5\u52a0\u5165user\u7528\u6237\u4e0b: .ssh/authorized_keys root@user:/home/user# ls -a .ssh/ . .. authorized_keys root@user:/home/user# cat .ssh/authorized_keys ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDwWSc73tyq4TAkXxt3rWmGggbpgdm+egc8mOSDu0hauuvPdieIe1qUbKsIKC1O93KyDPlsfP5gcwqdEmf5Di0S6CCxRh6ENyZ9mtN+s1pCDeHiKbjhPyG4o71tafIDOjhcbpEtCwPA0YTrp5i1oO466qYHeFmTCmkcDFhuEKZx78EZdTwbFH0vhOGTymLFgUVauzmd45ZxpTzaZHrd093nFHWg6FeZWk2axkDiijLALNxiAAaECn2S69y5SxXgKSqpe4Z25b2cKKySlM1lBv1eI7CSxAUoxuXSpcgoRiVUx5VgJwkixKvq8NpihYEkV5pFRjB8W0ssu1YF6d+3MlzOkwa+kir9JJlLq+F/rrBTfF2mCLBgg0KE+voDd8vjEkqSmweNs2gEO7Gi/fUEfcabNAOuNNPL2dhdFl+BH2TCofDYvZcWd8Wrl/0qoW5nbUdCaC7aznb0lpVgseB/gj6ah3adCzfA/W8S+1znD9VMHDdMNy+AN8eeQQ6d2t05SOc = \u8bdd\u4e0d\u591a\u8bf4\u6d4b\u8bd5\u767b\u9646 $ ssh user@172.30.42.244 //\u8fd9\u662f\u6211\u4eec\u4f7f\u7528user\u7528\u6237\u767b\u9646\uff0c\u5c31\u4e0d\u9700\u8981\u5bc6\u7801\u4e86 Welcome to Ubuntu 20 .04.4 LTS ( GNU/Linux 5 .4.0-113-generic x86_64 ) \u7981\u6b62\u7528\u6237\u5bc6\u7801\u767b\u9646 \u4e3a\u4e86\u5b89\u5168\u7684\u8003\u8651\uff0c\u6211\u4eec\u9700\u8981\u5173\u95ed\u7528\u6237\u5bc6\u7801\u767b\u9646\u7684\u8fd9\u79cd\u65b9\u5f0f PubkeyAuthentication yes # \u542f\u7528\u516c\u544a\u5bc6\u94a5\u914d\u5bf9\u8ba4\u8bc1\u65b9\u5f0f RSAAuthentication yes # \u5141\u8bb8RSA\u5bc6\u94a5 PasswordAuthentication no # \u7981\u6b62\u5bc6\u7801\u9a8c\u8bc1\u767b\u5f55,\u5982\u679c\u542f\u7528\u7684\u8bdd,RSA\u8ba4\u8bc1\u767b\u5f55\u5c31\u6ca1\u6709\u610f\u4e49\u4e86 PermitRootLogin no # \u7981\u7528root\u8d26\u6237\u767b\u5f55\uff0c\u975e\u5fc5\u8981\uff0c\u4f46\u4e3a\u4e86\u5b89\u5168\u6027\uff0c\u8bf7\u914d\u7f6e \u8fd9\u6837\u7ed3\u5408\u4e0a\u4e00\u6b65\u9aa4\uff0c\u5173\u95ed\u7528\u6237\u8d26\u53f7\u5bc6\u7801\u9a8c\u8bc1\u65b9\u5f0f\uff0c\u53ea\u91c7\u7528\u5bc6\u94a5\u5bf9\u4f1a\u5b89\u5168\u5f88\u591a\u3002 SSH \u65e0\u6cd5\u767b\u9646 \u53ef\u4ee5ping\u901a\u4f46\u65e0\u6cd5ssh ssh -v ip \u65e0\u660e\u663e\u62a5\u9519 \u8003\u8651\u662f\u5426\u662f\u670d\u52a1\u7aef\u7981\u6b62\u5ba2\u6237\u7aef \u5728/etc/hosts.allow\u6587\u4ef6\u4e2d\u52a0\u4e0a sshd: ALL \uff0c\u91cd\u542fsshd \u4fee\u6539\u7f51\u5361\u914d\u7f6e root@ubuntu:/home/ubuntu# cat /etc/netplan/00-installer-config.yaml # This is the network config written by 'subiquity' network: ethernets: ens18: addresses: - 192.168.1.114/24 gateway4: 192.168.1.1 nameservers: addresses: - 192.168.1.1 search: - 202.106.46.151 version: 2 \u6e05\u9664\u5185\u6838\u7f13\u5b58 https://www.tecmint.com/clear-ram-memory-cache-buffer-and-swap-space-on-linux/","title":"5.2: \u5bc6\u94a5\u5bf9\u6765\u767b\u9646\u670d\u52a1\u5668"},{"location":"ubuntu/ubuntu-system/#ubuntu","text":"","title":"Ubuntu \u7cfb\u7edf\u7ba1\u7406 &amp;&amp; \u5b89\u88c5\u53ca\u7ba1\u7406\u7a0b\u5e8f:"},{"location":"ubuntu/ubuntu-system/#dpkg","text":"","title":"dpkg \u5305\u5b89\u88c5"},{"location":"ubuntu/ubuntu-system/#1","text":"dpkg [\u9009\u9879] \u5305\u6587\u4ef6","title":"\uff081\uff09\u683c\u5f0f"},{"location":"ubuntu/ubuntu-system/#2","text":"\u53c2\u6570 Description - i \u5b89\u88c5 deb \u8f6f\u4ef6\u5305 - r \u5220\u9664 deb \u8f6f\u4ef6\u5305 -r --purge \u8fde\u540c\u914d\u7f6e\u6587\u4ef6\u4e00\u8d77\u5220\u9664 -l \u67e5\u770b\u7cfb\u7edf\u4e2d\u5df2\u5b89\u88c5\u8f6f\u4ef6\u5305\u4fe1\u606f -p \u5378\u8f7d\u8f6f\u4ef6\u5305\u53ca\u5176\u914d\u7f6e\u6587\u4ef6\uff0c\u4f46\u65e0\u6cd5\u89e3\u51b3\u4f9d\u8d56\u5173\u7cfb","title":"\uff082\uff09\u7528\u6cd5"},{"location":"ubuntu/ubuntu-system/#3","text":"--force-all \u5f3a\u5236\u5b89\u88c5\u4e00\u4e2a\u5305(\u5ffd\u7565\u4f9d\u8d56\u53ca\u5176\u5b83\u95ee\u9898)","title":"\uff083\uff09\u8f85\u52a9\u9009\u9879"},{"location":"ubuntu/ubuntu-system/#apt","text":"","title":"apt \u5305\u5b89\u88c5 \u5378\u8f7d"},{"location":"ubuntu/ubuntu-system/#1_1","text":"apt [options] [command] [package ...]","title":"\uff081\uff09\u683c\u5f0f"},{"location":"ubuntu/ubuntu-system/#2_1","text":"apt install -y package_name //\u5b89\u88c5 apt remove package_name //\u5378\u8f7d apt update //\u5217\u51fa\u6240\u6709\u53ef\u66f4\u65b0\u7684\u8f6f\u4ef6\u6e05\u5355\u547d\u4ee4","title":"\uff082\uff09\u7528\u6cd5"},{"location":"ubuntu/ubuntu-system/#3_1","text":"// \u8fc7\u6ee4\u51fa\u6765\u4ee5rc\u5f00\u5934\u548cnvidia\u7684\u5305\u5e76\u5378\u8f7d dpkg -l | grep nvidia | grep \"^rc\" | awk '{print $2}' | grep -E 'nvidia' | xargs dpkg --purge dpkg -l | grep nvidia | grep \"^ii\" | awk '{print $2}' | grep -E '^nvidia' | xargs dpkg --force-all -r","title":"\uff083\uff09\u6848\u4f8b"},{"location":"ubuntu/ubuntu-system/#_6","text":"\u6587\u7ae0\u5730\u5740: ubuntu\u5b89\u88c5\u53c2\u8003:","title":"\u9644\u4ef6:"}]}